(this["webpackJsonpredcross-portal"]=this["webpackJsonpredcross-portal"]||[]).push([[0],{272:function(e,t,n){e.exports=n(536)},277:function(e,t,n){},535:function(e,t,n){},536:function(e,t,n){"use strict";n.r(t);var a=n(0),r=n.n(a),i=n(9),o=n.n(i);n(277),Boolean("localhost"===window.location.hostname||"[::1]"===window.location.hostname||window.location.hostname.match(/^127(?:\.(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)){3}$/));n(278),n(279);var c,l=n(95),s=n(34);function u(e){return{type:c.SET_USERS_DATA,data:{users:e}}}function p(e,t){return{type:c.SET_USER_DATA,data:{user:e,committeeId:t}}}function m(){return{type:c.RESET_AUTH_DATA}}!function(e){e.SET_SHOW_LOADING="SET_SHOW_LOADING",e.SET_USER_DATA="SET_USER_DATA",e.SET_ACCESS_TOKEN="SET_ACCESS_TOKEN",e.SET_COMMITTEE_DATA="SET_COMMITTEE_DATA",e.RESET_AUTH_DATA="RESET_AUTH_DATA",e.SET_USERS_DATA="SET_USERS_DATA"}(c||(c={}));var d,h=n(22),f=n.n(h),v=n(35),b=n(14),g=n(15),E=n(156),y=n.n(E);!function(e){e[e.week=0]="week",e[e.month=1]="month"}(d||(d={}));var S=["Domenica","Luned\xec","Marted\xec","Mercoled\xec","Gioved\xec","Venerd\xec","Sabato"],k=["Gennaio","Febbraio","Marzo","Aprile","Maggio","Giugno","Luglio","Agosto","Settembre","Ottobre","Novembre","Dicembre"],O=function(){var e=localStorage.getItem("redcross-logged-userinfo");if(e)return JSON.parse(e)},D=function(){localStorage.removeItem("redcross-logged-userinfo")},w=function(e,t,n){return t.filter((function(t){return new Date(t.date).setHours(0,0,0,0)===e.setHours(0,0,0,0)})).filter((function(e){return void 0!==n&&void 0!==n.committeeUser&&(0===n.committeeUser.occupation||e.type>0)})).sort((function(e,t){var n=e.hour.split(":").join(""),a=t.hour.split(":").join("");return Number(n)-Number(a)}))},C=function(){function e(){Object(b.a)(this,e),this.axiosInstance=void 0,this.authHeader=function(){var e=O();return e&&e.accessToken?{"x-access-token":e.accessToken}:{}};var t=void 0;t=window.location.origin,this.axiosInstance=y.a.create({baseURL:t,headers:{"Content-Type":"application/json"}})}return Object(g.a)(e,[{key:"getCommittees",value:function(){var e=Object(v.a)(f.a.mark((function e(){return f.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return"api/committees",e.next=3,this.call("api/committees");case 3:return e.abrupt("return",e.sent);case 4:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"getVehicles",value:function(){var e=Object(v.a)(f.a.mark((function e(t){var n;return f.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n="api/vehicles/findByCommittee/".concat(t),e.next=3,this.call(n);case 3:return e.abrupt("return",e.sent);case 4:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"publishVehicle",value:function(){var e=Object(v.a)(f.a.mark((function e(t){var n,a,r;return f.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=t.id,a="api/vehicles/".concat(n>0?n:""),r=JSON.stringify(t),e.next=5,this.call(a,r,n>0?"PUT":"POST");case 5:return e.abrupt("return",e.sent);case 6:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"deleteVehicle",value:function(){var e=Object(v.a)(f.a.mark((function e(t){var n,a;return f.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=t.id,a="api/vehicles/".concat(n),e.next=4,this.call(a,void 0,"DELETE");case 4:return e.abrupt("return",e.sent);case 5:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"deleteTripUsersByTrip",value:function(){var e=Object(v.a)(f.a.mark((function e(t){var n;return f.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n="api/trips_users/deleteByTrip/".concat(t),e.next=3,this.call(n,void 0,"DELETE");case 3:return e.abrupt("return",e.sent);case 4:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"deleteTripUsers",value:function(){var e=Object(v.a)(f.a.mark((function e(t){var n;return f.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n="api/trips_users/".concat(t),e.next=3,this.call(n,void 0,"DELETE");case 3:return e.abrupt("return",e.sent);case 4:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"deleteCommitteesUsers",value:function(){var e=Object(v.a)(f.a.mark((function e(t){var n;return f.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n="api/committees_users/deleteByUserId/".concat(t),e.next=3,this.call(n,void 0,"DELETE");case 3:return e.abrupt("return",e.sent);case 4:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"getUserTrips",value:function(){var e=Object(v.a)(f.a.mark((function e(t){var n;return f.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n="api/trips_users/findByUserId/".concat(t),e.next=3,this.call(n);case 3:return e.abrupt("return",e.sent);case 4:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"deleteTrip",value:function(){var e=Object(v.a)(f.a.mark((function e(t){var n;return f.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n="api/trips/".concat(t),e.next=3,this.call(n,void 0,"DELETE");case 3:return e.abrupt("return",e.sent);case 4:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"getTrips",value:function(){var e=Object(v.a)(f.a.mark((function e(t){var n;return f.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n="api/trips/findByCommittee/".concat(t),e.next=3,this.call(n);case 3:return e.abrupt("return",e.sent);case 4:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"publishTrip",value:function(){var e=Object(v.a)(f.a.mark((function e(t){var n,a,r;return f.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=t.id,a="api/trips/".concat(n>0?n:""),r=JSON.stringify(t),e.next=5,this.call(a,r,n>0?"PUT":"POST");case 5:return e.abrupt("return",e.sent);case 6:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"publishTripUser",value:function(){var e=Object(v.a)(f.a.mark((function e(t){var n,a,r;return f.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=t.id,a="api/trips_users/".concat(n>0?n:""),r=JSON.stringify(t),e.next=5,this.call(a,r,n>0?"PUT":"POST");case 5:return e.abrupt("return",e.sent);case 6:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"getUser",value:function(){var e=Object(v.a)(f.a.mark((function e(t){var n;return f.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n="api/users/".concat(t),e.next=3,this.call(n);case 3:return e.abrupt("return",e.sent);case 4:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"getUsers",value:function(){var e=Object(v.a)(f.a.mark((function e(t){var n;return f.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n="api/users/findByCommittee/".concat(t),e.next=3,this.call(n);case 3:return e.abrupt("return",e.sent);case 4:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"deleteUser",value:function(){var e=Object(v.a)(f.a.mark((function e(t){var n;return f.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n="api/users/".concat(t),e.next=3,this.call(n,void 0,"DELETE");case 3:return e.abrupt("return",e.sent);case 4:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"deleteCommitteeUser",value:function(){var e=Object(v.a)(f.a.mark((function e(t){var n;return f.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n="api/committees_users/".concat(t),e.next=3,this.call(n,void 0,"DELETE");case 3:return e.abrupt("return",e.sent);case 4:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"publishUser",value:function(){var e=Object(v.a)(f.a.mark((function e(t){var n,a,r;return f.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=t.id,a="api/users/".concat(n>0?n:""),r=JSON.stringify(t),e.abrupt("return",this.call(a,r,n>0?"PUT":"POST"));case 4:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"publishUserCommittee",value:function(){var e=Object(v.a)(f.a.mark((function e(t,n){var a,r,i,o,c,l;return f.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.publishUser(t);case 2:if(201===(a=e.sent).status||200===a.status){e.next=6;break}throw console.log(a),new Error("Si \xe8 verificato un errore nell'inserimento");case 6:return r=t.id,i=a.data,o={id:n.id,userId:r>0?r:i.id,committeeId:n.committeeId,role:n.role,occupation:n.occupation,disabled:n.disabled},c=JSON.stringify(o),l="api/committees_users/".concat(n.id>0?n.id:""),e.next=13,this.call(l,c,n.id>0?"PUT":"POST");case 13:return e.abrupt("return",e.sent);case 14:case"end":return e.stop()}}),e,this)})));return function(t,n){return e.apply(this,arguments)}}()},{key:"signin",value:function(){var e=Object(v.a)(f.a.mark((function e(t,n,a){var r;return f.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return void 0,r=y.a.create({baseURL:void 0}),e.abrupt("return",r({url:"api/auth/signin",method:"POST",data:{username:t,password:n,committeeId:a}}));case 4:case"end":return e.stop()}}),e)})));return function(t,n,a){return e.apply(this,arguments)}}()},{key:"findUserByUsername",value:function(){var e=Object(v.a)(f.a.mark((function e(t,n){var a,r,i,o;return f.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return a="api/users/findbyusername/".concat(t),r=btoa("".concat(t,":").concat(n)),i={Authorization:"Basic ".concat(r)},void 0,o=y.a.create({baseURL:void 0,headers:i}),e.abrupt("return",o({url:a,method:"GET"}));case 7:case"end":return e.stop()}}),e)})));return function(t,n){return e.apply(this,arguments)}}()},{key:"call",value:function(){var e=Object(v.a)(f.a.mark((function e(t,n){var a,r=arguments;return f.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return a=r.length>2&&void 0!==r[2]?r[2]:"GET",e.abrupt("return",this.axiosInstance({url:t,method:a,headers:this.authHeader(),data:n}));case 2:case"end":return e.stop()}}),e,this)})));return function(t,n){return e.apply(this,arguments)}}()}]),e}(),T={user:void 0,accessToken:"",committee:void 0,users:[],connector:new C,showLoading:!1},j=Object(l.b)({appData:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:T,t=arguments.length>1?arguments[1]:void 0;switch(t.type){case c.SET_ACCESS_TOKEN:var n=t.data.accessToken,a=new C;return Object(s.a)({},e,{accessToken:n,connector:a});case c.SET_USER_DATA:var r=t.data,i=r.user,o=r.committeeId,l=i&&Object(s.a)({},i)||void 0;i&&i.committee_users&&(l=Object(s.a)({},i,{committeeUser:i.committee_users.find((function(e){return e.committeeId===o}))}));var u=Object(s.a)({},e,{user:l});return u;case c.SET_COMMITTEE_DATA:var p=t.data.committee;return Object(s.a)({},e,{committee:p});case c.SET_SHOW_LOADING:return Object(s.a)({},e,{showLoading:t.data});case c.RESET_AUTH_DATA:return D(),Object(s.a)({},e,{user:void 0,committee:void 0,connector:new C,accessToken:"",users:[]});case c.SET_USERS_DATA:var m=t.data.users,d=(m||[]).map((function(e){return Object(s.a)({},e,{committeeUser:e.committee_users[0]})}));return Object(s.a)({},e,{users:d});default:return e}}}),x=n(39),_=n(17),U=n(16),I=n(18),A=n(139),V=n(77),z="/",M="/",F="/desktop",L="/desktop/services",R="/desktop/users",N="/desktop/vehicles",P="/desktop/personal_area",B="/mobile",H="/mobile/services",W="/mobile/booked_services",Y="/mobile/personal_area",q=n(122),J=n(11),G=n(546),K=n(550),X=n(548),Z=n(106),$=n(61),Q=n(547),ee=n(44),te=n(256),ne=n.n(te),ae=q.a.Option,re=function(e){function t(e){var n;Object(b.a)(this,t),(n=Object(_.a)(this,Object(U.a)(t).call(this,e))).connector=void 0,n.handleSelectChange=function(e){n.props.form.setFieldsValue({committeeId:e})},n.buildCommitteesSelect=function(){var e=n.state.committees;if(0===e.length)return a.createElement(J.a,{type:"loading"});var t=n.props.form.getFieldDecorator;return a.createElement(G.a.Item,null,t("committeeId",{rules:[{required:!0,message:"Selezionare il comitato"}]})(a.createElement(q.a,{onChange:n.handleSelectChange},e.map((function(e){return a.createElement(ae,{key:e.id,value:e.id},e.description)})))))},n.login=function(e,t){var a=n.props.connector,r=n.state.isForMobile;a.getUser(e).then((function(e){var a=e.data,i=a.committee_users;if(i){var o=i.find((function(e){return e.committeeId===t}));o&&1!==o.disabled?(n.props.setUserData(a,t),n.props.setCommitteeData(o.committee),n.props.connector.getUsers(t).then((function(e){K.a.success("Autenticato"),n.props.setUsersData(e.data),n.props.history.replace(r?H:L)})).catch((function(e){K.a.error("Si \xe8 verificato un errore nel recupero degli utenti")}))):K.a.error("Utente non abilitato al comitato selezionato")}else K.a.error("Utente non abilitato al comitato selezionato")})).catch((function(e){console.log(e),K.a.error("Si \xe8 verificato un errore. Contattare l'amministratore di sistema.")}))},n.handleSubmit=function(e){e.preventDefault(),n.props.form.validateFields((function(e,t){e||n.setState({loading:!0},(function(){var e=t.committeeId,a=t.username,r=t.password;n.props.connector.signin(a,r,e).then((function(e){var t,a=e.data,r=a.id,i=a.committeeId;t=e.data,localStorage.setItem("redcross-logged-userinfo",JSON.stringify(t)),n.setState({loading:!1},(function(){return n.login(r,i)}))})).catch((function(e){var t="Username e password non validi",a=e.response;if(a){var r=a.data;r&&(t=r.message)}n.setState({loading:!1},(function(){return K.a.error(t)})),console.error(e)}))}))}))};var r=!1,i=n.props.location;if(void 0!==i){var o=i.search;if(void 0!==o)r="mobile"===ne.a.parse(o).layout;n.state={committees:[],isForMobile:r,loading:!1}}return n}return Object(I.a)(t,e),Object(g.a)(t,[{key:"componentDidMount",value:function(){var e=this,t=O();t&&this.login(t.id,t.committeeId),this.props.connector.getCommittees().then((function(t){e.setState(Object(s.a)({},e.state,{committees:t.data}),(function(){t.data&&t.data[0]&&e.handleSelectChange(t.data[0].id)}))})).catch((function(e){console.log(e)}))}},{key:"render",value:function(){var e=this.props.form.getFieldDecorator,t=this.state.committees;return a.createElement(X.a,{visible:!0,closable:!1,confirmLoading:!1,footer:null},a.createElement("div",{style:{textAlign:"right"}},a.createElement("b",null,"Servizio Facile v.1.0")),a.createElement(Z.a,{gutter:8},a.createElement($.a,{span:24},a.createElement("img",{alt:"",src:"/red_cross_logo.png",width:"100%"}))),a.createElement(G.a,{onSubmit:this.handleSubmit,className:"login-form"},a.createElement(G.a.Item,null,e("username",{rules:[{required:!0,message:"Username obbligatoria"}]})(a.createElement(Q.a,{prefix:a.createElement(J.a,{type:"user",style:{color:"rgba(0,0,0,.25)"}}),placeholder:"Digitare il proprio username"}))),a.createElement(G.a.Item,null,e("password",{rules:[{required:!0,message:"Password obbligatoria"}]})(a.createElement(Q.a,{prefix:a.createElement(J.a,{type:"lock",style:{color:"rgba(0,0,0,.25)"}}),type:"password",placeholder:"Digitare la propria password"}))),this.buildCommitteesSelect(),a.createElement(G.a.Item,null,a.createElement(ee.a,{loading:this.state.loading,disabled:null===t||void 0===t||0===t.length,type:"primary",htmlType:"submit",style:{width:"100%"},className:"login-form-button"},"Log in"))))}}]),t}(a.Component),ie=G.a.create({name:"normal_login"})(re),oe=Object(x.b)((function(e,t){return{user:e.appData.user,connector:e.appData.connector}}),{setUserData:p,setAccessToken:function(e){return{type:c.SET_ACCESS_TOKEN,data:{accessToken:e}}},setCommitteeData:function(e){return{type:c.SET_COMMITTEE_DATA,data:{committee:e}}},setUsersData:u})(ie),ce=n(541),le=n(85),se=n(543),ue=n(551),pe=n(266),me=function(e){function t(){return Object(b.a)(this,t),Object(_.a)(this,Object(U.a)(t).apply(this,arguments))}return Object(I.a)(t,e),Object(g.a)(t,[{key:"render",value:function(){return a.createElement(pe.a,{mainButtonStyles:{backgroundColor:"#1890ff"},alwaysShowTitle:!1,event:"click",icon:a.createElement("span",null,"+"),position:{bottom:5,right:5},onClick:this.props.onClick})}}]),t}(a.Component),de=n(549),he=n(544),fe=n(267),ve=n(151),be=n(537),ge=n(552),Ee={0:"Dipendenti",1:"Volontari",2:"Chiunque"},ye={0:"In Sede",1:"Destinazione",2:"Prelevamento"},Se={0:"Solo Andata",1:"Andata/Ritorno"},ke=n(20),Oe=n.n(ke),De={0:"Furgone",1:"Ambulanza",2:"Autovettura"},we=q.a.Option,Ce=function(e){function t(){var e,n;Object(b.a)(this,t);for(var r=arguments.length,i=new Array(r),o=0;o<r;o++)i[o]=arguments[o];return(n=Object(_.a)(this,(e=Object(U.a)(t)).call.apply(e,[this].concat(i)))).setFieldsValue=function(e){var t=n.props.form,a=new Date(2e3,1,1,e.hour?Number(e.hour.substring(0,2)):12,e.hour?Number(e.hour.substring(3,5)):0),r=Object(s.a)({},e,{tripDate:e.date?Oe()(e.date):void 0,tripHour:Oe()(a)});t.setFieldsValue(r)},n.handleSubmit=function(e){e.preventDefault(),n.props.form.validateFields((function(e,t){if(!e){var a=t.vehicleId,r=Object(s.a)({},t,{vehicleId:void 0===a?null:a,date:t.tripDate?t.tripDate.format("YYYY-MM-DD"):void 0,hour:t.tripHour.format("HH:mm")});n.props.onSave(r)}}))},n.buildVehicleOptions=function(){var e=n.props.vehicles.map((function(e){var t=e.id;return a.createElement(we,{key:t,value:e.id},e.sign," - ",De[e.type])}));return[a.createElement(we,{key:-1,value:void 0},a.createElement("div",null,"\xa0"))].concat(Object(le.a)(e))},n}return Object(I.a)(t,e),Object(g.a)(t,[{key:"componentWillReceiveProps",value:function(e){var t=e.trip;void 0!==t&&JSON.stringify(this.props.trip)!==JSON.stringify(e.trip)&&this.setFieldsValue(t)}},{key:"render",value:function(){var e=this.props.form.getFieldDecorator,t=this.props,n=t.trip,r=t.onClose,i=t.visible;return a.createElement(de.a,{title:"".concat(0===(null===n||void 0===n?void 0:n.id)?"Crea":"Modifica"," servizio"),width:480,onClose:r,visible:i,bodyStyle:{paddingBottom:80}},a.createElement(G.a,{layout:"vertical",onSubmit:this.handleSubmit},a.createElement(Z.a,{gutter:16},a.createElement($.a,{span:8},a.createElement(G.a.Item,{label:"Data del servizio"},e("tripDate",{rules:[{required:!0,message:"Specificare data di partenza"}]})(a.createElement(he.a,{style:{width:"100%"},format:"DD-MM-YYYY"})))),a.createElement($.a,{span:8},a.createElement(G.a.Item,{label:"Ora"},e("tripHour",{rules:[{type:"object",required:!0,message:"Specificare l'ora del servizio"}]})(a.createElement(fe.a,{style:{width:"100%"},placeholder:"Ora servizio",format:"HH:mm"})))),a.createElement($.a,{span:8},a.createElement(G.a.Item,{label:"Luogo"},e("flgDestination",{rules:[{required:!0,message:"Specificare il luogo"}]})(a.createElement(q.a,{placeholder:"Luogo"},a.createElement(we,{value:0},ye[0]),a.createElement(we,{value:1},ye[1]),a.createElement(we,{value:2},ye[2])))))),a.createElement(Z.a,{gutter:16},a.createElement($.a,{span:12},a.createElement(G.a.Item,{label:"Partenza"},e("siteDeparture",{rules:[{required:!0,message:"Specificare il luogo di partenza"}]})(a.createElement(Q.a.TextArea,{rows:4,placeholder:"Luogo di partenza"})))),a.createElement($.a,{span:12},a.createElement(G.a.Item,{label:"Arrivo"},e("siteArrival",{rules:[{required:!0,message:"Specificare il luogo di arrivo"}]})(a.createElement(Q.a.TextArea,{rows:4,placeholder:"Luogo di arrivo"}))))),a.createElement(Z.a,{gutter:16},a.createElement($.a,{span:8},a.createElement(G.a.Item,{label:"Veicolo"},e("vehicleId")(a.createElement(q.a,null,this.buildVehicleOptions())))),a.createElement($.a,{span:8},a.createElement(G.a.Item,null,e("flgAr")(a.createElement(ve.a.Group,{style:{marginTop:"10px"}},a.createElement(ve.a,{value:0},Se[0]),a.createElement(ve.a,{value:1},Se[1]))))),a.createElement($.a,{span:8},a.createElement(G.a.Item,{label:"Servizio per"},e("type",{rules:[{required:!0,message:"Specificare il tipo"}]})(a.createElement(q.a,{placeholder:"Servizio per"},a.createElement(we,{value:0},Ee[0]),a.createElement(we,{value:1},Ee[1]),a.createElement(we,{value:2},Ee[2])))))),a.createElement(Z.a,{gutter:16},a.createElement($.a,{span:8},a.createElement(G.a.Item,{label:"Tipologia servizio"},e("serviceType",{rules:[{required:!0,message:"Specificare il tipo di servizio"}]})(a.createElement(Q.a.TextArea,{rows:2,placeholder:"Tipologia servizio"})))),a.createElement($.a,{span:8},a.createElement(G.a.Item,{label:"Dati paziente"},e("patientData")(a.createElement(Q.a.TextArea,{rows:2,placeholder:"Dati paziente"})))),a.createElement($.a,{span:8},a.createElement(G.a.Item,{label:"Medico/sanitario"},e("flgNurse",{valuePropName:"checked"})(a.createElement(be.a,null))))),a.createElement(Z.a,{gutter:16},a.createElement($.a,{span:8},a.createElement(G.a.Item,{label:"Note"},e("notes")(a.createElement(Q.a.TextArea,{rows:3,placeholder:"Eventuali note aggiuntive"})))),a.createElement($.a,{span:8},a.createElement(G.a.Item,{label:"Numero accompagnatori"},e("extraUsers",{initialValue:1})(a.createElement(ge.a,{min:0,max:10})))),a.createElement($.a,{span:8},a.createElement(G.a.Item,{label:"Da notificare"},e("flgToNotify",{valuePropName:"checked"})(a.createElement(be.a,null))))),a.createElement(Z.a,{gutter:16,style:{visibility:"collapse"}},a.createElement($.a,{span:6},a.createElement(G.a.Item,{label:"Id"},e("id")(a.createElement(Q.a,{placeholder:"Specificare id servizio"}))),a.createElement($.a,{span:6},a.createElement(G.a.Item,{label:"CommitteeId"},e("committeeId")(a.createElement(Q.a,{placeholder:"CommitteeId"})))))),a.createElement("div",{style:{position:"absolute",right:0,bottom:0,width:"100%",borderTop:"1px solid #e9e9e9",padding:"10px 16px",background:"#fff",textAlign:"right"}},a.createElement(ee.a,{onClick:this.props.onClose,style:{marginRight:8}},"Annulla"),a.createElement(ee.a,{htmlType:"submit",type:"primary"},"Salva"))))}}]),t}(a.Component),Te=G.a.create({name:"trip_form "})(Ce),je=function(e){function t(){return Object(b.a)(this,t),Object(_.a)(this,Object(U.a)(t).apply(this,arguments))}return Object(I.a)(t,e),Object(g.a)(t,[{key:"render",value:function(){return a.createElement(Te,this.props)}}]),t}(a.Component),xe=n(107),_e=n.n(xe),Ue=0,Ie=function(e){function t(){var e,n;Object(b.a)(this,t);for(var a=arguments.length,r=new Array(a),i=0;i<a;i++)r[i]=arguments[i];return(n=Object(_.a)(this,(e=Object(U.a)(t)).call.apply(e,[this].concat(r)))).onDeleteDate=function(e){var t=n.props.form,a=t.getFieldValue("keys"),r=t.getFieldValue("duplicateElements")||[];1!==a.length&&t.setFieldsValue({keys:a.filter((function(t){return t!==e})),duplicateElements:r.filter((function(t,n){return n!==e}))})},n.onAddDate=function(){var e=n.props.form,t=e.getFieldValue("keys").concat(Ue++);e.setFieldsValue({keys:t})},n.handleSubmit=function(e){e.preventDefault(),n.props.form.validateFields((function(e,t){if(!e){var a=t.duplicateElements,r=n.props.trip;n.props.onConfirm(r,a.filter((function(e){return!!e})))}}))},n.getInitialDateValue=function(e){var t=n.props.trip;return Oe()(void 0!==t?t.date:new Date).add(e+1,"d")},n.getInitialHourValue=function(){var e=n.props.trip,t=new Date(2e3,1,1,(null===e||void 0===e?void 0:e.hour)?Number(e.hour.substring(0,2)):12,(null===e||void 0===e?void 0:e.hour)?Number(e.hour.substring(3,5)):0);return Oe()(t)},n}return Object(I.a)(t,e),Object(g.a)(t,[{key:"componentWillReceiveProps",value:function(e){void 0!==e.trip&&JSON.stringify(this.props.trip)!==JSON.stringify(e.trip)&&this.props.form.setFieldsValue({keys:[],duplicateElements:[]})}},{key:"render",value:function(){var e=this,t=this.props.form,n=t.getFieldDecorator,r=t.getFieldValue;n("keys",{initialValue:[]});var i=r("keys").map((function(t,r){return a.createElement(Z.a,{gutter:16,key:r},a.createElement($.a,{span:11},a.createElement(_e.a.Item,null,n("duplicateElements[".concat(t,"].date"),{initialValue:e.getInitialDateValue(r),rules:[{required:!0,message:"Selezionare data del viaggio"}]})(a.createElement(he.a,{style:{width:"100%"},format:"DD-MM-YYYY"})))),a.createElement($.a,{span:11},a.createElement(_e.a.Item,null,n("duplicateElements[".concat(t,"].hour"),{initialValue:e.getInitialHourValue(),rules:[{type:"object",required:!0,message:"Specificare l'ora del servizio"}]})(a.createElement(fe.a,{style:{width:"100%"},placeholder:"Ora servizio",format:"HH:mm"})))),a.createElement($.a,{span:2},0===t?void 0:a.createElement(J.a,{style:{marginTop:"10px"},className:"dynamic-delete-button",type:"minus-circle-o",onClick:function(){return e.onDeleteDate(t)}})))}));return a.createElement(de.a,{title:"Duplica servizio",width:480,onClose:this.props.onClose,visible:this.props.visible,bodyStyle:{paddingBottom:80}},a.createElement(_e.a,{onSubmit:this.handleSubmit},i,a.createElement(Z.a,{gutter:16},a.createElement($.a,{span:24},a.createElement(_e.a.Item,null,a.createElement(ee.a,{type:"dashed",onClick:this.onAddDate,style:{width:"100%"}},a.createElement(J.a,{type:"plus"})," Aggiungi data")))),a.createElement("div",{style:{position:"absolute",right:0,bottom:0,width:"100%",borderTop:"1px solid #e9e9e9",padding:"10px 16px",background:"#fff",textAlign:"right"}},a.createElement(ee.a,{onClick:this.props.onClose,style:{marginRight:8}},"Annulla"),a.createElement(ee.a,{htmlType:"submit",type:"primary"},"Conferma"))))}}]),t}(a.Component),Ae=_e.a.create({name:"duplicate_trip_form "})(Ie),Ve=function(e){function t(){return Object(b.a)(this,t),Object(_.a)(this,Object(U.a)(t).apply(this,arguments))}return Object(I.a)(t,e),Object(g.a)(t,[{key:"render",value:function(){return a.createElement(Ae,this.props)}}]),t}(a.Component),ze=n(554),Me=n(545),Fe=new Date,Le=function(e){function t(){return Object(b.a)(this,t),Object(_.a)(this,Object(U.a)(t).apply(this,arguments))}return Object(I.a)(t,e),Object(g.a)(t,[{key:"renderCardHeaderDate",value:function(e){var t=e.getDate(),n=k[e.getMonth()];return a.createElement(Z.a,null,a.createElement($.a,{style:{textAlign:"left"},span:24},t," ",n.substring(0,3)))}},{key:"renderCardBodyWeekDay",value:function(e){var t=this.props.todayTrips,n=S[e.getDay()];return a.createElement(Z.a,null,a.createElement($.a,{style:{textAlign:"left"},span:24},a.createElement("b",null,n),0!==t?a.createElement(ze.a,{count:t,style:{backgroundColor:"#87D068",marginLeft:"3px"}}):void 0))}},{key:"render",value:function(){var e=this.props,t=e.selectedDate,n=e.date,r=e.onClickDayOfWeek,i=n.getDate()===t.getDate()&&n.getMonth()===t.getMonth()&&n.getFullYear()===t.getFullYear(),o=n.getTime()<Fe.getTime(),c=n.getTime()===Fe.getTime();return a.createElement(Me.a,{onClick:function(){return r(n)},size:"small",title:this.renderCardHeaderDate(n),className:"current-day",style:{cursor:"pointer",borderRadius:"10px",height:"90px",border:"2px solid ".concat(i?"#1890ff":"#e8e8e8"),backgroundColor:"".concat(c?"#e6f7ff":o?"#f2f4f5":"white")}},this.renderCardBodyWeekDay(n))}}]),t}(a.Component),Re=function(e){function t(){var e,n;Object(b.a)(this,t);for(var r=arguments.length,i=new Array(r),o=0;o<r;o++)i[o]=arguments[o];return(n=Object(_.a)(this,(e=Object(U.a)(t)).call.apply(e,[this].concat(i)))).renderDaysOfWeek=function(){for(var e=n.props,t=e.startDate,r=e.rowIndex,i=e.selectedDate,o=e.trips,c=e.user,l=e.onClickDayOfWeek,s=[],u=0;u<7;u++){var p=u+7*r,m=Object(ue.a)(t,{days:p}),d=w(m,o,c);s.push(a.createElement($.a,{span:3,key:p},a.createElement(Le,{date:m,selectedDate:i,onClickDayOfWeek:l,todayTrips:d.length})))}return s},n}return Object(I.a)(t,e),Object(g.a)(t,[{key:"render",value:function(){return a.createElement(Z.a,{justify:"center",type:"flex"},this.renderDaysOfWeek())}}]),t}(a.Component),Ne=function(e){function t(){var e,n;Object(b.a)(this,t);for(var r=arguments.length,i=new Array(r),o=0;o<r;o++)i[o]=arguments[o];return(n=Object(_.a)(this,(e=Object(U.a)(t)).call.apply(e,[this].concat(i)))).renderDays=function(){for(var e=n.props,t=e.viewMode,r=e.firstDayOfView,i=e.selectedDate,o=e.trips,c=e.user,l=e.onMoveViewLeft,s=e.onMoveViewRight,u=e.onClickDayOfWeek,p=t===d.week?1:4,m=[],h=0;h<p;h++){var f=a.createElement(Z.a,{justify:"center",key:h,type:"flex"},a.createElement($.a,{span:1,style:{textAlign:"right"}},0===h?a.createElement(ee.a,{icon:"left",style:{margin:5},onClick:l}):void 0),a.createElement($.a,{span:22},a.createElement(Re,{startDate:r,rowIndex:h,selectedDate:i,trips:o,user:c,onClickDayOfWeek:u})),a.createElement($.a,{span:1,style:{textAlign:"left"}},0===h?a.createElement(ee.a,{icon:"right",style:{margin:5},onClick:s}):void 0));m.push(f)}return m},n}return Object(I.a)(t,e),Object(g.a)(t,[{key:"render",value:function(){return a.createElement("div",null,this.renderDays())}}]),t}(a.Component),Pe=function(e){function t(){return Object(b.a)(this,t),Object(_.a)(this,Object(U.a)(t).apply(this,arguments))}return Object(I.a)(t,e),Object(g.a)(t,[{key:"render",value:function(){var e=this.props,t=e.actualValue,n=e.onChangeView;return a.createElement("div",{style:{textAlign:"end",margin:10}},"Visualizzazione:",a.createElement(ve.a.Group,{defaultValue:t,size:"default",onChange:function(e){return n(e.target.value)},style:{marginLeft:5}},a.createElement(ve.a.Button,{value:d.week},"Settimana"),a.createElement(ve.a.Button,{value:d.month},"Mese")))}}]),t}(a.Component),Be=n(102),He=n(108),We=n(553),Ye=n(538),qe=n(539),Je=n(268),Ge=n(540),Ke={0:"Autista",1:"Soccorritore",2:"Medico/Sanitario"},Xe=q.a.Option,Ze=function(e){function t(e){var n;Object(b.a)(this,t),(n=Object(_.a)(this,Object(U.a)(t).call(this,e)))._onChangeRole=function(e){n.setState({roleSelected:e.target.value})},n._onChangeUser=function(e){var t=n.props.users.find((function(t){return t.id===e}));void 0!==t&&n.setState({userSelected:t,roleSelected:1})},n.getAvailableUsers=function(){var e=n.props,t=e.users,a=e.tripUsers,r=e.isUserAdmin,i=e.loggedUser;return t.filter((function(e){return!a.find((function(t){return t.userId===e.id}))})).filter((function(e){return r||e.id===i.id})).filter((function(e){return e.committeeUser.role>0}))},n._onConfirmRole=function(){var e=n.state,t=e.roleSelected,a=e.userSelected;void 0!==a&&n.props.onConfirmRole(t,a.id)};var a=n.getAvailableUsers(),r=a.length>0?a[0]:void 0;return n.state={userSelected:r,roleSelected:1},n}return Object(I.a)(t,e),Object(g.a)(t,[{key:"render",value:function(){var e=this.state,t=e.userSelected,n=e.roleSelected,r=this.getAvailableUsers();return a.createElement("div",null,a.createElement(Z.a,null,a.createElement(ve.a.Group,{style:{marginTop:"5px",width:"100%"},value:n,buttonStyle:"solid",onChange:this._onChangeRole},t&&1===t.withDrivingLicense?a.createElement(ve.a.Button,{value:0},Ke[0]):void 0,a.createElement(ve.a.Button,{value:1},Ke[1]),t&&2===t.committeeUser.occupation?a.createElement(ve.a.Button,{value:2},Ke[2]):void 0)),a.createElement(Z.a,null,a.createElement(q.a,{style:{width:"100%"},defaultValue:void 0!==t?t.id:void 0,onChange:this._onChangeUser},r.map((function(e){return a.createElement(Xe,{value:e.id,key:e.id},e.name," ",e.surname)})))),a.createElement(Z.a,null,a.createElement(ee.a,{style:{marginTop:"5px",width:"100%"},type:"primary",ghost:!0,onClick:this._onConfirmRole},"Conferma")))}}]),t}(a.Component),$e=function(e){function t(){var e,n;Object(b.a)(this,t);for(var r=arguments.length,i=new Array(r),o=0;o<r;o++)i[o]=arguments[o];return(n=Object(_.a)(this,(e=Object(U.a)(t)).call.apply(e,[this].concat(i)))).getAvatarBackgroundColor=function(e){return 0===e?"#d9d9d9":2===e?"#1890ff":"#87d068"},n.renderTooltipUserAvatar=function(e){var t=n.props,r=t.user,i=t.onDeleteTripUser,o=Ke[e.role];return a.createElement("p",null,o,n.isUserAdmin||((null===r||void 0===r?void 0:r.id)||0)===e.userId?a.createElement(Be.a,{title:"Elimina"},a.createElement(ee.a,{onClick:function(){return i(e)},style:{marginLeft:"5px"},icon:"delete",type:"danger"})):void 0)},n.renderRoleChoose=function(e,t){var r=n.props,i=r.committeeUsers,o=r.onConfirmRole;return a.createElement(Ze,{users:i.filter((function(e){return!e.committeeUser.disabled})),tripUsers:t,isUserAdmin:n.isUserAdmin,loggedUser:n.props.user,onConfirmRole:function(t,n){return o(t,e,n)}})},n.renderTimeline=function(){var e=n.props,t=e.selectedDate,r=e.trips,i=e.user,o=e.rolesVisible,c=e.onEditTrip,l=e.onDuplicateTrip,s=e.onDeleteTrip,u=e.onRoleVisibleChange,p=w(t,r,i);if(0===p.length)return a.createElement(He.a,null);var m=p.reduce((function(e,t){return e.extraUsers>t.extraUsers?e:t})).extraUsers+1,d=Math.floor(24/m);return a.createElement(We.a,null,p.map((function(e,t){for(var r=e.id,i=e.vehicle,p=e.extraUsers,m=(e.trip_users||[]).sort(n.compareTripUsers),h=p+1,f=[],v=function(t){var i=m[t],c=Number("".concat(r).concat(t)),l=o[c];if(i){var s=i.user;return f.push(a.createElement($.a,{span:d,key:t,style:{textAlign:"center"}},a.createElement(Be.a,{title:n.renderTooltipUserAvatar(i)},a.createElement(ze.a,{style:{zIndex:1},count:a.createElement("b",null,Ke[i.role].substring(0,1))},a.createElement(Ye.a,{style:{backgroundColor:n.getAvatarBackgroundColor(i.role)},shape:"square",icon:"user"})),a.createElement("p",null,a.createElement("span",{style:{fontSize:"10px"}},null===s||void 0===s?void 0:s.name," ",null===s||void 0===s?void 0:s.surname))))),"continue"}f.push(a.createElement($.a,{span:d,key:t,style:{textAlign:"center"}},a.createElement(qe.a,{content:n.renderRoleChoose(e,m),trigger:"click",visible:l,onVisibleChange:function(e){return u(c,e)}},a.createElement(ee.a,{type:"dashed",icon:"user"}))))},b=0;b<h;b++)v(b);return a.createElement(We.a.Item,{key:t},a.createElement(Z.a,null,a.createElement($.a,{span:8},a.createElement(Z.a,null,a.createElement("b",null,"Ora:")," ",e.hour.substr(0,5),a.createElement(Je.a,{style:{marginLeft:"5px"},color:"green"},ye[e.flgDestination])),a.createElement(Z.a,null,a.createElement("b",null,"Partenza: "),e.siteDeparture),a.createElement(Z.a,null,a.createElement("b",null,"Arrivo: ")," ",e.siteArrival),a.createElement(Z.a,null,a.createElement("b",null,"Veicolo: ")," ",i?"".concat(De[i.type]," - ").concat(i.sign," - ").concat(i.description):"-")),a.createElement($.a,{span:4},a.createElement(Z.a,null,a.createElement(Je.a,null,Se[e.flgAr])),a.createElement(Z.a,null,a.createElement(Je.a,{color:"cyan"},Ee[e.type])),a.createElement(Z.a,null,1===e.flgNurse?a.createElement(Je.a,{color:"blue"},"Medico/sanitario"):void 0)),a.createElement($.a,{span:5},a.createElement(Z.a,null,a.createElement("b",null,"Paziente: "),e.patientData||"-"),a.createElement(Z.a,null,a.createElement("b",null,"Servizio: "),e.serviceType||"-"),a.createElement(Z.a,null,e.notes)),a.createElement($.a,{span:n.isUserAdmin?5:7},a.createElement(Z.a,null,f)),n.isUserAdmin?a.createElement($.a,{span:2,style:{textAlign:"center",padding:"10px"}},a.createElement(Be.a,{title:"Modifica"},a.createElement(ee.a,{size:"small",icon:"edit",onClick:function(){return c(e)}})),a.createElement(Be.a,{title:"Duplica"},a.createElement(ee.a,{icon:"copy",size:"small",style:{marginLeft:"1px"},onClick:function(){return l(e)}})),a.createElement(Ge.a,{placement:"topLeft",title:"Confermare l'eliminazione del servizio?",onConfirm:function(){return s(e)},okText:"Si",cancelText:"No"},a.createElement(ee.a,{size:"small",style:{marginLeft:"1px"},icon:"delete",type:"danger"}))):void 0))})))},n}return Object(I.a)(t,e),Object(g.a)(t,[{key:"compareTripUsers",value:function(e,t){if(0===e.role)return-1;if(2===e.role){if(0===t.role)return 1;if(1===t.role)return-1}return 1}},{key:"render",value:function(){return a.createElement(Me.a,{style:{width:"100%",height:"100%",borderRadius:"10px"}},this.renderTimeline())}},{key:"isUserAdmin",get:function(){var e=this.props.user;return void 0!==e&&void 0!==e.committeeUser&&(null===e||void 0===e?void 0:e.committeeUser.role)<2}}]),t}(a.Component),Qe=new Date,et=function(e){function t(){var e,n;Object(b.a)(this,t);for(var a=arguments.length,r=new Array(a),i=0;i<a;i++)r[i]=arguments[i];return(n=Object(_.a)(this,(e=Object(U.a)(t)).call.apply(e,[this].concat(r)))).state={loading:!1,selectedDate:Qe,firstDayOfView:Qe,viewMode:d.week,trips:[],vehicles:[],showForm:!1,showDuplicateTripForm:!1,selectedTrip:void 0,rolesVisible:[]},n.getEmptyTrip=function(){var e,t=n.state.vehicles;return{id:0,date:Object(se.a)(n.state.selectedDate,"yyyy-MM-dd"),hour:"12:00:00",flgDestination:0,flgAr:0,siteDeparture:"",siteArrival:"",serviceType:"",patientData:void 0,type:2,extraUsers:1,flgNurse:0,flgToNotify:0,notes:void 0,committeeId:(null===(e=n.props.committee)||void 0===e?void 0:e.id)||0,vehicleId:0!==t.length?t[0].id:0,committee:void 0,vehicle:void 0,trip_users:[]}},n.loadData=function(){var e=n.props.committee;if(void 0!==e){var t=e.id;n.props.connector.getTrips(t).then((function(e){n.setState({trips:e.data}),n.props.connector.getVehicles(t).then((function(e){n.setState({vehicles:e.data,loading:!1})})).catch((function(e){n.setState({vehicles:[],loading:!1}),console.error(e)}))})).catch((function(e){n.setState({trips:[],loading:!1}),console.error(e)}))}},n._onChangeView=function(e){n.setState({viewMode:e})},n._onClickDayOfWeek=function(e){n.setState({selectedDate:e})},n._onDeleteTrip=function(e){var t=e.id;n.props.connector.deleteTripUsersByTrip(t).then((function(e){n.props.connector.deleteTrip(t).then((function(e){n.loadData()})).catch((function(e){console.log("_onDeleteTrip error: ".concat(e)),K.a.error("Si \xe8 verificato un errore durante l'eliminazione"),n.loadData()}))})).catch((function(e){console.log("_onDeleteTrip error: ".concat(e)),K.a.error("Si \xe8 verificato un errore durante l'eliminazione")}))},n._onEditTrip=function(e){n.setState({selectedTrip:e,showForm:!0})},n._onDuplicateTrip=function(e){n.setState({selectedTrip:e,showDuplicateTripForm:!0})},n._onDeleteTripUser=function(e){var t=e.id;n.props.connector.deleteTripUsers(t).then((function(e){n.loadData()})).catch((function(e){console.error("_onDeleteTripUser: ".concat(e)),K.a.error("Si \xe8 verificato un errore nell'eliminazione")}))},n._onConfirmRole=function(e,t,a){var r={id:0,tripId:t.id,userId:a,role:e},i=n.state.rolesVisible.map((function(e){return!1}));n.props.connector.publishTripUser(r).then((function(e){K.a.success("Salvataggio completato"),n.setState({rolesVisible:i},(function(){n.loadData()}))})).catch((function(e){console.log(e),K.a.error("Si \xe8 verificato un errore nel salvataggio")}))},n._onRoleVisibleChange=function(e,t){var a=Object(le.a)(n.state.rolesVisible);a[e]=t,n.setState({rolesVisible:a})},n._onCreate=function(){n.setState({selectedTrip:n.getEmptyTrip(),showForm:!0})},n._onCloseTripForm=function(){n.setState({showForm:!1,selectedTrip:void 0})},n._onCloseDuplicateTripForm=function(){n.setState({showDuplicateTripForm:!1,selectedTrip:void 0})},n._onConfirmDuplicateTrip=function(){var e=Object(v.a)(f.a.mark((function e(t,a){var r,i,o;return f.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:r=!1,i=f.a.mark((function e(i){var o,c,l,u;return f.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return o=a[i],c=o.date.format("YYYY-MM-DD"),l=o.hour.format("HH:mm"),u=Object(s.a)({},t,{id:0,date:c,hour:l}),e.next=6,n.props.connector.publishTrip(u).then((function(e){console.log("_onConfirmDuplicateTrip done")})).catch((function(e){r=!0,console.error("_onConfirmDuplicateTrip error for trip with date ".concat(c," and hour ").concat(l,". Error: ").concat(e))}));case 6:case"end":return e.stop()}}),e)})),o=0;case 3:if(!(o<a.length)){e.next=8;break}return e.delegateYield(i(o),"t0",5);case 5:o++,e.next=3;break;case 8:n.setState({showDuplicateTripForm:!1,selectedTrip:void 0},(function(){r?K.a.error("Si sono verificati degli errori durante l'operazione"):K.a.success("Operazione completata con successo"),n.loadData()}));case 9:case"end":return e.stop()}}),e)})));return function(t,n){return e.apply(this,arguments)}}(),n._onSave=function(e){n.props.connector.publishTrip(e).then((function(e){K.a.success("Salvataggio completato"),n.setState({showForm:!1,selectedTrip:void 0},(function(){n.loadData()}))})).catch((function(e){console.log(e),K.a.error("Si \xe8 verificato un errore nel salvataggio")}))},n._onMoveViewRight=function(){var e=n.state,t=e.viewMode,a=e.firstDayOfView,r=Object(ue.a)(a,{days:t===d.week?7:28});n.setState({firstDayOfView:r,selectedDate:r})},n._onMoveViewLeft=function(){var e=n.state,t=e.viewMode,a=e.firstDayOfView,r=Object(ue.a)(a,{days:t===d.week?-7:-28});n.setState({firstDayOfView:r,selectedDate:r})},n}return Object(I.a)(t,e),Object(g.a)(t,[{key:"componentDidMount",value:function(){this.loadData()}},{key:"render",value:function(){var e=this.state,t=e.selectedTrip,n=e.showForm,a=e.showDuplicateTripForm,i=e.vehicles,o=e.viewMode,c=e.firstDayOfView,l=e.selectedDate,s=e.trips,u=e.rolesVisible,p=this.props,m=p.user,d=p.users;return r.a.createElement("div",null,r.a.createElement(Pe,{actualValue:o,onChangeView:this._onChangeView}),r.a.createElement(Ne,{viewMode:o,firstDayOfView:c,selectedDate:l,trips:s,user:m,onMoveViewLeft:this._onMoveViewLeft,onMoveViewRight:this._onMoveViewRight,onClickDayOfWeek:this._onClickDayOfWeek}),r.a.createElement($e,{selectedDate:l,trips:s,user:m,committeeUsers:d,rolesVisible:u,onEditTrip:this._onEditTrip,onDuplicateTrip:this._onDuplicateTrip,onDeleteTrip:this._onDeleteTrip,onConfirmRole:this._onConfirmRole,onDeleteTripUser:this._onDeleteTripUser,onRoleVisibleChange:this._onRoleVisibleChange}),r.a.createElement(je,{visible:n,trip:t,vehicles:i.filter((function(e){return!e.disabled})),onClose:this._onCloseTripForm,onSave:this._onSave}),r.a.createElement(Ve,{visible:a,trip:t,onClose:this._onCloseDuplicateTripForm,onConfirm:this._onConfirmDuplicateTrip}),n||a||m&&m.committeeUser.role>1?void 0:r.a.createElement(me,{onClick:this._onCreate}))}},{key:"isUserAdmin",get:function(){var e=this.props.user;return void 0!==e&&void 0!==e.committeeUser&&(null===e||void 0===e?void 0:e.committeeUser.role)<2}}]),t}(r.a.Component),tt=Object(x.b)((function(e,t){return{user:e.appData.user,connector:e.appData.connector,committee:e.appData.committee,users:e.appData.users}}))(et),nt={0:"Superuser",1:"Admin",2:"Utente"},at={0:"Dipendente",1:"Volontario",2:"Medico/Sanitario",3:"Altro"},rt="Maschio",it="Femmina",ot=q.a.Option,ct={labelCol:{xs:{span:24},sm:{span:6}},wrapperCol:{xs:{span:24},sm:{span:18}}},lt={wrapperCol:{xs:{offset:0,span:24},sm:{offset:6,span:18}}},st=function(e){function t(){var e,n;Object(b.a)(this,t);for(var r=arguments.length,i=new Array(r),o=0;o<r;o++)i[o]=arguments[o];return(n=Object(_.a)(this,(e=Object(U.a)(t)).call.apply(e,[this].concat(i)))).getInitialValueBirthDate=function(){var e=n.props.user;return(null===e||void 0===e?void 0:e.birth_date)?Oe()(e.birth_date):void 0},n.handleSubmit=function(e){e.preventDefault(),n.props.form.validateFields((function(e,t){if(!e){var a=Object(s.a)({},t,{birth_date:t.birth_date?t.birth_date.format("YYYY-MM-DD"):void 0,committeeUser:{id:t.committeeUserId,userId:t.id,committeeId:t.committeeId,role:t.role,occupation:t.occupation,disabled:t.disabled}});n.props.onSave(a)}}))},n.renderButtonSubmit=function(){var e={float:"right"};return n.props.personalArea&&(e.width="100%"),a.createElement(ee.a,{htmlType:"submit",type:"primary",style:e},"Salva")},n.renderPasswordField=function(){var e,t=n.props.form.getFieldDecorator,r=n.props,i=r.personalArea,o=r.user;return t("password",{initialValue:null===(e=n.props.user)||void 0===e?void 0:e.password,rules:[{required:!0,message:"Specificare la password"}]})(i?a.createElement(Q.a.Password,{disabled:!0,placeholder:"Specificare la password"}):a.createElement(Q.a,{disabled:o&&o.id>0,type:"password",placeholder:"Specificare la password"}))},n}return Object(I.a)(t,e),Object(g.a)(t,[{key:"render",value:function(){var e,t,n,r,i,o,c,l,s,u,p,m,d,h,f=this.props.form.getFieldDecorator,v=this.props,b=v.user,g=v.onCancel,E=v.personalArea;return a.createElement(G.a,Object.assign({},ct,{style:{padding:"5px"},layout:"vertical",onSubmit:this.handleSubmit}),a.createElement(G.a.Item,{label:"Username"},f("username",{initialValue:null===(e=this.props.user)||void 0===e?void 0:e.username,rules:[{required:!0,message:"Specificare il nome utente"}]})(a.createElement(Q.a,{disabled:b&&b.id>0,placeholder:"Specificare il nome utente"}))),a.createElement(G.a.Item,{label:"Password"},E?a.createElement(Z.a,{gutter:2},a.createElement($.a,{xs:{span:14},lg:{span:20}},this.renderPasswordField()),a.createElement($.a,{xs:{span:10},lg:{span:4}},a.createElement(ee.a,{style:{width:"100%"}},"Modifica"))):this.renderPasswordField()),a.createElement(G.a.Item,{label:"Nome"},f("name",{initialValue:null===(t=this.props.user)||void 0===t?void 0:t.name,rules:[{required:!0,message:"Specificare il nome"}]})(a.createElement(Q.a,{placeholder:"Specificare il nome"}))),a.createElement(G.a.Item,{label:"Cognome"},f("surname",{initialValue:null===(n=this.props.user)||void 0===n?void 0:n.surname,rules:[{required:!0,message:"Specificare il cognome"}]})(a.createElement(Q.a,{placeholder:"Specificare il cognome"}))),a.createElement(G.a.Item,{label:"Data di nascita"},f("birth_date",{initialValue:this.getInitialValueBirthDate(),rules:[]})(a.createElement(he.a,{format:"DD-MM-YYYY",style:{textAlign:"left"}}))),a.createElement(G.a.Item,{label:"Sesso"},f("gender",{initialValue:null===(r=this.props.user)||void 0===r?void 0:r.gender,rules:[{required:!0,message:"Specificare il sesso"}]})(a.createElement(q.a,{placeholder:"Sesso"},a.createElement(ot,{value:0},rt),a.createElement(ot,{value:1},it)))),a.createElement(G.a.Item,{label:"Email"},f("email",{initialValue:null===(i=this.props.user)||void 0===i?void 0:i.email,rules:[]})(a.createElement(Q.a,{placeholder:"Specificare l'email"}))),a.createElement(G.a.Item,{label:"Cellulare"},f("cellphoneNumber",{initialValue:null===(o=this.props.user)||void 0===o?void 0:o.cellphoneNumber,rules:[]})(a.createElement(Q.a,{placeholder:"Specificare numero di cellulare"}))),E&&a.createElement(G.a.Item,lt,this.renderButtonSubmit()),a.createElement("div",{style:{visibility:E?"collapse":"visible"}},a.createElement(G.a.Item,{label:"Ruolo"},f("role",{initialValue:null===(c=this.props.user)||void 0===c?void 0:c.committeeUser.role,rules:[{required:!0,message:"Specificare il ruolo"}]})(a.createElement(q.a,{placeholder:"Role"},a.createElement(ot,{value:1},nt[1]),a.createElement(ot,{value:2},nt[2])))),a.createElement(G.a.Item,{label:"Occupazione"},f("occupation",{initialValue:null===(l=this.props.user)||void 0===l?void 0:l.committeeUser.occupation,rules:[{required:!0,message:"Specificare l'occupazione"}]})(a.createElement(q.a,{placeholder:"Occupazione"},a.createElement(ot,{value:0},at[0]),a.createElement(ot,{value:1},at[1]),a.createElement(ot,{value:2},at[2]))))),a.createElement("div",{style:{visibility:E?"collapse":"visible"}},a.createElement(G.a.Item,{label:"Con patente"},f("withDrivingLicense",{initialValue:null===(s=this.props.user)||void 0===s?void 0:s.withDrivingLicense,valuePropName:"checked"})(a.createElement(be.a,null))),a.createElement(G.a.Item,{label:"Disabilita"},f("disabled",{initialValue:null===(u=this.props.user)||void 0===u?void 0:u.committeeUser.disabled,valuePropName:"checked"})(a.createElement(be.a,null)))),a.createElement("div",{style:{visibility:"collapse"}},a.createElement(G.a.Item,{label:"Id"},f("id",{initialValue:null===(p=this.props.user)||void 0===p?void 0:p.id})(a.createElement(Q.a,{placeholder:"Specificare id utente"}))),a.createElement(G.a.Item,{label:"Password modificata"},f("flgPasswordChanged",{initialValue:null===(m=this.props.user)||void 0===m?void 0:m.flgPasswordChanged})(a.createElement(Q.a,{placeholder:"Password modificata"}))),a.createElement(G.a.Item,{label:"CommitteeUserId"},f("committeeUserId",{initialValue:null===(d=this.props.user)||void 0===d?void 0:d.committeeUser.id})(a.createElement(Q.a,{placeholder:"CommitteeUserId"}))),a.createElement(G.a.Item,{label:"CommitteeId"},f("committeeId",{initialValue:null===(h=this.props.user)||void 0===h?void 0:h.committeeUser.committeeId})(a.createElement(Q.a,{placeholder:"CommitteeId"})))),E?void 0:a.createElement("div",{style:{position:"absolute",right:0,bottom:0,width:"100%",borderTop:"1px solid #e9e9e9",padding:"10px 16px",background:"#fff",textAlign:"right"}},a.createElement(ee.a,{onClick:g,style:{marginRight:8}},"Annulla"),this.renderButtonSubmit()))}}]),t}(a.Component),ut=G.a.create({name:"user_form "})(st),pt=function(e){function t(){return Object(b.a)(this,t),Object(_.a)(this,Object(U.a)(t).apply(this,arguments))}return Object(I.a)(t,e),Object(g.a)(t,[{key:"render",value:function(){return a.createElement(ut,this.props)}}]),t}(a.Component),mt=function(e){function t(){var e,n;Object(b.a)(this,t);for(var a=arguments.length,r=new Array(a),i=0;i<a;i++)r[i]=arguments[i];return(n=Object(_.a)(this,(e=Object(U.a)(t)).call.apply(e,[this].concat(r))))._onCancel=function(){n.props.history.goBack()},n._onSave=function(e){var t=n.props.user;n.props.connector.publishUser(e).then((function(a){n.props.setUserData(e,(null===t||void 0===t?void 0:t.committeeUser.id)||0),K.a.success("Salvataggio completato")})).catch((function(e){console.error("_onSave: error ".concat(e)),K.a.error("Si \xe8 verificato un errore nel salvataggio")}))},n}return Object(I.a)(t,e),Object(g.a)(t,[{key:"render",value:function(){var e=this.props.user;return a.createElement(Z.a,null,a.createElement($.a,{xs:{span:0},lg:{span:3}}),a.createElement($.a,{xs:{span:24},lg:{span:16},style:{marginTop:"10px"}},a.createElement(pt,{loggedUserId:e.id,user:e,personalArea:!0,onCancel:this._onCancel,onSave:this._onSave})),a.createElement($.a,{xs:{span:0},lg:{span:3}}))}}]),t}(a.Component),dt=Object(x.b)((function(e,t){return{user:e.appData.user,connector:e.appData.connector,committee:e.appData.committee}}),{setUserData:p})(mt),ht=n(199),ft=function(e){function t(){var e,n;Object(b.a)(this,t);for(var a=arguments.length,r=new Array(a),i=0;i<a;i++)r[i]=arguments[i];return(n=Object(_.a)(this,(e=Object(U.a)(t)).call.apply(e,[this].concat(r)))).onClickMenuItem=function(e){var t=n.props,a=t.history,r=t.onClickMenu;r&&r(),a.push(e)},n}return Object(I.a)(t,e),Object(g.a)(t,[{key:"render",value:function(){var e=this,t=this.props,n=t.isUserAdmin,r=t.menuMode;return a.createElement(ht.a,{theme:"dark",defaultSelectedKeys:["1"],mode:r},a.createElement(ht.a.Item,{key:"1",onClick:function(){return e.onClickMenuItem(L)}},a.createElement(J.a,{type:"calendar"}),a.createElement("span",null,"Gestione Servizi")),n?a.createElement(ht.a.Item,{key:"2",onClick:function(){return e.onClickMenuItem(R)}},a.createElement(J.a,{type:"team"}),a.createElement("span",null,"Gestione Utenti")):void 0,n?a.createElement(ht.a.Item,{key:"3",onClick:function(){return e.onClickMenuItem(N)}},a.createElement(J.a,{type:"car"}),a.createElement("span",null,"Gestione Veicoli")):void 0,a.createElement(ht.a.Item,{key:"4",onClick:function(){return e.onClickMenuItem(P)}},a.createElement(J.a,{type:"user"}),a.createElement("span",null,"Area personale")))}}]),t}(a.Component),vt=ce.a.Sider,bt=function(e){function t(e){var n;return Object(b.a)(this,t),(n=Object(_.a)(this,Object(U.a)(t).call(this,e)))._onCollapse=function(e){n.setState({collapsed:e})},n._onClickMenu=function(){n.setState({collapsed:!0})},n.state={collapsed:!0},n}return Object(I.a)(t,e),Object(g.a)(t,[{key:"render",value:function(){var e=this.props,t=e.isUserAdmin,n=e.history;return a.createElement(vt,{collapsible:!0,collapsed:this.state.collapsed,onCollapse:this._onCollapse},a.createElement("div",{style:{height:"60px",width:"100%"}}),a.createElement(ft,{isUserAdmin:t,history:n,menuMode:"inline",onClickMenu:this._onClickMenu}))}}]),t}(a.Component),gt=ce.a.Header,Et=function(e){function t(){return Object(b.a)(this,t),Object(_.a)(this,Object(U.a)(t).apply(this,arguments))}return Object(I.a)(t,e),Object(g.a)(t,[{key:"render",value:function(){var e=this.props,t=e.committee,n=e.user,a=e.onClickLogout;return r.a.createElement(gt,{style:{background:"#001529",maxHeight:"64px",width:"100%",padding:0,position:"fixed",zIndex:10,left:0}},r.a.createElement(Z.a,null,r.a.createElement($.a,{span:16,style:{textAlign:"left"}},r.a.createElement("span",{style:{color:"white",marginLeft:"15px",fontStyle:"bold",fontSize:"larger"}},"Servizio Facile v.1.0"),"-",r.a.createElement("span",{style:{color:"white",marginLeft:"5px",fontStyle:"italic"}},null===t||void 0===t?void 0:t.description)),r.a.createElement($.a,{span:7,style:{textAlign:"right"}},r.a.createElement("span",{style:{color:"white",marginRight:"5px"}},null===n||void 0===n?void 0:n.name," ",null===n||void 0===n?void 0:n.surname)),r.a.createElement($.a,{span:1},r.a.createElement(Be.a,{title:"Logout",placement:"bottom"},r.a.createElement(ee.a,{ghost:!0,icon:"logout",style:{height:"64px",width:"100%"},onClick:a})))))}}]),t}(r.a.Component),yt=ce.a.Footer,St=function(e){function t(){return Object(b.a)(this,t),Object(_.a)(this,Object(U.a)(t).apply(this,arguments))}return Object(I.a)(t,e),Object(g.a)(t,[{key:"render",value:function(){var e=this.props,t=e.history,n=e.isUserAdmin;return r.a.createElement(yt,{style:{width:"100%",position:"fixed",left:0,bottom:0,padding:"0px"}},r.a.createElement(ft,{isUserAdmin:n,history:t,menuMode:"horizontal"}))}}]),t}(r.a.Component),kt=n(262),Ot=n(542),Dt=(n(241),function(e){function t(){var e,n,r;Object(b.a)(this,t);for(var i=arguments.length,o=new Array(i),c=0;c<i;c++)o[c]=arguments[c];return(r=Object(_.a)(this,(e=Object(U.a)(t)).call.apply(e,[this].concat(o)))).columns=[{title:"Username",dataIndex:"username",key:"username",render:function(e,t){return a.createElement("b",null,e)}},{title:"Nome",dataIndex:"name",key:"name"},{title:"Cognome",dataIndex:"surname",key:"surname"},{title:"Data di nascita",dataIndex:"birth_date",key:"birth_date"},{title:"Ruolo",dataIndex:"committeeUser.role",key:"role",render:function(e,t){return a.createElement("span",null,nt[e])}},{title:"Occupazione",dataIndex:"committeeUser.occupation",key:"occupation",render:function(e,t){return a.createElement("span",null,at[e])}},{title:"Con patente",dataIndex:"withDrivingLicense",key:"withDrivingLicense",render:function(e,t){return a.createElement("p",null,0===e?void 0:a.createElement(J.a,{type:"check"}))}},{title:"Disabilitato",dataIndex:"committeeUser.disabled",key:"disabled",render:function(e,t){return a.createElement("p",null,0===e?void 0:a.createElement(J.a,{type:"check"}))}},{title:"",key:"action",render:function(e,t){return a.createElement("span",null,a.createElement(Be.a,{title:"Modifica"},a.createElement(ee.a,{size:"small",icon:"edit",onClick:function(){return r._onEditRow(t)}})),a.createElement(Ge.a,{placement:"topLeft",title:"Confermare l'eliminazione dell'utente?",onConfirm:function(){return r._onDeleteUser(t)},okText:"Si",cancelText:"No"},a.createElement(ee.a,{size:"small",style:{marginLeft:"1px"},icon:"delete",type:"danger"})))}}],r.emptyUser={id:0,username:"",password:"",flgPasswordChanged:0,name:"",surname:"",gender:0,withDrivingLicense:0,superuser:0,committeeUser:{id:0,committeeId:(null===(n=r.props.committee)||void 0===n?void 0:n.id)||0,userId:0,role:2,occupation:0,disabled:0}},r.state={loading:!1,showForm:!1},r.loadData=function(){var e=r.props.committee;void 0!==e&&r.props.connector.getUsers(e.id).then((function(e){r.setState({loading:!1},(function(){r.props.setUsersData(e.data)}))})).catch((function(e){K.a.error("Si \xe8 verificato un errore nella lettura degli utenti"),r.setState({loading:!1}),console.error(e)}))},r._onClose=function(){r.setState({showForm:!1,selectedUser:void 0})},r._onEditRow=function(e){r.setState({selectedUser:e,showForm:!0})},r._onDeleteUser=function(e){r.props.connector.getUserTrips(e.id).then((function(t){(t.data||[]).length>0?K.a.error("Utente gi\xe0 assegnato a servizi. Impossibile eliminare"):r.props.connector.deleteCommitteesUsers(e.id).then((function(t){r.props.connector.deleteUser(e.id).then((function(e){r.loadData()})).catch((function(e){console.error("_onDeleteUser - deleteUser: ".concat(e)),K.a.error("Si \xe8 verificato un errore durante l'eliminazione")}))})).catch((function(e){console.error("_onDeleteUser - deleteCommitteesUsers: ".concat(e)),K.a.error("Si \xe8 verificato un errore durante l'eliminazione")}))})).catch((function(e){console.error("_onDeleteUser - getUserTrips: ".concat(e)),K.a.error("Si \xe8 verificato un errore durante l'eliminazione")}))},r._onSave=function(e){var t=e.committeeUser;if(!t)return console.warn("Expected NOT NULL 'committee' - This should never happen!"),void K.a.error("Si \xe8 verificato un errore nel salvataggio");r.props.connector.publishUserCommittee(e,t).then((function(e){K.a.success("Salvataggio completato"),r.setState({showForm:!1,selectedUser:void 0},(function(){r.loadData()}))})).catch((function(e){console.log(e),K.a.error("Si \xe8 verificato un errore nel salvataggio")}))},r._onCreate=function(){r.setState({selectedUser:r.emptyUser,showForm:!0})},r.getDataSource=function(){var e=r.props,t=e.user,n=e.users;return void 0!==t?0===t.superuser?n.filter((function(e){return 0===e.superuser})):n:[]},r}return Object(I.a)(t,e),Object(g.a)(t,[{key:"render",value:function(){var e,t,n=this.state,r=n.loading,i=n.selectedUser,o=n.showForm;return a.createElement("div",null,r?a.createElement("div",{style:{textAlign:"center"}},a.createElement(kt.a,null)):a.createElement(Z.a,null,a.createElement(Ot.a,{columns:this.columns,pagination:{pageSize:10},dataSource:this.getDataSource()}),a.createElement(de.a,{title:"".concat(0===(null===(e=i)||void 0===e?void 0:e.id)?"Crea":"Modifica"," utente"),width:640,onClose:this._onClose,visible:o,bodyStyle:{paddingBottom:80}},o?a.createElement(pt,{loggedUserId:(null===(t=this.props.user)||void 0===t?void 0:t.id)||0,user:i,onCancel:this._onClose,onSave:this._onSave}):void 0),o?void 0:a.createElement(me,{onClick:this._onCreate})))}}]),t}(a.Component)),wt=Object(x.b)((function(e,t){return{user:e.appData.user,connector:e.appData.connector,committee:e.appData.committee,users:e.appData.users}}),{setUsersData:u})(Dt),Ct=q.a.Option,Tt=function(e){function t(){var e,n;Object(b.a)(this,t);for(var a=arguments.length,r=new Array(a),i=0;i<a;i++)r[i]=arguments[i];return(n=Object(_.a)(this,(e=Object(U.a)(t)).call.apply(e,[this].concat(r)))).handleSubmit=function(e){e.preventDefault(),n.props.form.validateFields((function(e,t){if(!e){var a=n.props.vehicle,r=Object(s.a)({},t,{id:a.id,committeeId:a.committeeId,committee:a.committee});n.props.onSave(r)}}))},n}return Object(I.a)(t,e),Object(g.a)(t,[{key:"componentWillReceiveProps",value:function(e){var t=e.vehicle;void 0!==t&&JSON.stringify(this.props.vehicle)!==JSON.stringify(e.vehicle)&&e.form.setFieldsValue({type:t.type,plate:t.plate,sign:t.sign,description:t.description,disabled:t.disabled})}},{key:"render",value:function(){var e,t=this.props.form.getFieldDecorator;return a.createElement(de.a,{title:"".concat(0===(null===(e=this.props.vehicle)||void 0===e?void 0:e.id)?"Crea":"Modifica"," veicolo"),width:480,onClose:this.props.onClose,visible:this.props.visible,bodyStyle:{paddingBottom:80}},a.createElement(G.a,{layout:"vertical",onSubmit:this.handleSubmit},a.createElement(Z.a,{gutter:16},a.createElement($.a,{span:24},a.createElement(G.a.Item,{label:"Tipo"},t("type",{rules:[{required:!0,message:"Specificare il tipo"}],initialValue:"0"})(a.createElement(q.a,{placeholder:"Tipologia"},a.createElement(Ct,{value:0},De[0]),a.createElement(Ct,{value:1},De[1]),a.createElement(Ct,{value:2},De[2])))))),a.createElement(Z.a,{gutter:16},a.createElement($.a,{span:24},a.createElement(G.a.Item,{label:"Targa"},t("plate",{rules:[{required:!0,message:"Specificare la targa"}]})(a.createElement(Q.a,{placeholder:"Specificare la targa"}))))),a.createElement(Z.a,{gutter:16},a.createElement($.a,{span:24},a.createElement(G.a.Item,{label:"Sigla"},t("sign",{rules:[{required:!1,message:"Specificare la sigla"}]})(a.createElement(Q.a,{placeholder:"Specificare una sigla"}))))),a.createElement(Z.a,{gutter:16},a.createElement($.a,{span:24},a.createElement(G.a.Item,{label:"Descrizione"},t("description",{rules:[{required:!1}]})(a.createElement(Q.a.TextArea,{rows:4,placeholder:"Specificare una descrizione"}))))),a.createElement(Z.a,null,a.createElement($.a,{span:12},a.createElement(G.a.Item,{label:"Disabilita"},t("disabled",{valuePropName:"checked"})(a.createElement(be.a,null))))),a.createElement("div",{style:{position:"absolute",right:0,bottom:0,width:"100%",borderTop:"1px solid #e9e9e9",padding:"10px 16px",background:"#fff",textAlign:"right"}},a.createElement(ee.a,{onClick:this.props.onClose,style:{marginRight:8}},"Annulla"),a.createElement(ee.a,{htmlType:"submit",type:"primary"},"Salva"))))}}]),t}(a.Component),jt=G.a.create({name:"vehicle_form "})(Tt),xt=function(e){function t(){return Object(b.a)(this,t),Object(_.a)(this,Object(U.a)(t).apply(this,arguments))}return Object(I.a)(t,e),Object(g.a)(t,[{key:"render",value:function(){return a.createElement(jt,this.props)}}]),t}(a.Component),_t=function(e){function t(){var e,n,r;Object(b.a)(this,t);for(var i=arguments.length,o=new Array(i),c=0;c<i;c++)o[c]=arguments[c];return(r=Object(_.a)(this,(e=Object(U.a)(t)).call.apply(e,[this].concat(o)))).columns=[{title:"Targa",dataIndex:"plate",key:"plate"},{title:"Sigla",dataIndex:"sign",key:"sign"},{title:"Tipologia",dataIndex:"type",key:"type",render:function(e,t){return a.createElement("span",null,De[e])}},{title:"Descrizione",dataIndex:"description",key:"description"},{title:"Disabilitato",dataIndex:"disabled",key:"disabled",render:function(e,t){return a.createElement("p",null,0===e?void 0:a.createElement(J.a,{type:"close"}))}},{title:"",key:"action",render:function(e,t){return a.createElement("span",null,a.createElement(Be.a,{title:"Modifica"},a.createElement(ee.a,{size:"small",icon:"edit",onClick:function(){return r._onEditVehicle(t)}})),a.createElement(Ge.a,{placement:"topLeft",title:"Confermare l'eliminazione?",onConfirm:function(){return r._onDeleteVehicle(t)},okText:"Si",cancelText:"No"},a.createElement(ee.a,{size:"small",style:{marginLeft:"1px"},icon:"delete",type:"danger"})))}}],r.emptyVehicle={id:0,type:0,plate:"",sign:"",description:"",disabled:0,committeeId:(null===(n=r.props.committee)||void 0===n?void 0:n.id)||0,committee:r.props.committee},r.state={loading:!0,showForm:!1,selectedVehicle:void 0,vehicles:[]},r.loadData=function(){var e=r.props.committee;void 0!==e&&r.props.connector.getVehicles(e.id).then((function(e){r.setState({vehicles:e.data,loading:!1})})).catch((function(e){r.setState({vehicles:[],loading:!1}),console.error(e)}))},r._onClose=function(){r.setState({showForm:!1,selectedVehicle:void 0})},r._onEditVehicle=function(e){r.setState({selectedVehicle:e,showForm:!0})},r._onDeleteVehicle=function(e){r.props.connector.deleteVehicle(e).then((function(e){r.loadData()}))},r._onSave=function(e){r.publishVehicle(e)},r.publishVehicle=function(e){r.props.connector.publishVehicle(e).then((function(e){K.a.success("Salvataggio completato"),r.setState({showForm:!1,selectedVehicle:void 0},(function(){r.loadData()}))})).catch((function(e){console.error(e),K.a.error("Si \xe8 verificato un errore nel salvataggio")}))},r._onCreate=function(){r.setState({selectedVehicle:r.emptyVehicle,showForm:!0})},r}return Object(I.a)(t,e),Object(g.a)(t,[{key:"componentDidMount",value:function(){this.loadData()}},{key:"render",value:function(){var e=this.state,t=e.loading,n=e.vehicles;return a.createElement("div",null,t?a.createElement("div",{style:{textAlign:"center"}},a.createElement(kt.a,null)," "):a.createElement(Z.a,null,a.createElement(Ot.a,{columns:this.columns,pagination:{pageSize:10},dataSource:n}),a.createElement(xt,{visible:this.state.showForm,vehicle:this.state.selectedVehicle,onClose:this._onClose,onSave:this._onSave}),this.state.showForm?void 0:a.createElement(me,{onClick:this._onCreate})))}}]),t}(a.Component),Ut=Object(x.b)((function(e,t){return{connector:e.appData.connector,committee:e.appData.committee}}))(_t),It=ce.a.Content,At=function(e){function t(e){var n;Object(b.a)(this,t),(n=Object(_.a)(this,Object(U.a)(t).call(this,e)))._onClickLogout=function(){n.props.resetAuthData(),n._onLogout()},n._onLogout=function(){n.props.history.replace(M)};var a=n.props,r=a.user,i=a.committee;return r||i||n._onLogout(),n.state={windowWidth:0,windowHeight:0},n}return Object(I.a)(t,e),Object(g.a)(t,[{key:"componentDidMount",value:function(){this.updateDimensions(),window.addEventListener("resize",this.updateDimensions.bind(this))}},{key:"componentWillUnmount",value:function(){window.removeEventListener("resize",this.updateDimensions.bind(this))}},{key:"updateDimensions",value:function(){var e="undefined"!==typeof window?window.innerWidth:0,t="undefined"!==typeof window?window.innerHeight:0;this.setState({windowWidth:e,windowHeight:t})}},{key:"render",value:function(){var e=this.props,t=e.user,n=e.committee;return r.a.createElement(ce.a,{style:{minHeight:"100vh"}},this.isForDesktop?r.a.createElement(bt,{isUserAdmin:this.isUserAdmin,history:this.props.history}):void 0,r.a.createElement(ce.a,null,r.a.createElement(Et,{committee:n,user:t,onClickLogout:this._onClickLogout}),r.a.createElement(It,{style:{marginTop:"68px"}},r.a.createElement(V.a,{path:R,exact:!0,component:wt}),r.a.createElement(V.a,{path:N,exact:!0,component:Ut}),r.a.createElement(V.a,{path:P,exact:!0,component:dt}),r.a.createElement(V.a,{path:L,component:tt})),this.isForDesktop?void 0:r.a.createElement(St,{isUserAdmin:this.isUserAdmin,history:this.props.history})))}},{key:"isUserAdmin",get:function(){var e=this.props.user;return void 0!==e&&void 0!==e.committeeUser&&(null===e||void 0===e?void 0:e.committeeUser.role)<2}},{key:"isForSmartphone",get:function(){return this.state.windowWidth<=768}},{key:"isForTablet",get:function(){var e=this.state.windowWidth;return e>768&&e<1100}},{key:"isForDesktop",get:function(){return this.state.windowWidth>=1100}}]),t}(r.a.Component),Vt=Object(x.b)((function(e,t){return{user:e.appData.user,committee:e.appData.committee}}),{resetAuthData:m})(At),zt=n(54),Mt=n(198),Ft=(n(535),[{img:"https://zos.alipayobjects.com/rmsportal/dKbkpPXKfvZzWCM.png",title:"Meet hotel",des:"\u4e0d\u662f\u6240\u6709\u7684\u517c\u804c\u6c6a\u90fd\u9700\u8981\u98ce\u5439\u65e5\u6652"},{img:"https://zos.alipayobjects.com/rmsportal/XmwCzSeJiqpkuMB.png",title:"McDonald's invites you",des:"\u4e0d\u662f\u6240\u6709\u7684\u517c\u804c\u6c6a\u90fd\u9700\u8981\u98ce\u5439\u65e5\u6652"},{img:"https://zos.alipayobjects.com/rmsportal/hfVtzEhPzTUewPm.png",title:"Eat the week",des:"\u4e0d\u662f\u6240\u6709\u7684\u517c\u804c\u6c6a\u90fd\u9700\u8981\u98ce\u5439\u65e5\u6652"}]),Lt=0,Rt={},Nt=[],Pt=[];function Bt(){for(var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,t=0;t<5;t++){var n=5*e+t,a="Section ".concat(n);Nt.push(a),Rt[a]=a,Pt[n]=[];for(var r=0;r<5;r++){var i="S".concat(n,", R").concat(r);Pt[n].push(i),Rt[i]=i}}Nt=Object(le.a)(Nt),Pt=Object(le.a)(Pt)}var Ht,Wt=function(e){function t(e){var n;Object(b.a)(this,t),(n=Object(_.a)(this,Object(U.a)(t).call(this,e))).lv=void 0,n.onEndReached=function(e){n.state.isLoading&&!n.state.hasMore||(console.log("reach end",e),n.setState({isLoading:!0}),setTimeout((function(){Bt(++Lt),n.setState({dataSource:n.state.dataSource.cloneWithRowsAndSections(Rt,Nt,Pt),isLoading:!1})}),1e3))};var a=new zt.b.DataSource({getRowData:function(e,t,n){return e[n]},getSectionHeaderData:function(e,t){return e[t]},rowHasChanged:function(e,t){return e!==t},sectionHeaderHasChanged:function(e,t){return e!==t}});return n.state={isLoading:!0,hasMore:!1,dataSource:a},n}return Object(I.a)(t,e),Object(g.a)(t,[{key:"componentDidMount",value:function(){var e=this;setTimeout((function(){Bt(),e.setState({dataSource:e.state.dataSource.cloneWithRowsAndSections(Rt,Nt,Pt),isLoading:!1})}),600)}},{key:"render",value:function(){var e=this,t=Ft.length-1,n=this.state.dataSource;return a.createElement(zt.b,{ref:function(t){return e.lv=t},dataSource:n,className:"am-list sticky-list",useBodyScroll:!0,renderSectionWrapper:function(){return a.createElement(Mt.StickyContainer,{key:"s_boooo_c",className:"sticky-container",style:{zIndex:4}})},renderSectionHeader:function(e){return a.createElement(Mt.Sticky,null,(function(t){var n=t.style;return a.createElement("div",{className:"sticky",style:Object(s.a)({},n,{marginTop:"45px",zIndex:4,backgroundColor:parseInt(e.replace("Section ",""),10)%2?"#5890ff":"#F8591A",color:"white"})},"Task ".concat(e.split(" ")[1]))}))},renderFooter:function(){return a.createElement("div",{style:{padding:30,textAlign:"center"}},e.state.isLoading?"Loading...":"Loaded")},renderRow:function(e,n,r){t<0&&(t=Ft.length-1);var i=Ft[t--];return a.createElement("div",{key:r,style:{padding:"0 15px"}},a.createElement("div",{style:{lineHeight:"50px",color:"#888",fontSize:18,borderBottom:"1px solid #F6F6F6"}},i.title),a.createElement("div",{style:{display:"-webkit-box",padding:"15px 0"}},a.createElement("img",{style:{height:"64px",marginRight:"15px"},src:i.img,alt:""}),a.createElement("div",{style:{lineHeight:1}},a.createElement("div",{style:{marginBottom:"8px",fontWeight:"bold"}},i.des),a.createElement("div",null,a.createElement("span",{style:{fontSize:"30px",color:"#FF6E27"}},"35"),"\xa5 ",r))))},renderSeparator:function(e,t){return a.createElement("div",{key:"".concat(e,"-").concat(t),style:{backgroundColor:"#F5F5F9",height:8,borderTop:"1px solid #ECECED",borderBottom:"1px solid #ECECED"}})},pageSize:4,onScroll:function(){console.log("scroll")},scrollEventThrottle:200,onEndReached:this.onEndReached,onEndReachedThreshold:10})}}]),t}(a.Component),Yt=Object(x.b)((function(e){return{user:e.appData.user,connector:e.appData.connector,committee:e.appData.committee}}),{setUserData:p})(Wt),qt=function(e){function t(){return Object(b.a)(this,t),Object(_.a)(this,Object(U.a)(t).apply(this,arguments))}return Object(I.a)(t,e),Object(g.a)(t,[{key:"render",value:function(){return a.createElement("div",null,"Booked services MOBILE!!!!")}}]),t}(a.Component),Jt=Object(x.b)((function(e){return{user:e.appData.user,connector:e.appData.connector,committee:e.appData.committee}}),{setUserData:p})(qt),Gt=zt.c.alert,Kt=zt.e.Item;!function(e){e.Logout="1"}(Ht||(Ht={}));var Xt=function(e){function t(e){var n;return Object(b.a)(this,t),(n=Object(_.a)(this,Object(U.a)(t).call(this,e)))._onClickVisibleChange=function(e){e.preventDefault(),n.setState({hidden:!n.state.hidden})},n._onClickLogout=function(){n.props.resetAuthData(),n.props.history.replace({pathname:M,search:"?layout=mobile"})},n._onSelectRightTopMenu=function(e,t){switch(e.key){case Ht.Logout:Gt("Attenzione","Sicuro di voler uscire?",[{text:"Annulla",onPress:function(){}},{text:"Ok",onPress:function(){return n._onClickLogout()}}])}n.setState({rightTopMenuVisible:!1})},n._rightTopMenuVisibleChange=function(e){n.setState({rightTopMenuVisible:e})},n.state={selectedTab:"servicesTab",hidden:!1,rightTopMenuVisible:!1},n}return Object(I.a)(t,e),Object(g.a)(t,[{key:"renderTabContent",value:function(){return r.a.createElement("div",{style:{height:"100%",textAlign:"center"}},r.a.createElement(V.a,{path:W,component:Jt}),r.a.createElement(V.a,{path:H,component:Yt}),r.a.createElement(V.a,{path:Y,exact:!0,component:dt}))}},{key:"render",value:function(){var e=this;return r.a.createElement("div",null,r.a.createElement(zt.d,{mode:"dark",leftContent:r.a.createElement("span",{style:{fontSize:"10px"}},"Servizio Facile v.1.0"),rightContent:r.a.createElement(zt.e,{visible:this.state.rightTopMenuVisible,overlay:[r.a.createElement(Kt,{key:Ht.Logout},"Logout")],onVisibleChange:this._rightTopMenuVisibleChange,onSelect:this._onSelectRightTopMenu},r.a.createElement("div",{style:{height:"100%",padding:"0 15px",marginRight:"-15px",display:"flex",alignItems:"center"}},r.a.createElement(zt.a,{type:"ellipsis"})))}),r.a.createElement("div",{style:{position:"fixed",height:"calc(100% - 45px)",width:"100%",top:45}},r.a.createElement(zt.f,{unselectedTintColor:"#949494",tintColor:"#33A3F4",barTintColor:"white",tabBarPosition:"bottom",hidden:this.state.hidden,prerenderingSiblingsNumber:0},r.a.createElement(zt.f.Item,{title:"Servizi disponibili",key:"Servizi",icon:r.a.createElement(J.a,{type:"calendar"}),selectedIcon:r.a.createElement(J.a,{type:"calendar"}),selected:"servicesTab"===this.state.selectedTab,onPress:function(){e.setState({selectedTab:"servicesTab"},(function(){return e.props.history.replace(H)}))},"data-seed":"logId"},this.renderTabContent()),r.a.createElement(zt.f.Item,{title:"Servizi prenotati",key:"booked_services",icon:r.a.createElement(J.a,{type:"book"}),selectedIcon:r.a.createElement(J.a,{type:"book"}),selected:"bookedServicesTab"===this.state.selectedTab,onPress:function(){e.setState({selectedTab:"bookedServicesTab"},(function(){return e.props.history.replace(W)}))},"data-seed":"logId1"},this.renderTabContent()),r.a.createElement(zt.f.Item,{title:"Area personale",key:"personal_area",icon:r.a.createElement(J.a,{type:"user"}),selectedIcon:r.a.createElement(J.a,{type:"user"}),selected:"personalAreaTab"===this.state.selectedTab,onPress:function(){e.setState({selectedTab:"personalAreaTab"},(function(){return e.props.history.replace(Y)}))},"data-seed":"logId2"},this.renderTabContent()))))}}]),t}(r.a.Component),Zt=Object(x.b)((function(e,t){return{user:e.appData.user,committee:e.appData.committee}}),{resetAuthData:m})(Xt),$t=function(e){function t(){return Object(b.a)(this,t),Object(_.a)(this,Object(U.a)(t).apply(this,arguments))}return Object(I.a)(t,e),Object(g.a)(t,[{key:"render",value:function(){return r.a.createElement(A.a,null,r.a.createElement(V.c,null,r.a.createElement(V.a,{exact:!0,path:z,component:oe}),r.a.createElement(V.a,{path:F,component:Vt}),r.a.createElement(V.a,{path:B,component:Zt})))}}]),t}(r.a.Component);function Qt(){return Object(l.c)(j)}n.d(t,"configureStore",(function(){return Qt})),o.a.render(r.a.createElement(x.a,{store:Qt()},r.a.createElement($t,null)),document.getElementById("root")),"serviceWorker"in navigator&&navigator.serviceWorker.ready.then((function(e){e.unregister()}))}},[[272,1,2]]]);
//# sourceMappingURL=main.bb177706.chunk.js.map