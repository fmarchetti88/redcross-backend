(this["webpackJsonpredcross-portal"]=this["webpackJsonpredcross-portal"]||[]).push([[0],{279:function(e,t,r){e.exports=r(547)},284:function(e,t,r){},541:function(e,t,r){},547:function(e,t,r){"use strict";r.r(t);var n=r(0),a=r.n(n),i=r(9),o=r.n(i);r(284),Boolean("localhost"===window.location.hostname||"[::1]"===window.location.hostname||window.location.hostname.match(/^127(?:\.(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)){3}$/));r(285),r(286);var l,s=r(98),c=r(35);function u(e){return{type:l.SET_USERS_DATA,data:{users:e}}}function p(e,t){return{type:l.SET_USER_DATA,data:{user:e,committeeId:t}}}function d(){return{type:l.RESET_AUTH_DATA}}!function(e){e.SET_SHOW_LOADING="SET_SHOW_LOADING",e.SET_USER_DATA="SET_USER_DATA",e.SET_ACCESS_TOKEN="SET_ACCESS_TOKEN",e.SET_COMMITTEE_DATA="SET_COMMITTEE_DATA",e.RESET_AUTH_DATA="RESET_AUTH_DATA",e.SET_USERS_DATA="SET_USERS_DATA"}(l||(l={}));var m,h=r(19),f=r.n(h),v=r(36),g=r(13),b=r(14),E=r(161),y=r.n(E);!function(e){e[e.week=0]="week",e[e.month=1]="month"}(m||(m={}));var w,S=["Domenica","Luned\xec","Marted\xec","Mercoled\xec","Gioved\xec","Venerd\xec","Sabato"],k=["Gennaio","Febbraio","Marzo","Aprile","Maggio","Giugno","Luglio","Agosto","Settembre","Ottobre","Novembre","Dicembre"],C=function(){var e=localStorage.getItem("redcross-logged-userinfo");if(e)return JSON.parse(e)},O=function(){localStorage.removeItem("redcross-logged-userinfo")},D=function(e,t,r){return t.filter((function(t){return new Date(t.date).setHours(0,0,0,0)===e.setHours(0,0,0,0)})).filter((function(e){return T(e,r)})).sort((function(e,t){var r=e.hour.split(":").join(""),n=t.hour.split(":").join("");return Number(r)-Number(n)}))},T=function(e,t){if(void 0!==t&&void 0!==t.committeeUser){var r=t.committeeUser.occupation;return 0===r||2===r||e.type>0}return!1},x=function(e,t){if(0===e.role)return-1;if(2===e.role){if(0===t.role)return 1;if(1===t.role)return-1}return 1},j=function(e){return 0===e?"#d9d9d9":2===e?"#1890ff":"#87d068"},_=function(){function e(){Object(g.a)(this,e),this.axiosInstance=void 0,this.authHeader=function(){var e=C();return e&&e.accessToken?{"x-access-token":e.accessToken}:{}};var t=void 0;t=window.location.origin,this.axiosInstance=y.a.create({baseURL:t,headers:{"Content-Type":"application/json"}})}return Object(b.a)(e,[{key:"getCommittees",value:function(){var e=Object(v.a)(f.a.mark((function e(){return f.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return"api/committees",e.next=3,this.call("api/committees");case 3:return e.abrupt("return",e.sent);case 4:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"getVehicles",value:function(){var e=Object(v.a)(f.a.mark((function e(t){var r;return f.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r="api/vehicles/findByCommittee/".concat(t),e.next=3,this.call(r);case 3:return e.abrupt("return",e.sent);case 4:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"publishVehicle",value:function(){var e=Object(v.a)(f.a.mark((function e(t){var r,n,a;return f.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r=t.id,n="api/vehicles/".concat(r>0?r:""),a=JSON.stringify(t),e.next=5,this.call(n,a,r>0?"PUT":"POST");case 5:return e.abrupt("return",e.sent);case 6:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"deleteVehicle",value:function(){var e=Object(v.a)(f.a.mark((function e(t){var r,n;return f.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r=t.id,n="api/vehicles/".concat(r),e.next=4,this.call(n,void 0,"DELETE");case 4:return e.abrupt("return",e.sent);case 5:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"deleteTripUsersByTrip",value:function(){var e=Object(v.a)(f.a.mark((function e(t){var r;return f.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r="api/trips_users/deleteByTrip/".concat(t),e.next=3,this.call(r,void 0,"DELETE");case 3:return e.abrupt("return",e.sent);case 4:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"deleteTripUsers",value:function(){var e=Object(v.a)(f.a.mark((function e(t){var r;return f.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r="api/trips_users/".concat(t),e.next=3,this.call(r,void 0,"DELETE");case 3:return e.abrupt("return",e.sent);case 4:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"deleteCommitteesUsers",value:function(){var e=Object(v.a)(f.a.mark((function e(t){var r;return f.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r="api/committees_users/deleteByUserId/".concat(t),e.next=3,this.call(r,void 0,"DELETE");case 3:return e.abrupt("return",e.sent);case 4:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"getUserTrips",value:function(){var e=Object(v.a)(f.a.mark((function e(t){var r;return f.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r="api/trips_users/findByUserId/".concat(t),e.next=3,this.call(r);case 3:return e.abrupt("return",e.sent);case 4:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"deleteTrip",value:function(){var e=Object(v.a)(f.a.mark((function e(t){var r;return f.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r="api/trips/".concat(t),e.next=3,this.call(r,void 0,"DELETE");case 3:return e.abrupt("return",e.sent);case 4:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"getTrips",value:function(){var e=Object(v.a)(f.a.mark((function e(t){var r;return f.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r="api/trips/findByCommittee/".concat(t),e.next=3,this.call(r);case 3:return e.abrupt("return",e.sent);case 4:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"getAvailableTrips",value:function(){var e=Object(v.a)(f.a.mark((function e(){return f.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return"api/trips/available",e.next=3,this.call("api/trips/available");case 3:return e.abrupt("return",e.sent);case 4:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"getBookedTrips",value:function(){var e=Object(v.a)(f.a.mark((function e(){return f.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return"api/trips/booked",e.next=3,this.call("api/trips/booked");case 3:return e.abrupt("return",e.sent);case 4:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"publishTrip",value:function(){var e=Object(v.a)(f.a.mark((function e(t){var r,n,a;return f.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r=t.id,n="api/trips/".concat(r>0?r:""),a=JSON.stringify(t),e.next=5,this.call(n,a,r>0?"PUT":"POST");case 5:return e.abrupt("return",e.sent);case 6:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"publishTripUser",value:function(){var e=Object(v.a)(f.a.mark((function e(t){var r,n,a;return f.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r=t.id,n="api/trips_users/".concat(r>0?r:""),a=JSON.stringify(t),e.next=5,this.call(n,a,r>0?"PUT":"POST");case 5:return e.abrupt("return",e.sent);case 6:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"getUser",value:function(){var e=Object(v.a)(f.a.mark((function e(t){var r;return f.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r="api/users/".concat(t),e.next=3,this.call(r);case 3:return e.abrupt("return",e.sent);case 4:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"getUsers",value:function(){var e=Object(v.a)(f.a.mark((function e(t){var r;return f.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r="api/users/findByCommittee/".concat(t),e.next=3,this.call(r);case 3:return e.abrupt("return",e.sent);case 4:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"deleteUser",value:function(){var e=Object(v.a)(f.a.mark((function e(t){var r;return f.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r="api/users/".concat(t),e.next=3,this.call(r,void 0,"DELETE");case 3:return e.abrupt("return",e.sent);case 4:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"deleteCommitteeUser",value:function(){var e=Object(v.a)(f.a.mark((function e(t){var r;return f.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r="api/committees_users/".concat(t),e.next=3,this.call(r,void 0,"DELETE");case 3:return e.abrupt("return",e.sent);case 4:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"modifyPassword",value:function(){var e=Object(v.a)(f.a.mark((function e(t,r){var n;return f.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return"api/users/modifypassword",n=JSON.stringify({oldPassword:t,newPassword:r}),e.next=4,this.call("api/users/modifypassword",n,"POST");case 4:return e.abrupt("return",e.sent);case 5:case"end":return e.stop()}}),e,this)})));return function(t,r){return e.apply(this,arguments)}}()},{key:"publishUser",value:function(){var e=Object(v.a)(f.a.mark((function e(t){var r,n,a;return f.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r=t.id,n="api/users/".concat(r>0?r:""),a=JSON.stringify(t),e.abrupt("return",this.call(n,a,r>0?"PUT":"POST"));case 4:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"publishUserCommittee",value:function(){var e=Object(v.a)(f.a.mark((function e(t,r){var n,a,i,o,l,s;return f.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.publishUser(t);case 2:if(201===(n=e.sent).status||200===n.status){e.next=6;break}throw console.log(n),new Error("Si \xe8 verificato un errore nell'inserimento");case 6:return a=t.id,i=n.data,o={id:r.id,userId:a>0?a:i.id,committeeId:r.committeeId,role:r.role,occupation:r.occupation,disabled:r.disabled},l=JSON.stringify(o),s="api/committees_users/".concat(r.id>0?r.id:""),e.next=13,this.call(s,l,r.id>0?"PUT":"POST");case 13:return e.abrupt("return",e.sent);case 14:case"end":return e.stop()}}),e,this)})));return function(t,r){return e.apply(this,arguments)}}()},{key:"signin",value:function(){var e=Object(v.a)(f.a.mark((function e(t,r,n){var a;return f.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return void 0,a=y.a.create({baseURL:void 0}),e.abrupt("return",a({url:"api/auth/signin",method:"POST",data:{username:t,password:r,committeeId:n}}));case 4:case"end":return e.stop()}}),e)})));return function(t,r,n){return e.apply(this,arguments)}}()},{key:"findUserByUsername",value:function(){var e=Object(v.a)(f.a.mark((function e(t,r){var n,a,i,o;return f.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n="api/users/findbyusername/".concat(t),a=btoa("".concat(t,":").concat(r)),i={Authorization:"Basic ".concat(a)},void 0,o=y.a.create({baseURL:void 0,headers:i}),e.abrupt("return",o({url:n,method:"GET"}));case 7:case"end":return e.stop()}}),e)})));return function(t,r){return e.apply(this,arguments)}}()},{key:"call",value:function(){var e=Object(v.a)(f.a.mark((function e(t,r){var n,a=arguments;return f.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=a.length>2&&void 0!==a[2]?a[2]:"GET",e.abrupt("return",this.axiosInstance({url:t,method:n,headers:this.authHeader(),data:r}));case 2:case"end":return e.stop()}}),e,this)})));return function(t,r){return e.apply(this,arguments)}}()}]),e}(),I={user:void 0,accessToken:"",committee:void 0,users:[],connector:new _,showLoading:!1},U=Object(s.b)({appData:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:I,t=arguments.length>1?arguments[1]:void 0;switch(t.type){case l.SET_ACCESS_TOKEN:var r=t.data.accessToken,n=new _;return Object(c.a)({},e,{accessToken:r,connector:n});case l.SET_USER_DATA:var a=t.data,i=a.user,o=a.committeeId,s=i&&Object(c.a)({},i)||void 0;i&&i.committee_users&&(s=Object(c.a)({},i,{committeeUser:i.committee_users.find((function(e){return e.committeeId===o}))}));var u=Object(c.a)({},e,{user:s});return u;case l.SET_COMMITTEE_DATA:var p=t.data.committee;return Object(c.a)({},e,{committee:p});case l.SET_SHOW_LOADING:return Object(c.a)({},e,{showLoading:t.data});case l.RESET_AUTH_DATA:return O(),Object(c.a)({},e,{user:void 0,committee:void 0,connector:new _,accessToken:"",users:[]});case l.SET_USERS_DATA:var d=t.data.users,m=(d||[]).map((function(e){return Object(c.a)({},e,{committeeUser:e.committee_users[0]})}));return Object(c.a)({},e,{users:m});default:return e}}}),A=r(42),V=r(17),F=r(16),P=r(18),z=r(143),M=r(81),L="/",B="/desktop",N="/desktop/services",R="/desktop/users",H="/desktop/vehicles",W="/desktop/personal_area",Y="/mobile",q="/mobile/services",G="/mobile/booked_services",J="/mobile/personal_area",K=r(124),$=r(11),Q=r(559),X=r(561),Z=r(558),ee=r(109),te=r(63),re=r(557),ne=r(46),ae=K.a.Option,ie=function(e){function t(e){var r;Object(g.a)(this,t),(r=Object(V.a)(this,Object(F.a)(t).call(this,e))).connector=void 0,r.handleSelectChange=function(e){r.props.form.setFieldsValue({committeeId:e})},r.buildCommitteesSelect=function(){var e=r.state.committees;if(0===e.length)return n.createElement($.a,{type:"loading"});var t=r.props.form.getFieldDecorator;return n.createElement(Q.a.Item,null,t("committeeId",{rules:[{required:!0,message:"Selezionare il comitato"}]})(n.createElement(K.a,{onChange:r.handleSelectChange},e.map((function(e){return n.createElement(ae,{key:e.id,value:e.id},e.description)})))))},r.login=function(e,t){var n=r.props.connector,a=r.state.isForMobile;n.getUser(e).then((function(e){var n=e.data,i=n.committee_users;if(i){var o=i.find((function(e){return e.committeeId===t}));o&&1!==o.disabled?(r.props.setUserData(n,t),r.props.setCommitteeData(o.committee),r.props.connector.getUsers(t).then((function(e){X.a.success("Benvenuto ".concat(n.username)),r.props.setUsersData(e.data),r.props.history.replace(a?q:N)})).catch((function(e){X.a.error("Si \xe8 verificato un errore nel recupero degli utenti")}))):X.a.error("Utente non abilitato al comitato selezionato")}else X.a.error("Utente non abilitato al comitato selezionato")})).catch((function(e){console.log(e),X.a.error("Si \xe8 verificato un errore. Contattare l'amministratore di sistema.")}))},r.handleSubmit=function(e){e.preventDefault(),r.props.form.validateFields((function(e,t){e||r.setState({loading:!0},(function(){var e=t.committeeId,n=t.username,a=t.password;r.props.connector.signin(n,a,e).then((function(e){var t,n=e.data,a=n.id,i=n.committeeId;t=e.data,localStorage.setItem("redcross-logged-userinfo",JSON.stringify(t)),r.setState({loading:!1},(function(){return r.login(a,i)}))})).catch((function(e){var t="Username e password non validi",n=e.response;if(n){var a=n.data;a&&(t=a.message)}r.setState({loading:!1},(function(){return X.a.error(t)})),console.error(e)}))}))}))};var a=!1,i=r.props.location;void 0!==i&&(a=i.pathname===Y,r.state={committees:[],isForMobile:a,loading:!1});return r}return Object(P.a)(t,e),Object(b.a)(t,[{key:"componentDidMount",value:function(){var e=this,t=C();t&&this.login(t.id,t.committeeId),this.props.connector.getCommittees().then((function(t){e.setState(Object(c.a)({},e.state,{committees:t.data}),(function(){t.data&&t.data[0]&&e.handleSelectChange(t.data[0].id)}))})).catch((function(e){console.log(e)}))}},{key:"render",value:function(){var e=this.props.form.getFieldDecorator,t=this.state,r=t.committees,a=t.isForMobile;return n.createElement(Z.a,{visible:!0,closable:!1,confirmLoading:!1,footer:null},n.createElement("div",{style:{textAlign:"right"}},n.createElement("b",null,"Servizio Facile v.1.0"),a?n.createElement($.a,{type:"mobile"}):void 0),n.createElement(ee.a,{gutter:8},n.createElement(te.a,{span:24},n.createElement("img",{alt:"",src:"/red_cross_logo.png",width:"100%"}))),n.createElement(Q.a,{onSubmit:this.handleSubmit,className:"login-form"},n.createElement(Q.a.Item,null,e("username",{rules:[{required:!0,message:"Username obbligatoria"}]})(n.createElement(re.a,{prefix:n.createElement($.a,{type:"user",style:{color:"rgba(0,0,0,.25)"}}),placeholder:"Digitare il proprio username"}))),n.createElement(Q.a.Item,null,e("password",{rules:[{required:!0,message:"Password obbligatoria"}]})(n.createElement(re.a,{prefix:n.createElement($.a,{type:"lock",style:{color:"rgba(0,0,0,.25)"}}),type:"password",placeholder:"Digitare la propria password"}))),this.buildCommitteesSelect(),n.createElement(Q.a.Item,null,n.createElement(ne.a,{loading:this.state.loading,disabled:null===r||void 0===r||0===r.length,type:"primary",htmlType:"submit",style:{width:"100%"},className:"login-form-button"},"Log in"))))}}]),t}(n.Component),oe=Q.a.create({name:"normal_login"})(ie),le=Object(A.b)((function(e,t){return{user:e.appData.user,connector:e.appData.connector}}),{setUserData:p,setAccessToken:function(e){return{type:l.SET_ACCESS_TOKEN,data:{accessToken:e}}},setCommitteeData:function(e){return{type:l.SET_COMMITTEE_DATA,data:{committee:e}}},setUsersData:u})(oe),se=r(552),ce=r(56),ue=r(554),pe=r(562),de=r(272),me=function(e){function t(){return Object(g.a)(this,t),Object(V.a)(this,Object(F.a)(t).apply(this,arguments))}return Object(P.a)(t,e),Object(b.a)(t,[{key:"render",value:function(){return n.createElement(de.a,{mainButtonStyles:{backgroundColor:"#1890ff"},alwaysShowTitle:!1,event:"click",icon:n.createElement("span",null,"+"),position:{bottom:5,right:5},onClick:this.props.onClick})}}]),t}(n.Component),he=r(560),fe=r(555),ve=r(273),ge=r(155),be=r(548),Ee=r(563),ye={0:"Solo Dipendenti",1:"Dipendenti e Volontari"},we={0:"In Sede",1:"Destinazione",2:"Prelevamento"},Se={0:"Solo Andata",1:"Andata/Ritorno"},ke=r(20),Ce=r.n(ke),Oe={0:"Furgone",1:"Ambulanza",2:"Autovettura"},De=K.a.Option,Te=function(e){function t(){var e,r;Object(g.a)(this,t);for(var a=arguments.length,i=new Array(a),o=0;o<a;o++)i[o]=arguments[o];return(r=Object(V.a)(this,(e=Object(F.a)(t)).call.apply(e,[this].concat(i)))).setFieldsValue=function(e){var t=r.props.form,n=new Date(2e3,1,1,e.hour?Number(e.hour.substring(0,2)):12,e.hour?Number(e.hour.substring(3,5)):0),a=Object(c.a)({},e,{tripDate:e.date?Ce()(e.date):void 0,tripHour:Ce()(n)});t.setFieldsValue(a)},r.handleSubmit=function(e){e.preventDefault(),r.props.form.validateFields((function(e,t){if(!e){var n=t.vehicleId,a=Object(c.a)({},t,{vehicleId:void 0===n?null:n,date:t.tripDate?t.tripDate.format("YYYY-MM-DD"):void 0,hour:t.tripHour.format("HH:mm")});r.props.onSave(a)}}))},r.buildVehicleOptions=function(){var e=r.props.vehicles.map((function(e){var t=e.id;return n.createElement(De,{key:t,value:e.id},e.sign," - ",Oe[e.type])}));return[n.createElement(De,{key:-1,value:void 0},n.createElement("div",null,"\xa0"))].concat(Object(ce.a)(e))},r}return Object(P.a)(t,e),Object(b.a)(t,[{key:"componentWillReceiveProps",value:function(e){var t=e.trip;void 0!==t&&JSON.stringify(this.props.trip)!==JSON.stringify(e.trip)&&this.setFieldsValue(t)}},{key:"render",value:function(){var e=this.props.form.getFieldDecorator,t=this.props,r=t.trip,a=t.onClose,i=t.visible;return n.createElement(he.a,{title:"".concat(0===(null===r||void 0===r?void 0:r.id)?"Crea":"Modifica"," servizio"),width:480,onClose:a,visible:i,bodyStyle:{paddingBottom:80}},n.createElement(Q.a,{layout:"vertical",onSubmit:this.handleSubmit},n.createElement(ee.a,{gutter:16},n.createElement(te.a,{span:8},n.createElement(Q.a.Item,{label:"Data del servizio"},e("tripDate",{rules:[{required:!0,message:"Specificare data di partenza"}]})(n.createElement(fe.a,{style:{width:"100%"},format:"DD-MM-YYYY"})))),n.createElement(te.a,{span:8},n.createElement(Q.a.Item,{label:"Ora"},e("tripHour",{rules:[{type:"object",required:!0,message:"Specificare l'ora del servizio"}]})(n.createElement(ve.a,{style:{width:"100%"},placeholder:"Ora servizio",format:"HH:mm"})))),n.createElement(te.a,{span:8},n.createElement(Q.a.Item,{label:"Luogo"},e("flgDestination",{rules:[{required:!0,message:"Specificare il luogo"}]})(n.createElement(K.a,{placeholder:"Luogo"},n.createElement(De,{value:0},we[0]),n.createElement(De,{value:1},we[1]),n.createElement(De,{value:2},we[2])))))),n.createElement(ee.a,{gutter:16},n.createElement(te.a,{span:12},n.createElement(Q.a.Item,{label:"Partenza"},e("siteDeparture",{rules:[{required:!0,message:"Specificare il luogo di partenza"}]})(n.createElement(re.a.TextArea,{rows:4,placeholder:"Luogo di partenza"})))),n.createElement(te.a,{span:12},n.createElement(Q.a.Item,{label:"Arrivo"},e("siteArrival",{rules:[{required:!0,message:"Specificare il luogo di arrivo"}]})(n.createElement(re.a.TextArea,{rows:4,placeholder:"Luogo di arrivo"}))))),n.createElement(ee.a,{gutter:16},n.createElement(te.a,{span:8},n.createElement(Q.a.Item,{label:"Veicolo"},e("vehicleId")(n.createElement(K.a,null,this.buildVehicleOptions())))),n.createElement(te.a,{span:8},n.createElement(Q.a.Item,null,e("flgAr")(n.createElement(ge.a.Group,{style:{marginTop:"10px"}},n.createElement(ge.a,{value:0},Se[0]),n.createElement(ge.a,{value:1},Se[1]))))),n.createElement(te.a,{span:8},n.createElement(Q.a.Item,{label:"Servizio per"},e("type",{rules:[{required:!0,message:"Specificare il tipo"}]})(n.createElement(K.a,{placeholder:"Servizio per"},n.createElement(De,{value:0},ye[0]),n.createElement(De,{value:1},ye[1])))))),n.createElement(ee.a,{gutter:16},n.createElement(te.a,{span:8},n.createElement(Q.a.Item,{label:"Tipologia servizio"},e("serviceType",{rules:[{required:!0,message:"Specificare il tipo di servizio"}]})(n.createElement(re.a.TextArea,{rows:2,placeholder:"Tipologia servizio"})))),n.createElement(te.a,{span:8},n.createElement(Q.a.Item,{label:"Dati paziente"},e("patientData")(n.createElement(re.a.TextArea,{rows:2,placeholder:"Dati paziente"})))),n.createElement(te.a,{span:8},n.createElement(Q.a.Item,{label:"Medico/sanitario"},e("flgNurse",{valuePropName:"checked"})(n.createElement(be.a,null))))),n.createElement(ee.a,{gutter:16},n.createElement(te.a,{span:8},n.createElement(Q.a.Item,{label:"Note"},e("notes")(n.createElement(re.a.TextArea,{rows:3,placeholder:"Eventuali note aggiuntive"})))),n.createElement(te.a,{span:8},n.createElement(Q.a.Item,{label:"Numero accompagnatori"},e("extraUsers",{initialValue:1})(n.createElement(Ee.a,{min:0,max:10})))),n.createElement(te.a,{span:8},n.createElement(Q.a.Item,{label:"Da notificare"},e("flgToNotify",{valuePropName:"checked"})(n.createElement(be.a,null))))),n.createElement(ee.a,{gutter:16,style:{visibility:"collapse"}},n.createElement(te.a,{span:6},n.createElement(Q.a.Item,{label:"Id"},e("id")(n.createElement(re.a,{placeholder:"Specificare id servizio"}))),n.createElement(te.a,{span:6},n.createElement(Q.a.Item,{label:"CommitteeId"},e("committeeId")(n.createElement(re.a,{placeholder:"CommitteeId"})))))),n.createElement("div",{style:{position:"absolute",right:0,bottom:0,width:"100%",borderTop:"1px solid #e9e9e9",padding:"10px 16px",background:"#fff",textAlign:"right"}},n.createElement(ne.a,{onClick:this.props.onClose,style:{marginRight:8}},"Annulla"),n.createElement(ne.a,{htmlType:"submit",type:"primary"},"Salva"))))}}]),t}(n.Component),xe=Q.a.create({name:"trip_form "})(Te),je=function(e){function t(){return Object(g.a)(this,t),Object(V.a)(this,Object(F.a)(t).apply(this,arguments))}return Object(P.a)(t,e),Object(b.a)(t,[{key:"render",value:function(){return n.createElement(xe,this.props)}}]),t}(n.Component),_e=r(110),Ie=r.n(_e),Ue=0,Ae=function(e){function t(){var e,r;Object(g.a)(this,t);for(var n=arguments.length,a=new Array(n),i=0;i<n;i++)a[i]=arguments[i];return(r=Object(V.a)(this,(e=Object(F.a)(t)).call.apply(e,[this].concat(a)))).onDeleteDate=function(e){var t=r.props.form,n=t.getFieldValue("keys"),a=t.getFieldValue("duplicateElements")||[];1!==n.length&&t.setFieldsValue({keys:n.filter((function(t){return t!==e})),duplicateElements:a.filter((function(t,r){return r!==e}))})},r.onAddDate=function(){var e=r.props.form,t=e.getFieldValue("keys").concat(Ue++);e.setFieldsValue({keys:t})},r.handleSubmit=function(e){e.preventDefault(),r.props.form.validateFields((function(e,t){if(!e){var n=t.duplicateElements,a=r.props.trip;r.props.onConfirm(a,n.filter((function(e){return!!e})))}}))},r.getInitialDateValue=function(e){var t=r.props.trip;return Ce()(void 0!==t?t.date:new Date).add(e+1,"d")},r.getInitialHourValue=function(){var e=r.props.trip,t=new Date(2e3,1,1,(null===e||void 0===e?void 0:e.hour)?Number(e.hour.substring(0,2)):12,(null===e||void 0===e?void 0:e.hour)?Number(e.hour.substring(3,5)):0);return Ce()(t)},r}return Object(P.a)(t,e),Object(b.a)(t,[{key:"componentWillReceiveProps",value:function(e){void 0!==e.trip&&JSON.stringify(this.props.trip)!==JSON.stringify(e.trip)&&this.props.form.setFieldsValue({keys:[],duplicateElements:[]})}},{key:"render",value:function(){var e=this,t=this.props.form,r=t.getFieldDecorator,a=t.getFieldValue;r("keys",{initialValue:[]});var i=a("keys").map((function(t,a){return n.createElement(ee.a,{gutter:16,key:a},n.createElement(te.a,{span:11},n.createElement(Ie.a.Item,null,r("duplicateElements[".concat(t,"].date"),{initialValue:e.getInitialDateValue(a),rules:[{required:!0,message:"Selezionare data del viaggio"}]})(n.createElement(fe.a,{style:{width:"100%"},format:"DD-MM-YYYY"})))),n.createElement(te.a,{span:11},n.createElement(Ie.a.Item,null,r("duplicateElements[".concat(t,"].hour"),{initialValue:e.getInitialHourValue(),rules:[{type:"object",required:!0,message:"Specificare l'ora del servizio"}]})(n.createElement(ve.a,{style:{width:"100%"},placeholder:"Ora servizio",format:"HH:mm"})))),n.createElement(te.a,{span:2},0===t?void 0:n.createElement($.a,{style:{marginTop:"10px"},className:"dynamic-delete-button",type:"minus-circle-o",onClick:function(){return e.onDeleteDate(t)}})))}));return n.createElement(he.a,{title:"Duplica servizio",width:480,onClose:this.props.onClose,visible:this.props.visible,bodyStyle:{paddingBottom:80}},n.createElement(Ie.a,{onSubmit:this.handleSubmit},i,n.createElement(ee.a,{gutter:16},n.createElement(te.a,{span:24},n.createElement(Ie.a.Item,null,n.createElement(ne.a,{type:"dashed",onClick:this.onAddDate,style:{width:"100%"}},n.createElement($.a,{type:"plus"})," Aggiungi data")))),n.createElement("div",{style:{position:"absolute",right:0,bottom:0,width:"100%",borderTop:"1px solid #e9e9e9",padding:"10px 16px",background:"#fff",textAlign:"right"}},n.createElement(ne.a,{onClick:this.props.onClose,style:{marginRight:8}},"Annulla"),n.createElement(ne.a,{htmlType:"submit",type:"primary"},"Conferma"))))}}]),t}(n.Component),Ve=Ie.a.create({name:"duplicate_trip_form "})(Ae),Fe=function(e){function t(){return Object(g.a)(this,t),Object(V.a)(this,Object(F.a)(t).apply(this,arguments))}return Object(P.a)(t,e),Object(b.a)(t,[{key:"render",value:function(){return n.createElement(Ve,this.props)}}]),t}(n.Component),Pe=r(565),ze=r(556),Me=new Date,Le=function(e){function t(){return Object(g.a)(this,t),Object(V.a)(this,Object(F.a)(t).apply(this,arguments))}return Object(P.a)(t,e),Object(b.a)(t,[{key:"renderCardHeaderDate",value:function(e){var t=e.getDate(),r=k[e.getMonth()];return n.createElement(ee.a,null,n.createElement(te.a,{style:{textAlign:"left"},span:24},t," ",r.substring(0,3)))}},{key:"renderCardBodyWeekDay",value:function(e){var t=this.props.todayTrips,r=S[e.getDay()];return n.createElement(ee.a,null,n.createElement(te.a,{style:{textAlign:"left"},span:24},n.createElement("b",null,r),0!==t?n.createElement(Pe.a,{count:t,style:{backgroundColor:"#87D068",marginLeft:"3px"}}):void 0))}},{key:"render",value:function(){var e=this.props,t=e.selectedDate,r=e.date,a=e.onClickDayOfWeek,i=r.getDate()===t.getDate()&&r.getMonth()===t.getMonth()&&r.getFullYear()===t.getFullYear(),o=r.getTime()<Me.getTime(),l=r.getTime()===Me.getTime();return n.createElement(ze.a,{onClick:function(){return a(r)},size:"small",title:this.renderCardHeaderDate(r),className:"current-day",style:{cursor:"pointer",borderRadius:"10px",height:"90px",border:"2px solid ".concat(i?"#1890ff":"#e8e8e8"),backgroundColor:"".concat(l?"#e6f7ff":o?"#f2f4f5":"white")}},this.renderCardBodyWeekDay(r))}}]),t}(n.Component),Be=function(e){function t(){var e,r;Object(g.a)(this,t);for(var a=arguments.length,i=new Array(a),o=0;o<a;o++)i[o]=arguments[o];return(r=Object(V.a)(this,(e=Object(F.a)(t)).call.apply(e,[this].concat(i)))).renderDaysOfWeek=function(){for(var e=r.props,t=e.startDate,a=e.rowIndex,i=e.selectedDate,o=e.trips,l=e.user,s=e.onClickDayOfWeek,c=[],u=0;u<7;u++){var p=u+7*a,d=Object(pe.a)(t,{days:p}),m=D(d,o,l);c.push(n.createElement(te.a,{span:3,key:p},n.createElement(Le,{date:d,selectedDate:i,onClickDayOfWeek:s,todayTrips:m.length})))}return c},r}return Object(P.a)(t,e),Object(b.a)(t,[{key:"render",value:function(){return n.createElement(ee.a,{justify:"center",type:"flex"},this.renderDaysOfWeek())}}]),t}(n.Component),Ne=function(e){function t(){var e,r;Object(g.a)(this,t);for(var a=arguments.length,i=new Array(a),o=0;o<a;o++)i[o]=arguments[o];return(r=Object(V.a)(this,(e=Object(F.a)(t)).call.apply(e,[this].concat(i)))).renderDays=function(){for(var e=r.props,t=e.viewMode,a=e.firstDayOfView,i=e.selectedDate,o=e.trips,l=e.user,s=e.onMoveViewLeft,c=e.onMoveViewRight,u=e.onClickDayOfWeek,p=t===m.week?1:4,d=[],h=0;h<p;h++){var f=n.createElement(ee.a,{justify:"center",key:h,type:"flex"},n.createElement(te.a,{span:1,style:{textAlign:"right"}},0===h?n.createElement(ne.a,{icon:"left",style:{margin:5},onClick:s}):void 0),n.createElement(te.a,{span:22},n.createElement(Be,{startDate:a,rowIndex:h,selectedDate:i,trips:o,user:l,onClickDayOfWeek:u})),n.createElement(te.a,{span:1,style:{textAlign:"left"}},0===h?n.createElement(ne.a,{icon:"right",style:{margin:5},onClick:c}):void 0));d.push(f)}return d},r}return Object(P.a)(t,e),Object(b.a)(t,[{key:"render",value:function(){return n.createElement("div",null,this.renderDays())}}]),t}(n.Component),Re=function(e){function t(){return Object(g.a)(this,t),Object(V.a)(this,Object(F.a)(t).apply(this,arguments))}return Object(P.a)(t,e),Object(b.a)(t,[{key:"render",value:function(){var e=this.props,t=e.actualValue,r=e.onChangeView;return n.createElement("div",{style:{textAlign:"end",margin:10}},"Visualizzazione:",n.createElement(ge.a.Group,{defaultValue:t,size:"default",onChange:function(e){return r(e.target.value)},style:{marginLeft:5}},n.createElement(ge.a.Button,{value:m.week},"Settimana"),n.createElement(ge.a.Button,{value:m.month},"Mese")))}}]),t}(n.Component),He=r(105),We=r(111),Ye=r(564),qe=r(549),Ge=r(550),Je=r(274),Ke=r(551),$e={0:"Autista",1:"Soccorritore",2:"Medico/Sanitario"},Qe=K.a.Option,Xe=function(e){function t(e){var r;Object(g.a)(this,t),(r=Object(V.a)(this,Object(F.a)(t).call(this,e)))._onChangeRole=function(e){r.setState({roleSelected:e.target.value})},r._onChangeUser=function(e){var t=r.props.users.find((function(t){return t.id===e}));void 0!==t&&r.setState({userSelected:t,roleSelected:1})},r.getAvailableUsers=function(){var e=r.props,t=e.users,n=e.tripUsers,a=e.isUserAdmin,i=e.loggedUser;return t.filter((function(e){return!n.find((function(t){return t.userId===e.id}))})).filter((function(e){return a||e.id===i.id})).filter((function(e){return e.committeeUser.role>0}))},r._onConfirmRole=function(){var e=r.state,t=e.roleSelected,n=e.userSelected;void 0!==n&&r.props.onConfirmRole(t,n.id)};var n=r.getAvailableUsers(),a=n.length>0?n[0]:void 0;return r.state={userSelected:a,roleSelected:1},r}return Object(P.a)(t,e),Object(b.a)(t,[{key:"render",value:function(){var e=this.state,t=e.userSelected,r=e.roleSelected,a=this.getAvailableUsers();return n.createElement("div",null,n.createElement(ee.a,null,n.createElement(ge.a.Group,{style:{marginTop:"5px",width:"100%"},value:r,buttonStyle:"solid",onChange:this._onChangeRole},t&&1===t.withDrivingLicense?n.createElement(ge.a.Button,{value:0},$e[0]):void 0,n.createElement(ge.a.Button,{value:1},$e[1]),t&&2===t.committeeUser.occupation?n.createElement(ge.a.Button,{value:2},$e[2]):void 0)),n.createElement(ee.a,null,n.createElement(K.a,{style:{width:"100%"},defaultValue:void 0!==t?t.id:void 0,onChange:this._onChangeUser},a.map((function(e){return n.createElement(Qe,{value:e.id,key:e.id},e.name," ",e.surname)})))),n.createElement(ee.a,null,n.createElement(ne.a,{style:{marginTop:"5px",width:"100%"},type:"primary",ghost:!0,onClick:this._onConfirmRole},"Conferma")))}}]),t}(n.Component),Ze=function(e){function t(){var e,r;Object(g.a)(this,t);for(var a=arguments.length,i=new Array(a),o=0;o<a;o++)i[o]=arguments[o];return(r=Object(V.a)(this,(e=Object(F.a)(t)).call.apply(e,[this].concat(i)))).renderTooltipUserAvatar=function(e){var t=r.props,a=t.user,i=t.onDeleteTripUser,o=$e[e.role];return n.createElement("p",null,o,r.isUserAdmin||((null===a||void 0===a?void 0:a.id)||0)===e.userId?n.createElement(He.a,{title:"Elimina"},n.createElement(ne.a,{onClick:function(){return i(e)},style:{marginLeft:"5px"},icon:"delete",type:"danger"})):void 0)},r.renderRoleChoose=function(e,t){var a=r.props,i=a.committeeUsers,o=a.onConfirmRole;return n.createElement(Xe,{users:i.filter((function(e){return!e.committeeUser.disabled})),tripUsers:t,isUserAdmin:r.isUserAdmin,loggedUser:r.props.user,onConfirmRole:function(t,r){return o(t,e,r)}})},r.renderTimeline=function(){var e=r.props,t=e.selectedDate,a=e.trips,i=e.user,o=e.rolesVisible,l=e.onEditTrip,s=e.onDuplicateTrip,c=e.onDeleteTrip,u=e.onRoleVisibleChange,p=D(t,a,i);if(0===p.length)return n.createElement(We.a,null);var d=p.reduce((function(e,t){return e.extraUsers>t.extraUsers?e:t})).extraUsers+1,m=Math.floor(24/d);return n.createElement(Ye.a,null,p.map((function(e,t){for(var a=e.id,i=e.vehicle,p=e.extraUsers,d=(e.trip_users||[]).sort(x),h=p+1,f=[],v=function(t){var i=d[t],l=Number("".concat(a).concat(t)),s=o[l];if(i){var c=i.user;return f.push(n.createElement(te.a,{span:m,key:t,style:{textAlign:"center"}},n.createElement(He.a,{title:r.renderTooltipUserAvatar(i)},n.createElement(Pe.a,{style:{zIndex:1},count:n.createElement("b",null,$e[i.role].substring(0,1))},n.createElement(qe.a,{style:{backgroundColor:j(i.role)},shape:"square",icon:"user"})),n.createElement("p",null,n.createElement("span",{style:{fontSize:"10px"}},null===c||void 0===c?void 0:c.name," ",null===c||void 0===c?void 0:c.surname))))),"continue"}f.push(n.createElement(te.a,{span:m,key:t,style:{textAlign:"center"}},n.createElement(Ge.a,{content:r.renderRoleChoose(e,d),trigger:"click",visible:s,onVisibleChange:function(e){return u(l,e)}},n.createElement(ne.a,{type:"dashed",icon:"user"}))))},g=0;g<h;g++)v(g);return n.createElement(Ye.a.Item,{key:t},n.createElement(ee.a,null,n.createElement(te.a,{span:8},n.createElement(ee.a,null,n.createElement("b",null,"Ora:")," ",e.hour.substr(0,5),n.createElement(Je.a,{style:{marginLeft:"5px"},color:"green"},we[e.flgDestination])),n.createElement(ee.a,null,n.createElement("b",null,"Partenza: "),e.siteDeparture),n.createElement(ee.a,null,n.createElement("b",null,"Arrivo: ")," ",e.siteArrival),n.createElement(ee.a,null,n.createElement("b",null,"Veicolo: ")," ",i?"".concat(Oe[i.type]," - ").concat(i.sign," - ").concat(i.description):"-")),n.createElement(te.a,{span:4},n.createElement(ee.a,null,n.createElement(Je.a,null,Se[e.flgAr])),n.createElement(ee.a,null,n.createElement(Je.a,{color:"cyan"},ye[e.type])),n.createElement(ee.a,null,1===e.flgNurse?n.createElement(Je.a,{color:"blue"},"Medico/sanitario"):void 0)),n.createElement(te.a,{span:5},n.createElement(ee.a,null,n.createElement("b",null,"Paziente: "),e.patientData||"-"),n.createElement(ee.a,null,n.createElement("b",null,"Servizio: "),e.serviceType||"-"),n.createElement(ee.a,null,e.notes)),n.createElement(te.a,{span:r.isUserAdmin?5:7},n.createElement(ee.a,null,f)),r.isUserAdmin?n.createElement(te.a,{span:2,style:{textAlign:"center",padding:"10px"}},n.createElement(He.a,{title:"Modifica"},n.createElement(ne.a,{size:"small",icon:"edit",onClick:function(){return l(e)}})),n.createElement(He.a,{title:"Duplica"},n.createElement(ne.a,{icon:"copy",size:"small",style:{marginLeft:"1px"},onClick:function(){return s(e)}})),n.createElement(Ke.a,{placement:"topLeft",title:"Confermare l'eliminazione del servizio?",onConfirm:function(){return c(e)},okText:"Si",cancelText:"No"},n.createElement(ne.a,{size:"small",style:{marginLeft:"1px"},icon:"delete",type:"danger"}))):void 0))})))},r}return Object(P.a)(t,e),Object(b.a)(t,[{key:"render",value:function(){return n.createElement(ze.a,{style:{width:"100%",height:"100%",borderRadius:"10px"}},this.renderTimeline())}},{key:"isUserAdmin",get:function(){var e=this.props.user;return void 0!==e&&void 0!==e.committeeUser&&(null===e||void 0===e?void 0:e.committeeUser.role)<2}}]),t}(n.Component),et=new Date,tt=function(e){function t(){var e,r;Object(g.a)(this,t);for(var n=arguments.length,a=new Array(n),i=0;i<n;i++)a[i]=arguments[i];return(r=Object(V.a)(this,(e=Object(F.a)(t)).call.apply(e,[this].concat(a)))).state={loading:!1,selectedDate:et,firstDayOfView:et,viewMode:m.week,trips:[],vehicles:[],showForm:!1,showDuplicateTripForm:!1,selectedTrip:void 0,rolesVisible:[]},r.getEmptyTrip=function(){var e,t=r.state.vehicles;return{id:0,date:Object(ue.a)(r.state.selectedDate,"yyyy-MM-dd"),hour:"12:00:00",flgDestination:0,flgAr:0,siteDeparture:"",siteArrival:"",serviceType:"",patientData:void 0,type:1,extraUsers:1,flgNurse:0,flgToNotify:0,notes:void 0,committeeId:(null===(e=r.props.committee)||void 0===e?void 0:e.id)||0,vehicleId:0!==t.length?t[0].id:0,committee:void 0,vehicle:void 0,trip_users:[]}},r.loadData=function(){var e=r.props.committee;if(void 0!==e){var t=e.id;r.props.connector.getTrips(t).then((function(e){r.setState({trips:e.data}),r.props.connector.getVehicles(t).then((function(e){r.setState({vehicles:e.data,loading:!1})})).catch((function(e){r.setState({vehicles:[],loading:!1}),console.error(e)}))})).catch((function(e){r.setState({trips:[],loading:!1}),console.error(e)}))}},r._onChangeView=function(e){r.setState({viewMode:e})},r._onClickDayOfWeek=function(e){r.setState({selectedDate:e})},r._onDeleteTrip=function(e){var t=e.id;r.props.connector.deleteTripUsersByTrip(t).then((function(e){r.props.connector.deleteTrip(t).then((function(e){r.loadData()})).catch((function(e){console.log("_onDeleteTrip error: ".concat(e)),X.a.error("Si \xe8 verificato un errore durante l'eliminazione"),r.loadData()}))})).catch((function(e){console.log("_onDeleteTrip error: ".concat(e)),X.a.error("Si \xe8 verificato un errore durante l'eliminazione")}))},r._onEditTrip=function(e){r.setState({selectedTrip:e,showForm:!0})},r._onDuplicateTrip=function(e){r.setState({selectedTrip:e,showDuplicateTripForm:!0})},r._onDeleteTripUser=function(e){var t=e.id;r.props.connector.deleteTripUsers(t).then((function(e){r.loadData()})).catch((function(e){console.error("_onDeleteTripUser: ".concat(e)),X.a.error("Si \xe8 verificato un errore nell'eliminazione")}))},r._onConfirmRole=function(e,t,n){var a={id:0,tripId:t.id,userId:n,role:e},i=r.state.rolesVisible.map((function(e){return!1}));r.props.connector.publishTripUser(a).then((function(e){X.a.success("Salvataggio completato"),r.setState({rolesVisible:i},(function(){r.loadData()}))})).catch((function(e){console.log(e),X.a.error("Si \xe8 verificato un errore nel salvataggio")}))},r._onRoleVisibleChange=function(e,t){var n=Object(ce.a)(r.state.rolesVisible);n[e]=t,r.setState({rolesVisible:n})},r._onCreate=function(){r.setState({selectedTrip:r.getEmptyTrip(),showForm:!0})},r._onCloseTripForm=function(){r.setState({showForm:!1,selectedTrip:void 0})},r._onCloseDuplicateTripForm=function(){r.setState({showDuplicateTripForm:!1,selectedTrip:void 0})},r._onConfirmDuplicateTrip=function(){var e=Object(v.a)(f.a.mark((function e(t,n){var a,i,o;return f.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:a=!1,i=f.a.mark((function e(i){var o,l,s,u;return f.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return o=n[i],l=o.date.format("YYYY-MM-DD"),s=o.hour.format("HH:mm"),u=Object(c.a)({},t,{id:0,date:l,hour:s}),e.next=6,r.props.connector.publishTrip(u).then((function(e){console.log("_onConfirmDuplicateTrip done")})).catch((function(e){a=!0,console.error("_onConfirmDuplicateTrip error for trip with date ".concat(l," and hour ").concat(s,". Error: ").concat(e))}));case 6:case"end":return e.stop()}}),e)})),o=0;case 3:if(!(o<n.length)){e.next=8;break}return e.delegateYield(i(o),"t0",5);case 5:o++,e.next=3;break;case 8:r.setState({showDuplicateTripForm:!1,selectedTrip:void 0},(function(){a?X.a.error("Si sono verificati degli errori durante l'operazione"):X.a.success("Operazione completata con successo"),r.loadData()}));case 9:case"end":return e.stop()}}),e)})));return function(t,r){return e.apply(this,arguments)}}(),r._onSave=function(e){r.props.connector.publishTrip(e).then((function(e){X.a.success("Salvataggio completato"),r.setState({showForm:!1,selectedTrip:void 0},(function(){r.loadData()}))})).catch((function(e){console.log(e),X.a.error("Si \xe8 verificato un errore nel salvataggio")}))},r._onMoveViewRight=function(){var e=r.state,t=e.viewMode,n=e.firstDayOfView,a=Object(pe.a)(n,{days:t===m.week?7:28});r.setState({firstDayOfView:a,selectedDate:a})},r._onMoveViewLeft=function(){var e=r.state,t=e.viewMode,n=e.firstDayOfView,a=Object(pe.a)(n,{days:t===m.week?-7:-28});r.setState({firstDayOfView:a,selectedDate:a})},r}return Object(P.a)(t,e),Object(b.a)(t,[{key:"componentDidMount",value:function(){this.loadData()}},{key:"render",value:function(){var e=this.state,t=e.selectedTrip,r=e.showForm,n=e.showDuplicateTripForm,i=e.vehicles,o=e.viewMode,l=e.firstDayOfView,s=e.selectedDate,c=e.trips,u=e.rolesVisible,p=this.props,d=p.user,m=p.users;return a.a.createElement("div",null,a.a.createElement(Re,{actualValue:o,onChangeView:this._onChangeView}),a.a.createElement(Ne,{viewMode:o,firstDayOfView:l,selectedDate:s,trips:c,user:d,onMoveViewLeft:this._onMoveViewLeft,onMoveViewRight:this._onMoveViewRight,onClickDayOfWeek:this._onClickDayOfWeek}),a.a.createElement(Ze,{selectedDate:s,trips:c,user:d,committeeUsers:m,rolesVisible:u,onEditTrip:this._onEditTrip,onDuplicateTrip:this._onDuplicateTrip,onDeleteTrip:this._onDeleteTrip,onConfirmRole:this._onConfirmRole,onDeleteTripUser:this._onDeleteTripUser,onRoleVisibleChange:this._onRoleVisibleChange}),a.a.createElement(je,{visible:r,trip:t,vehicles:i.filter((function(e){return!e.disabled})),onClose:this._onCloseTripForm,onSave:this._onSave}),a.a.createElement(Fe,{visible:n,trip:t,onClose:this._onCloseDuplicateTripForm,onConfirm:this._onConfirmDuplicateTrip}),r||n||d&&d.committeeUser.role>1?void 0:a.a.createElement(me,{onClick:this._onCreate}))}},{key:"isUserAdmin",get:function(){var e=this.props.user;return void 0!==e&&void 0!==e.committeeUser&&(null===e||void 0===e?void 0:e.committeeUser.role)<2}}]),t}(a.a.Component),rt=Object(A.b)((function(e,t){return{user:e.appData.user,connector:e.appData.connector,committee:e.appData.committee,users:e.appData.users}}))(tt),nt={0:"Superuser",1:"Admin",2:"Utente"},at={0:"Dipendente",1:"Volontario",2:"Medico/Sanitario",3:"Altro"},it="Maschio",ot="Femmina",lt=K.a.Option,st={labelCol:{xs:{span:24},sm:{span:6}},wrapperCol:{xs:{span:24},sm:{span:18}}},ct={wrapperCol:{xs:{offset:0,span:24},sm:{offset:6,span:18}}},ut=function(e){function t(){var e,r;Object(g.a)(this,t);for(var a=arguments.length,i=new Array(a),o=0;o<a;o++)i[o]=arguments[o];return(r=Object(V.a)(this,(e=Object(F.a)(t)).call.apply(e,[this].concat(i)))).getInitialValueBirthDate=function(){var e=r.props.user;return(null===e||void 0===e?void 0:e.birth_date)?Ce()(e.birth_date):void 0},r.handleSubmit=function(e){e.preventDefault(),r.props.form.validateFields((function(e,t){if(!e){var n=Object(c.a)({},t,{birth_date:t.birth_date?t.birth_date.format("YYYY-MM-DD"):void 0,committeeUser:{id:t.committeeUserId,userId:t.id,committeeId:t.committeeId,role:t.role,occupation:t.occupation,disabled:t.disabled}});r.props.onSave(n)}}))},r.renderButtonSubmit=function(){var e={float:"right"};return r.props.personalArea&&(e.width="100%"),n.createElement(ne.a,{htmlType:"submit",type:"primary",style:e},"Salva")},r.renderPasswordField=function(){var e=r.props.form.getFieldDecorator,t=r.props,a=t.personalArea,i=t.user;return e("password",{initialValue:i&&i.id>0?"12345678":void 0,rules:[{required:!0,message:"Specificare la password"}]})(a?n.createElement(re.a.Password,{disabled:!0,placeholder:"Specificare la password"}):n.createElement(re.a,{disabled:i&&i.id>0,type:"password",placeholder:"Specificare la password"}))},r}return Object(P.a)(t,e),Object(b.a)(t,[{key:"render",value:function(){var e,t,r,a,i,o,l,s,c,u,p,d,m,h,f=this.props.form.getFieldDecorator,v=this.props,g=v.user,b=v.onCancel,E=v.onChangePassword,y=v.personalArea;return n.createElement(Q.a,Object.assign({},st,{style:{padding:"5px"},layout:"vertical",onSubmit:this.handleSubmit}),n.createElement(Q.a.Item,{label:"Username"},f("username",{initialValue:null===(e=this.props.user)||void 0===e?void 0:e.username,rules:[{required:!0,message:"Specificare il nome utente"}]})(n.createElement(re.a,{disabled:g&&g.id>0,placeholder:"Specificare il nome utente"}))),n.createElement(Q.a.Item,{label:"Password"},y?n.createElement(ee.a,{gutter:2},n.createElement(te.a,{xs:{span:14},lg:{span:20}},this.renderPasswordField()),n.createElement(te.a,{xs:{span:10},lg:{span:4}},n.createElement(ne.a,{onClick:E,style:{width:"100%"}},"Modifica"))):this.renderPasswordField()),n.createElement(Q.a.Item,{label:"Nome"},f("name",{initialValue:null===(t=this.props.user)||void 0===t?void 0:t.name,rules:[{required:!0,message:"Specificare il nome"}]})(n.createElement(re.a,{placeholder:"Specificare il nome"}))),n.createElement(Q.a.Item,{label:"Cognome"},f("surname",{initialValue:null===(r=this.props.user)||void 0===r?void 0:r.surname,rules:[{required:!0,message:"Specificare il cognome"}]})(n.createElement(re.a,{placeholder:"Specificare il cognome"}))),n.createElement(Q.a.Item,{label:"Data di nascita"},f("birth_date",{initialValue:this.getInitialValueBirthDate(),rules:[]})(n.createElement(fe.a,{format:"DD-MM-YYYY",style:{textAlign:"left"}}))),n.createElement(Q.a.Item,{label:"Sesso"},f("gender",{initialValue:null===(a=this.props.user)||void 0===a?void 0:a.gender,rules:[{required:!0,message:"Specificare il sesso"}]})(n.createElement(K.a,{placeholder:"Sesso"},n.createElement(lt,{value:0},it),n.createElement(lt,{value:1},ot)))),n.createElement(Q.a.Item,{label:"Email"},f("email",{initialValue:null===(i=this.props.user)||void 0===i?void 0:i.email,rules:[]})(n.createElement(re.a,{placeholder:"Specificare l'email"}))),n.createElement(Q.a.Item,{label:"Cellulare"},f("cellphoneNumber",{initialValue:null===(o=this.props.user)||void 0===o?void 0:o.cellphoneNumber,rules:[]})(n.createElement(re.a,{placeholder:"Specificare numero di cellulare"}))),y&&n.createElement(Q.a.Item,ct,this.renderButtonSubmit()),n.createElement("div",{style:{visibility:y?"collapse":"visible"}},n.createElement(Q.a.Item,{label:"Ruolo"},f("role",{initialValue:null===(l=this.props.user)||void 0===l?void 0:l.committeeUser.role,rules:[{required:!0,message:"Specificare il ruolo"}]})(n.createElement(K.a,{placeholder:"Role"},n.createElement(lt,{value:1},nt[1]),n.createElement(lt,{value:2},nt[2])))),n.createElement(Q.a.Item,{label:"Occupazione"},f("occupation",{initialValue:null===(s=this.props.user)||void 0===s?void 0:s.committeeUser.occupation,rules:[{required:!0,message:"Specificare l'occupazione"}]})(n.createElement(K.a,{placeholder:"Occupazione"},n.createElement(lt,{value:0},at[0]),n.createElement(lt,{value:1},at[1]),n.createElement(lt,{value:2},at[2]))))),n.createElement("div",{style:{visibility:y?"collapse":"visible"}},n.createElement(Q.a.Item,{label:"Con patente"},f("withDrivingLicense",{initialValue:null===(c=this.props.user)||void 0===c?void 0:c.withDrivingLicense,valuePropName:"checked"})(n.createElement(be.a,null))),n.createElement(Q.a.Item,{label:"Disabilita"},f("disabled",{initialValue:null===(u=this.props.user)||void 0===u?void 0:u.committeeUser.disabled,valuePropName:"checked"})(n.createElement(be.a,null)))),n.createElement("div",{style:{visibility:"collapse"}},n.createElement(Q.a.Item,{label:"Id"},f("id",{initialValue:null===(p=this.props.user)||void 0===p?void 0:p.id})(n.createElement(re.a,{placeholder:"Specificare id utente"}))),n.createElement(Q.a.Item,{label:"Password modificata"},f("flgPasswordChanged",{initialValue:null===(d=this.props.user)||void 0===d?void 0:d.flgPasswordChanged})(n.createElement(re.a,{placeholder:"Password modificata"}))),n.createElement(Q.a.Item,{label:"CommitteeUserId"},f("committeeUserId",{initialValue:null===(m=this.props.user)||void 0===m?void 0:m.committeeUser.id})(n.createElement(re.a,{placeholder:"CommitteeUserId"}))),n.createElement(Q.a.Item,{label:"CommitteeId"},f("committeeId",{initialValue:null===(h=this.props.user)||void 0===h?void 0:h.committeeUser.committeeId})(n.createElement(re.a,{placeholder:"CommitteeId"})))),y?void 0:n.createElement("div",{style:{position:"absolute",right:0,bottom:0,width:"100%",borderTop:"1px solid #e9e9e9",padding:"10px 16px",background:"#fff",textAlign:"right"}},n.createElement(ne.a,{onClick:b,style:{marginRight:8}},"Annulla"),this.renderButtonSubmit()))}}]),t}(n.Component),pt=Q.a.create({name:"user_form "})(ut),dt=function(e){function t(){return Object(g.a)(this,t),Object(V.a)(this,Object(F.a)(t).apply(this,arguments))}return Object(P.a)(t,e),Object(b.a)(t,[{key:"render",value:function(){return n.createElement(pt,this.props)}}]),t}(n.Component),mt=function(e){function t(){var e,r;Object(g.a)(this,t);for(var n=arguments.length,a=new Array(n),i=0;i<n;i++)a[i]=arguments[i];return(r=Object(V.a)(this,(e=Object(F.a)(t)).call.apply(e,[this].concat(a)))).state={oldPassword:void 0,newPassword:void 0,newPasswordConfirm:void 0},r.onChangeOldPassowrd=function(e){r.setState({oldPassword:e.target.value})},r.onChangeNewPassword=function(e){r.setState({newPassword:e.target.value})},r.onChangeNewPasswordConfirm=function(e){r.setState({newPasswordConfirm:e.target.value})},r.handlePasswordChangeConfirm=function(e){var t=r.state,n=t.oldPassword,a=t.newPassword,i=t.newPasswordConfirm;n&&a&&i?a===i?a!==n?r.props.onPasswordChangeConfirm(n||"",a||""):X.a.error("La nuova password non pu\xf2 coincidere con la vecchia password"):X.a.error("Digitare correttamente la nuova password"):X.a.error("Completare correttamente i campi")},r}return Object(P.a)(t,e),Object(b.a)(t,[{key:"render",value:function(){var e=this.props,t=e.changePasswordModalVisible,r=e.onPasswordChangeCancel;return n.createElement(Z.a,{title:"Modifica password",visible:t,onOk:this.handlePasswordChangeConfirm,onCancel:r,cancelText:"Annulla",okText:"Conferma"},n.createElement("div",null,n.createElement(re.a.Password,{placeholder:"Inserisci password corrente",onChange:this.onChangeOldPassowrd}),n.createElement(re.a.Password,{style:{marginTop:"5px"},placeholder:"Inserisci nuova password",onChange:this.onChangeNewPassword}),n.createElement(re.a.Password,{style:{marginTop:"5px"},placeholder:"Conferma nuova password",onChange:this.onChangeNewPasswordConfirm})))}}]),t}(n.Component),ht=function(e){function t(){var e,r;Object(g.a)(this,t);for(var n=arguments.length,a=new Array(n),i=0;i<n;i++)a[i]=arguments[i];return(r=Object(V.a)(this,(e=Object(F.a)(t)).call.apply(e,[this].concat(a)))).state={passwordChangeFormVisible:!1},r._onCancel=function(){r.props.history.goBack()},r._onSave=function(e){var t=r.props.user;r.props.connector.publishUser(e).then((function(n){r.props.setUserData(e,(null===t||void 0===t?void 0:t.committeeUser.id)||0),X.a.success("Salvataggio completato")})).catch((function(e){console.error("_onSave: error ".concat(e)),X.a.error("Si \xe8 verificato un errore nel salvataggio")}))},r._onChangePassword=function(){r.setState({passwordChangeFormVisible:!0})},r._onPasswordChangeConfirm=function(e,t){r.props.connector.modifyPassword(e||"",t||"").then((function(e){r.setState({passwordChangeFormVisible:!1},(function(){return X.a.success("Password modificata correttamente")}))})).catch((function(e){var t="Si \xe8 verificato un errore nella richiesta",r=e.response;r&&r.data&&r.data&&r.data.message&&(t=r.data.message),X.a.error(t)}))},r._onPasswordChangeCancel=function(e){r.setState({passwordChangeFormVisible:!1})},r}return Object(P.a)(t,e),Object(b.a)(t,[{key:"render",value:function(){var e=this.props.user;return n.createElement(ee.a,null,n.createElement(te.a,{xs:{span:0},lg:{span:3}}),n.createElement(te.a,{xs:{span:24},lg:{span:16},style:{marginTop:"10px"}},n.createElement(dt,{loggedUserId:e.id,user:e,personalArea:!0,onCancel:this._onCancel,onSave:this._onSave,onChangePassword:this._onChangePassword})),n.createElement(te.a,{xs:{span:0},lg:{span:3}}),n.createElement(mt,{changePasswordModalVisible:this.state.passwordChangeFormVisible,onPasswordChangeCancel:this._onPasswordChangeCancel,onPasswordChangeConfirm:this._onPasswordChangeConfirm}))}}]),t}(n.Component),ft=Object(A.b)((function(e,t){return{user:e.appData.user,connector:e.appData.connector,committee:e.appData.committee}}),{setUserData:p})(ht),vt=r(205),gt=function(e){function t(){var e,r;Object(g.a)(this,t);for(var n=arguments.length,a=new Array(n),i=0;i<n;i++)a[i]=arguments[i];return(r=Object(V.a)(this,(e=Object(F.a)(t)).call.apply(e,[this].concat(a)))).onClickMenuItem=function(e){var t=r.props,n=t.history,a=t.onClickMenu;a&&a(),n.push(e)},r}return Object(P.a)(t,e),Object(b.a)(t,[{key:"render",value:function(){var e=this,t=this.props,r=t.isUserAdmin,a=t.menuMode;return n.createElement(vt.a,{theme:"dark",defaultSelectedKeys:["1"],mode:a},n.createElement(vt.a.Item,{key:"1",onClick:function(){return e.onClickMenuItem(N)}},n.createElement($.a,{type:"calendar"}),n.createElement("span",null,"Gestione Servizi")),r?n.createElement(vt.a.Item,{key:"2",onClick:function(){return e.onClickMenuItem(R)}},n.createElement($.a,{type:"team"}),n.createElement("span",null,"Gestione Utenti")):void 0,r?n.createElement(vt.a.Item,{key:"3",onClick:function(){return e.onClickMenuItem(H)}},n.createElement($.a,{type:"car"}),n.createElement("span",null,"Gestione Veicoli")):void 0,n.createElement(vt.a.Item,{key:"4",onClick:function(){return e.onClickMenuItem(W)}},n.createElement($.a,{type:"user"}),n.createElement("span",null,"Area personale")))}}]),t}(n.Component),bt=se.a.Sider,Et=function(e){function t(e){var r;return Object(g.a)(this,t),(r=Object(V.a)(this,Object(F.a)(t).call(this,e)))._onCollapse=function(e){r.setState({collapsed:e})},r._onClickMenu=function(){r.setState({collapsed:!0})},r.state={collapsed:!0},r}return Object(P.a)(t,e),Object(b.a)(t,[{key:"render",value:function(){var e=this.props,t=e.isUserAdmin,r=e.history;return n.createElement(bt,{collapsible:!0,collapsed:this.state.collapsed,onCollapse:this._onCollapse},n.createElement("div",{style:{height:"60px",width:"100%"}}),n.createElement(gt,{isUserAdmin:t,history:r,menuMode:"inline",onClickMenu:this._onClickMenu}))}}]),t}(n.Component),yt=se.a.Header,wt=function(e){function t(){return Object(g.a)(this,t),Object(V.a)(this,Object(F.a)(t).apply(this,arguments))}return Object(P.a)(t,e),Object(b.a)(t,[{key:"render",value:function(){var e=this.props,t=e.committee,r=e.user,n=e.onClickLogout;return a.a.createElement(yt,{style:{background:"#001529",maxHeight:"64px",width:"100%",padding:0,position:"fixed",zIndex:10,left:0}},a.a.createElement(ee.a,null,a.a.createElement(te.a,{span:16,style:{textAlign:"left"}},a.a.createElement("span",{style:{color:"white",marginLeft:"15px",fontStyle:"bold",fontSize:"larger"}},"Servizio Facile v.1.0"),"-",a.a.createElement("span",{style:{color:"white",marginLeft:"5px",fontStyle:"italic"}},null===t||void 0===t?void 0:t.description)),a.a.createElement(te.a,{span:7,style:{textAlign:"right"}},a.a.createElement("span",{style:{color:"white",marginRight:"5px"}},null===r||void 0===r?void 0:r.name," ",null===r||void 0===r?void 0:r.surname)),a.a.createElement(te.a,{span:1},a.a.createElement(He.a,{title:"Logout",placement:"bottom"},a.a.createElement(ne.a,{ghost:!0,icon:"logout",style:{height:"64px",width:"100%"},onClick:n})))))}}]),t}(a.a.Component),St=se.a.Footer,kt=function(e){function t(){return Object(g.a)(this,t),Object(V.a)(this,Object(F.a)(t).apply(this,arguments))}return Object(P.a)(t,e),Object(b.a)(t,[{key:"render",value:function(){var e=this.props,t=e.history,r=e.isUserAdmin;return a.a.createElement(St,{style:{width:"100%",position:"fixed",left:0,bottom:0,padding:"0px"}},a.a.createElement(gt,{isUserAdmin:r,history:t,menuMode:"horizontal"}))}}]),t}(a.a.Component),Ct=r(267),Ot=r(553),Dt=(r(246),function(e){function t(){var e,r,a;Object(g.a)(this,t);for(var i=arguments.length,o=new Array(i),l=0;l<i;l++)o[l]=arguments[l];return(a=Object(V.a)(this,(e=Object(F.a)(t)).call.apply(e,[this].concat(o)))).columns=[{title:"Username",dataIndex:"username",key:"username",render:function(e,t){return n.createElement("b",null,e)}},{title:"Nome",dataIndex:"name",key:"name"},{title:"Cognome",dataIndex:"surname",key:"surname"},{title:"Data di nascita",dataIndex:"birth_date",key:"birth_date"},{title:"Ruolo",dataIndex:"committeeUser.role",key:"role",render:function(e,t){return n.createElement("span",null,nt[e])}},{title:"Occupazione",dataIndex:"committeeUser.occupation",key:"occupation",render:function(e,t){return n.createElement("span",null,at[e])}},{title:"Con patente",dataIndex:"withDrivingLicense",key:"withDrivingLicense",render:function(e,t){return n.createElement("p",null,0===e?void 0:n.createElement($.a,{type:"check"}))}},{title:"Disabilitato",dataIndex:"committeeUser.disabled",key:"disabled",render:function(e,t){return n.createElement("p",null,0===e?void 0:n.createElement($.a,{type:"check"}))}},{title:"",key:"action",render:function(e,t){return n.createElement("span",null,n.createElement(He.a,{title:"Modifica"},n.createElement(ne.a,{size:"small",icon:"edit",onClick:function(){return a._onEditRow(t)}})),n.createElement(Ke.a,{placement:"topLeft",title:"Confermare l'eliminazione dell'utente?",onConfirm:function(){return a._onDeleteUser(t)},okText:"Si",cancelText:"No"},n.createElement(ne.a,{size:"small",style:{marginLeft:"1px"},icon:"delete",type:"danger"})))}}],a.emptyUser={id:0,username:"",password:"",flgPasswordChanged:0,name:"",surname:"",gender:0,withDrivingLicense:0,superuser:0,committeeUser:{id:0,committeeId:(null===(r=a.props.committee)||void 0===r?void 0:r.id)||0,userId:0,role:2,occupation:0,disabled:0}},a.state={loading:!1,showForm:!1},a.loadData=function(){var e=a.props.committee;void 0!==e&&a.props.connector.getUsers(e.id).then((function(e){a.setState({loading:!1},(function(){a.props.setUsersData(e.data)}))})).catch((function(e){X.a.error("Si \xe8 verificato un errore nella lettura degli utenti"),a.setState({loading:!1}),console.error(e)}))},a._onClose=function(){a.setState({showForm:!1,selectedUser:void 0})},a._onEditRow=function(e){a.setState({selectedUser:e,showForm:!0})},a._onDeleteUser=function(e){a.props.connector.getUserTrips(e.id).then((function(t){(t.data||[]).length>0?X.a.error("Utente gi\xe0 assegnato a servizi. Impossibile eliminare"):a.props.connector.deleteCommitteesUsers(e.id).then((function(t){a.props.connector.deleteUser(e.id).then((function(e){a.loadData()})).catch((function(e){console.error("_onDeleteUser - deleteUser: ".concat(e)),X.a.error("Si \xe8 verificato un errore durante l'eliminazione")}))})).catch((function(e){console.error("_onDeleteUser - deleteCommitteesUsers: ".concat(e)),X.a.error("Si \xe8 verificato un errore durante l'eliminazione")}))})).catch((function(e){console.error("_onDeleteUser - getUserTrips: ".concat(e)),X.a.error("Si \xe8 verificato un errore durante l'eliminazione")}))},a._onSave=function(e){var t=e.committeeUser;if(!t)return console.warn("Expected NOT NULL 'committee' - This should never happen!"),void X.a.error("Si \xe8 verificato un errore nel salvataggio");a.props.connector.publishUserCommittee(e,t).then((function(e){X.a.success("Salvataggio completato"),a.setState({showForm:!1,selectedUser:void 0},(function(){a.loadData()}))})).catch((function(e){console.log(e),X.a.error("Si \xe8 verificato un errore nel salvataggio")}))},a._onCreate=function(){a.setState({selectedUser:a.emptyUser,showForm:!0})},a.getDataSource=function(){var e=a.props,t=e.user,r=e.users;return void 0!==t?0===t.superuser?r.filter((function(e){return 0===e.superuser})):r:[]},a}return Object(P.a)(t,e),Object(b.a)(t,[{key:"render",value:function(){var e,t,r=this.state,a=r.loading,i=r.selectedUser,o=r.showForm;return n.createElement("div",null,a?n.createElement("div",{style:{textAlign:"center"}},n.createElement(Ct.a,null)):n.createElement(ee.a,null,n.createElement(Ot.a,{columns:this.columns,pagination:{pageSize:10},dataSource:this.getDataSource()}),n.createElement(he.a,{title:"".concat(0===(null===(e=i)||void 0===e?void 0:e.id)?"Crea":"Modifica"," utente"),width:640,onClose:this._onClose,visible:o,bodyStyle:{paddingBottom:80}},o?n.createElement(dt,{loggedUserId:(null===(t=this.props.user)||void 0===t?void 0:t.id)||0,user:i,onCancel:this._onClose,onSave:this._onSave}):void 0),o?void 0:n.createElement(me,{onClick:this._onCreate})))}}]),t}(n.Component)),Tt=Object(A.b)((function(e,t){return{user:e.appData.user,connector:e.appData.connector,committee:e.appData.committee,users:e.appData.users}}),{setUsersData:u})(Dt),xt=K.a.Option,jt=function(e){function t(){var e,r;Object(g.a)(this,t);for(var n=arguments.length,a=new Array(n),i=0;i<n;i++)a[i]=arguments[i];return(r=Object(V.a)(this,(e=Object(F.a)(t)).call.apply(e,[this].concat(a)))).handleSubmit=function(e){e.preventDefault(),r.props.form.validateFields((function(e,t){if(!e){var n=r.props.vehicle,a=Object(c.a)({},t,{id:n.id,committeeId:n.committeeId,committee:n.committee});r.props.onSave(a)}}))},r}return Object(P.a)(t,e),Object(b.a)(t,[{key:"componentWillReceiveProps",value:function(e){var t=e.vehicle;void 0!==t&&JSON.stringify(this.props.vehicle)!==JSON.stringify(e.vehicle)&&e.form.setFieldsValue({type:t.type,plate:t.plate,sign:t.sign,description:t.description,disabled:t.disabled})}},{key:"render",value:function(){var e,t=this.props.form.getFieldDecorator;return n.createElement(he.a,{title:"".concat(0===(null===(e=this.props.vehicle)||void 0===e?void 0:e.id)?"Crea":"Modifica"," veicolo"),width:480,onClose:this.props.onClose,visible:this.props.visible,bodyStyle:{paddingBottom:80}},n.createElement(Q.a,{layout:"vertical",onSubmit:this.handleSubmit},n.createElement(ee.a,{gutter:16},n.createElement(te.a,{span:24},n.createElement(Q.a.Item,{label:"Tipo"},t("type",{rules:[{required:!0,message:"Specificare il tipo"}],initialValue:"0"})(n.createElement(K.a,{placeholder:"Tipologia"},n.createElement(xt,{value:0},Oe[0]),n.createElement(xt,{value:1},Oe[1]),n.createElement(xt,{value:2},Oe[2])))))),n.createElement(ee.a,{gutter:16},n.createElement(te.a,{span:24},n.createElement(Q.a.Item,{label:"Targa"},t("plate",{rules:[{required:!0,message:"Specificare la targa"}]})(n.createElement(re.a,{placeholder:"Specificare la targa"}))))),n.createElement(ee.a,{gutter:16},n.createElement(te.a,{span:24},n.createElement(Q.a.Item,{label:"Sigla"},t("sign",{rules:[{required:!1,message:"Specificare la sigla"}]})(n.createElement(re.a,{placeholder:"Specificare una sigla"}))))),n.createElement(ee.a,{gutter:16},n.createElement(te.a,{span:24},n.createElement(Q.a.Item,{label:"Descrizione"},t("description",{rules:[{required:!1}]})(n.createElement(re.a.TextArea,{rows:4,placeholder:"Specificare una descrizione"}))))),n.createElement(ee.a,null,n.createElement(te.a,{span:12},n.createElement(Q.a.Item,{label:"Disabilita"},t("disabled",{valuePropName:"checked"})(n.createElement(be.a,null))))),n.createElement("div",{style:{position:"absolute",right:0,bottom:0,width:"100%",borderTop:"1px solid #e9e9e9",padding:"10px 16px",background:"#fff",textAlign:"right"}},n.createElement(ne.a,{onClick:this.props.onClose,style:{marginRight:8}},"Annulla"),n.createElement(ne.a,{htmlType:"submit",type:"primary"},"Salva"))))}}]),t}(n.Component),_t=Q.a.create({name:"vehicle_form "})(jt),It=function(e){function t(){return Object(g.a)(this,t),Object(V.a)(this,Object(F.a)(t).apply(this,arguments))}return Object(P.a)(t,e),Object(b.a)(t,[{key:"render",value:function(){return n.createElement(_t,this.props)}}]),t}(n.Component),Ut=function(e){function t(){var e,r,a;Object(g.a)(this,t);for(var i=arguments.length,o=new Array(i),l=0;l<i;l++)o[l]=arguments[l];return(a=Object(V.a)(this,(e=Object(F.a)(t)).call.apply(e,[this].concat(o)))).columns=[{title:"Targa",dataIndex:"plate",key:"plate"},{title:"Sigla",dataIndex:"sign",key:"sign"},{title:"Tipologia",dataIndex:"type",key:"type",render:function(e,t){return n.createElement("span",null,Oe[e])}},{title:"Descrizione",dataIndex:"description",key:"description"},{title:"Disabilitato",dataIndex:"disabled",key:"disabled",render:function(e,t){return n.createElement("p",null,0===e?void 0:n.createElement($.a,{type:"close"}))}},{title:"",key:"action",render:function(e,t){return n.createElement("span",null,n.createElement(He.a,{title:"Modifica"},n.createElement(ne.a,{size:"small",icon:"edit",onClick:function(){return a._onEditVehicle(t)}})),n.createElement(Ke.a,{placement:"topLeft",title:"Confermare l'eliminazione?",onConfirm:function(){return a._onDeleteVehicle(t)},okText:"Si",cancelText:"No"},n.createElement(ne.a,{size:"small",style:{marginLeft:"1px"},icon:"delete",type:"danger"})))}}],a.emptyVehicle={id:0,type:0,plate:"",sign:"",description:"",disabled:0,committeeId:(null===(r=a.props.committee)||void 0===r?void 0:r.id)||0,committee:a.props.committee},a.state={loading:!0,showForm:!1,selectedVehicle:void 0,vehicles:[]},a.loadData=function(){var e=a.props.committee;void 0!==e&&a.props.connector.getVehicles(e.id).then((function(e){a.setState({vehicles:e.data,loading:!1})})).catch((function(e){a.setState({vehicles:[],loading:!1}),console.error(e)}))},a._onClose=function(){a.setState({showForm:!1,selectedVehicle:void 0})},a._onEditVehicle=function(e){a.setState({selectedVehicle:e,showForm:!0})},a._onDeleteVehicle=function(e){a.props.connector.deleteVehicle(e).then((function(e){a.loadData()}))},a._onSave=function(e){a.publishVehicle(e)},a.publishVehicle=function(e){a.props.connector.publishVehicle(e).then((function(e){X.a.success("Salvataggio completato"),a.setState({showForm:!1,selectedVehicle:void 0},(function(){a.loadData()}))})).catch((function(e){console.error(e),X.a.error("Si \xe8 verificato un errore nel salvataggio")}))},a._onCreate=function(){a.setState({selectedVehicle:a.emptyVehicle,showForm:!0})},a}return Object(P.a)(t,e),Object(b.a)(t,[{key:"componentDidMount",value:function(){this.loadData()}},{key:"render",value:function(){var e=this.state,t=e.loading,r=e.vehicles;return n.createElement("div",null,t?n.createElement("div",{style:{textAlign:"center"}},n.createElement(Ct.a,null)," "):n.createElement(ee.a,null,n.createElement(Ot.a,{columns:this.columns,pagination:{pageSize:10},dataSource:r}),n.createElement(It,{visible:this.state.showForm,vehicle:this.state.selectedVehicle,onClose:this._onClose,onSave:this._onSave}),this.state.showForm?void 0:n.createElement(me,{onClick:this._onCreate})))}}]),t}(n.Component),At=Object(A.b)((function(e,t){return{connector:e.appData.connector,committee:e.appData.committee}}))(Ut),Vt=se.a.Content,Ft=function(e){function t(e){var r;Object(g.a)(this,t),(r=Object(V.a)(this,Object(F.a)(t).call(this,e)))._onClickLogout=function(){r.props.resetAuthData(),r._onLogout()},r._onLogout=function(){r.props.history.replace(L)};var n=r.props,a=n.user,i=n.committee;return a||i||r._onLogout(),r.state={windowWidth:0,windowHeight:0},r}return Object(P.a)(t,e),Object(b.a)(t,[{key:"componentDidMount",value:function(){this.updateDimensions(),window.addEventListener("resize",this.updateDimensions.bind(this))}},{key:"componentWillUnmount",value:function(){window.removeEventListener("resize",this.updateDimensions.bind(this))}},{key:"updateDimensions",value:function(){var e="undefined"!==typeof window?window.innerWidth:0,t="undefined"!==typeof window?window.innerHeight:0;this.setState({windowWidth:e,windowHeight:t})}},{key:"render",value:function(){var e=this.props,t=e.user,r=e.committee;return a.a.createElement(se.a,{style:{minHeight:"100vh"}},this.isForDesktop?a.a.createElement(Et,{isUserAdmin:this.isUserAdmin,history:this.props.history}):void 0,a.a.createElement(se.a,null,a.a.createElement(wt,{committee:r,user:t,onClickLogout:this._onClickLogout}),a.a.createElement(Vt,{style:{marginTop:"68px"}},a.a.createElement(M.a,{path:R,exact:!0,component:Tt}),a.a.createElement(M.a,{path:H,exact:!0,component:At}),a.a.createElement(M.a,{path:W,exact:!0,component:ft}),a.a.createElement(M.a,{path:N,component:rt})),this.isForDesktop?void 0:a.a.createElement(kt,{isUserAdmin:this.isUserAdmin,history:this.props.history})))}},{key:"isUserAdmin",get:function(){var e=this.props.user;return void 0!==e&&void 0!==e.committeeUser&&(null===e||void 0===e?void 0:e.committeeUser.role)<2}},{key:"isForSmartphone",get:function(){return this.state.windowWidth<=768}},{key:"isForTablet",get:function(){var e=this.state.windowWidth;return e>768&&e<1100}},{key:"isForDesktop",get:function(){return this.state.windowWidth>=1100}}]),t}(a.a.Component),Pt=Object(A.b)((function(e,t){return{user:e.appData.user,committee:e.appData.committee}}),{resetAuthData:d})(Ft),zt=r(26),Mt=r(275),Lt=r(271),Bt=r.n(Lt),Nt=function(e){function t(){var e,r;Object(g.a)(this,t);for(var a=arguments.length,i=new Array(a),o=0;o<a;o++)i[o]=arguments[o];return(r=Object(V.a)(this,(e=Object(F.a)(t)).call.apply(e,[this].concat(i)))).state={passwordChangeFormVisible:!1},r.onSaveUser=function(e){var t=r.props.user;r.props.connector.publishUser(e).then((function(n){r.props.setUserData(e,(null===t||void 0===t?void 0:t.committeeUser.id)||0),X.a.success("Salvataggio completato")})).catch((function(e){console.error("_onSave: error ".concat(e)),X.a.error("Si \xe8 verificato un errore nel salvataggio")}))},r._onChangePassword=function(){r.setState({passwordChangeFormVisible:!0})},r._onPasswordChangeConfirm=function(e,t){r.props.connector.modifyPassword(e||"",t||"").then((function(e){r.setState({passwordChangeFormVisible:!1},(function(){return X.a.success("Password modificata correttamente")}))})).catch((function(e){var t="Si \xe8 verificato un errore nella richiesta",r=e.response;r&&r.data&&r.data&&r.data.message&&(t=r.data.message),X.a.error(t)}))},r._onPasswordChangeCancel=function(e){r.setState({passwordChangeFormVisible:!1})},r._onSubmit=function(){r.props.form.validateFields((function(e,t){var n=[];if(null!==e&&void 0!==e)for(var a in e){var i=e[a];if(i&&i.errors){var o=i.errors;o.length>0&&(n=[].concat(Object(ce.a)(n),[o[0].message]))}}if(n.length>0)n.map((function(e){return X.a.warn(e)}));else{var l=r.props.user,s=Object(c.a)({},l,{},t,{birth_date:t.birth_date?Ce()(t.birth_date).format("YYYY-MM-DD"):void 0,gender:t.gender[0]});r.onSaveUser(s)}}))},r.getPickerGenderData=function(){return[{value:0,label:"Maschio"},{value:1,label:"Femmina"}]},r.renderButtonChangePassword=function(){return n.createElement(zt.b,{onClick:r._onChangePassword,type:"primary",size:"small",style:{width:"100%"}},"Modifica")},r.getInitialValueBirthDate=function(){var e=r.props.user;return(null===e||void 0===e?void 0:e.birth_date)?Ce()(e.birth_date).toDate():void 0},r}return Object(P.a)(t,e),Object(b.a)(t,[{key:"render",value:function(){var e=this.props.user,t=this.props.form.getFieldProps;return n.createElement(zt.h,{locale:Bt.a},n.createElement("div",null,n.createElement(zt.f,{renderHeader:function(){return"Area personale"}},n.createElement(zt.e,Object.assign({},t("username",{initialValue:null===e||void 0===e?void 0:e.username,rules:[{required:!0,message:"Specificare il nome utente"}]}),{disabled:!0,placeholder:"Username"}),"Username"),n.createElement("div",{style:{width:"100%"}},n.createElement("div",{style:{display:"table-cell"}},n.createElement(zt.e,Object.assign({type:"password",disabled:!0},t("password",{initialValue:"12345678",rules:[{required:!0,message:"Specificare la password"}]}),{placeholder:"Password"}),"Password")),n.createElement("div",{style:{display:"table-cell"}},this.renderButtonChangePassword()))),n.createElement(zt.n,null),n.createElement(zt.f,null,n.createElement(zt.e,Object.assign({},t("name",{initialValue:null===e||void 0===e?void 0:e.name,rules:[{required:!0,message:"Specificare il Nome"}]}),{clear:!0,placeholder:"Digitare il nome"}),"Nome"),n.createElement(zt.e,Object.assign({},t("surname",{initialValue:null===e||void 0===e?void 0:e.surname,rules:[{required:!0,message:"Specificare il Cognome"}]}),{clear:!0,placeholder:"Digitare il cognome"}),"Cognome"),n.createElement(zt.c,Object.assign({minDate:new Date(1900,1,1),maxDate:new Date,mode:"date",okText:"Conferma",dismissText:"Annulla"},t("birth_date",{initialValue:this.getInitialValueBirthDate(),rules:[]})),n.createElement(zt.f.Item,{arrow:"horizontal"},"Data di nascita"))),n.createElement(zt.k,Object.assign({data:this.getPickerGenderData(),title:"Seleziona il sesso",okText:"Conferma",dismissText:"Annulla",cols:1},t("gender",{initialValue:[null===e||void 0===e?void 0:e.gender],rules:[{required:!0,message:"Specificare il sesso"}]})),n.createElement(zt.f.Item,{arrow:"horizontal"},"Sesso")),n.createElement(zt.f,null,n.createElement(zt.e,Object.assign({},t("email",{initialValue:null===e||void 0===e?void 0:e.email,rules:[]}),{clear:!0,placeholder:"Specificare l'email personale"}),"Email"),n.createElement(zt.e,Object.assign({},t("cellphoneNumber",{initialValue:null===e||void 0===e?void 0:e.cellphoneNumber,rules:[]}),{clear:!0,placeholder:"Specificare numero di cellulare"}),"Cellulare")),n.createElement(zt.f.Item,null,n.createElement(zt.b,{type:"primary",icon:"check-circle-o",size:"small",onClick:this._onSubmit},"Salva")),n.createElement(mt,{changePasswordModalVisible:this.state.passwordChangeFormVisible,onPasswordChangeCancel:this._onPasswordChangeCancel,onPasswordChangeConfirm:this._onPasswordChangeConfirm})))}}]),t}(n.Component),Rt=Object(Mt.a)()(Nt),Ht=Object(A.b)((function(e,t){return{user:e.appData.user,connector:e.appData.connector,committee:e.appData.committee}}),{setUserData:p})(Rt),Wt=r(203),Yt=(r(541),r(204)),qt=r.n(Yt);!function(e){e[e.toBook=0]="toBook",e[e.booked=1]="booked"}(w||(w={}));var Gt,Jt=function(e){function t(e){var r;Object(g.a)(this,t),(r=Object(V.a)(this,Object(F.a)(t).call(this,e))).roles=[],r.buildDataBlobs=function(e){var t={},n=[],a=[];if(!e||0===e.length)return{dataBlobs:t,sectionIDs:n,rowIDs:a};for(var i=r.groupBy(e,"date"),o=Object.keys(i),l=0;l<o.length;l++){var s=o[l];n.push(s),t[s]=s,a[l]=[];for(var c=i[s],u=0;u<c.length;u++){var p=c[u].id;a[l].push(p),t[p]=p}}return{dataBlobs:t,sectionIDs:n=Object(ce.a)(n),rowIDs:a=Object(ce.a)(a)}},r.groupBy=function(e,t){return 0===e.length?{}:e.reduce((function(e,r){return(e[r[t]]=e[r[t]]||[]).push(r),e}),{})},r.renderSeparator=function(e,t,r){return n.createElement("div",{key:"".concat(e,"-").concat(t),style:{backgroundColor:"#F5F5F9",height:15,borderTop:"1px solid #ECECED",borderBottom:"1px solid #ECECED"}})},r.uuidv4=function(){return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,(function(e){var t=16*Math.random()|0;return("x"===e?t:3&t|8).toString(16)}))},r.renderSectionWrapper=function(){return n.createElement(Wt.StickyContainer,{key:r.uuidv4(),className:"sticky-container",style:{zIndex:4}})},r.renderSectionHeader=function(e,t){var a=new Date(e),i=S[a.getDay()],o=[r.pad(a.getDate()),r.pad(a.getMonth()+1),a.getFullYear()].join("/");return n.createElement(Wt.Sticky,null,(function(e){var t=e.style;return n.createElement("div",{className:"sticky",style:Object(c.a)({},t,{marginTop:"45px",zIndex:4,backgroundColor:"#F8591A",color:"white"})},o," - ",i)}))},r.pad=function(e){return e<10?"0"+e:e},r.renderRow=function(e,t,a,i){var o=r.props,l=o.trips,s=o.tripListType,c=l.find((function(e){return e.id===a}));if(void 0!==c){var u=c.vehicle,p=c.trip_users,d=100*(p||[]).length/(c.extraUsers+1);return n.createElement("div",{key:a,style:{padding:"0 15px"}},n.createElement("div",{style:{textAlign:"right",borderBottom:"2px solid #F6F6F6"}},n.createElement(qt.a,{style:{marginLeft:"5px"},color:"green"},we[c.flgDestination])," ",n.createElement("b",null,c.hour.substr(0,5))),n.createElement("div",{style:{textAlign:"left",borderBottom:"2px solid #F6F6F6"}},n.createElement("b",null,"Partenza:")," ",c.siteDeparture),n.createElement("div",{style:{textAlign:"left",borderBottom:"2px solid #F6F6F6"}},n.createElement("b",null,"Arrivo:")," ",c.siteArrival),n.createElement("div",{style:{textAlign:"left",borderBottom:"2px solid #F6F6F6"}},n.createElement("b",null,"Veicolo: ")," ",u?"".concat(Oe[u.type]," - ").concat(u.sign," - ").concat(u.description):"-"),n.createElement("div",{style:{textAlign:"left"}},n.createElement("div",null,n.createElement("b",null,"Servizio:")," ",c.serviceType),n.createElement("div",null,n.createElement("b",null,"Note:")," ",c.notes)),n.createElement("div",{style:{textAlign:"right"}},"N\xb0 posti disponibili"," ",n.createElement(qt.a,{color:d>=50?"orange":"green",onClick:function(){return r.showBookingUsers(c)}},(p||[]).length,"/",n.createElement("b",null,c.extraUsers+1))),s===w.toBook?n.createElement(zt.b,{style:{marginTop:"5px"},type:"primary",icon:"check-circle",size:"small",onClick:function(){return r.showBookingRoles(c)}},"Prenota"):n.createElement(zt.b,{style:{marginTop:"5px"},type:"warning",icon:"cross-circle-o",size:"small",onClick:function(){return r.cancelBookTrip(c)}},"Annulla prenotazione"))}return n.createElement("div",null,"Data not loaded!")},r.cancelBookTrip=function(e){var t=r.props.onCancelBookTrip;void 0!==t&&t(e)},r.showBookingUsers=function(e){var t=e.trip_users||[];if(0!==t.length){var r={options:t.sort(x).map((function(e){var t,r;return{icon:n.createElement(qe.a,{style:{backgroundColor:j(e.role)},shape:"square",icon:"user"}),title:n.createElement("span",null,(null===(t=e.user)||void 0===t?void 0:t.name)||""," ",(null===(r=e.user)||void 0===r?void 0:r.surname)||""," ",n.createElement("b",null,"(",$e[e.role],")"))}})),title:"Utenti prenotati al servizio",className:"my-saswo-class",cancelButtonText:"Chiudi"};zt.a.showShareActionSheetWithOptions(r)}},r.showBookingRoles=function(e){var t=r.props.user,n=e.trip_users;if(e.extraUsers+1!==(null===n||void 0===n?void 0:n.length)){if(r.roles=[],r.roles.push({roleId:1,role:"Soccorritore"}),void 0!==t)t.withDrivingLicense>0&&(r.roles=[{roleId:0,role:"Autista"}].concat(Object(ce.a)(r.roles))),2===t.committeeUser.occupation&&e.flgNurse>0&&(r.roles=[].concat(Object(ce.a)(r.roles),[{roleId:2,role:"Medico/Sanitario"}]));r.roles=[].concat(Object(ce.a)(r.roles),[{roleId:999,role:"Annulla"}]);var a=r.roles.map((function(e){return e.role}));zt.a.showActionSheetWithOptions({options:a,destructiveButtonIndex:a.length-1,message:"Seleziona il ruolo",maskClosable:!0},(function(n,a){if(-1!==n){var i=r.roles[n].roleId;if(999!==i){var o=r.props.onBookTrip;void 0!==o&&o(e,i,(null===t||void 0===t?void 0:t.id)||0)}}}))}else X.a.info("Servizio al completo")},r.renderFooter=function(){return n.createElement("div",null)};var a=r.buildDataBlobs(e.trips),i=a.dataBlobs,o=a.sectionIDs,l=a.rowIDs,s=new zt.g.DataSource({getRowData:function(e,t,r){return e[r]},getSectionHeaderData:function(e,t){return e[t]},rowHasChanged:function(e,t){return e!==t},sectionHeaderHasChanged:function(e,t){return e!==t}});return s=s.cloneWithRowsAndSections(i,o,l),r.state={dataSource:s},r}return Object(P.a)(t,e),Object(b.a)(t,[{key:"componentWillReceiveProps",value:function(e){var t=e.trips,r=this.buildDataBlobs(t),n=r.dataBlobs,a=r.sectionIDs,i=r.rowIDs;this.setState({dataSource:this.state.dataSource.cloneWithRowsAndSections(n,a,i)})}},{key:"render",value:function(){var e=this.state.dataSource;return n.createElement(zt.g,{dataSource:e,className:"am-list sticky-list",initialListSize:this.props.trips.length,useBodyScroll:!0,renderSectionWrapper:this.renderSectionWrapper,renderSectionHeader:this.renderSectionHeader,renderFooter:this.renderFooter,renderRow:this.renderRow,renderSeparator:this.renderSeparator,onScroll:function(){console.log("scroll")},scrollEventThrottle:200})}}]),t}(n.Component),Kt=zt.i.alert,$t=zt.l.Item;!function(e){e.Logout="1"}(Gt||(Gt={}));var Qt=function(e){function t(e){var r;Object(g.a)(this,t),(r=Object(V.a)(this,Object(F.a)(t).call(this,e))).loadData=function(){r.setState({isLoading:!0},(function(){var e=r.props,t=e.connector,n=e.user,a=[t.getAvailableTrips(),t.getBookedTrips()];Promise.all(a).then((function(e){var t=(e[0]||[]).data.filter((function(e){var t;return e.extraUsers+1!==(null===(t=e.trip_users)||void 0===t?void 0:t.length)})).filter((function(e){return T(e,n)})),a=e[1].data||[];r.setState({availableTrips:t,bookedTrips:a,isLoading:!1})})).catch((function(e){console.error(e),r.setState({availableTrips:[],bookedTrips:[],isLoading:!1})}))}))},r._onLogout=function(){r.props.history.replace({pathname:Y})},r._onCancelBookTrip=function(e){Kt("Attenzione","Sicuro di voler annullare la prenotazione per il viaggio selezionato?",[{text:"Annulla",onPress:function(){}},{text:"Ok",onPress:function(){return r._onClickCancelBookTrip(e)}}])},r._onClickCancelBookTrip=function(e){var t=r.props.user,n=(e.trip_users||[]).find((function(e){return e.userId===(null===t||void 0===t?void 0:t.id)}));if(void 0!==n){var a=n.id;r.props.connector.deleteTripUsers(a).then((function(e){r.loadData()})).catch((function(e){console.error("_onDeleteTripUser: ".concat(e)),X.a.error("Si \xe8 verificato un errore nell'eliminazione")}))}else X.a.error("Si \xe8 verificato un errore nella richiesta")},r._onBookTrip=function(e,t,n){var a={id:0,tripId:e.id,userId:n,role:t};r.setState({isLoading:!0}),r.props.connector.publishTripUser(a).then((function(e){X.a.success("Prenotazione effettuata con successo"),r.setState({isLoading:!1},(function(){r.loadData()}))})).catch((function(e){console.log(e);var t="Si \xe8 verificato un errore nella richiesta";e.response&&e.response.data&&e.response.data.message&&(t=e.response.data.message),r.setState({isLoading:!1},(function(){X.a.error(t)}))}))},r._onClickLogout=function(){r.props.resetAuthData(),r._onLogout()},r._onSelectRightTopMenu=function(e,t){switch(e.key){case Gt.Logout:Kt("Attenzione","Sicuro di voler uscire?",[{text:"Annulla",onPress:function(){}},{text:"Ok",onPress:function(){return r._onClickLogout()}}])}r.setState({rightTopMenuVisible:!1})},r._rightTopMenuVisibleChange=function(e){r.setState({rightTopMenuVisible:e})};var n=r.props,a=n.user,i=n.committee;return a||i||r._onLogout(),r.state={selectedTab:"servicesTab",hidden:!1,rightTopMenuVisible:!1,isLoading:!0,availableTrips:[],bookedTrips:[]},r}return Object(P.a)(t,e),Object(b.a)(t,[{key:"componentDidMount",value:function(){this.loadData()}},{key:"renderTabContent",value:function(){var e=this;return this.state.isLoading?a.a.createElement("div",{style:{textAlign:"center",marginTop:"10px"}},"Caricamento in corso..."):a.a.createElement("div",{style:{height:"100%",textAlign:"center"}},a.a.createElement(M.a,{path:q,component:function(){return a.a.createElement(Jt,{trips:e.state.availableTrips,tripListType:w.toBook,user:e.props.user,onBookTrip:e._onBookTrip})}}),a.a.createElement(M.a,{path:G,component:function(){return a.a.createElement(Jt,{trips:e.state.bookedTrips,tripListType:w.booked,user:e.props.user,onCancelBookTrip:e._onCancelBookTrip})}}),a.a.createElement(M.a,{path:J,exact:!0,component:Ht}))}},{key:"render",value:function(){var e=this,t=this.props.committee;return a.a.createElement("div",null,a.a.createElement(zt.j,{mode:"dark",leftContent:a.a.createElement("span",{style:{fontSize:"12px",fontWeight:"bold"}},"Servizio Facile v.1.0"),rightContent:[a.a.createElement($.a,{key:"0",type:"reload",style:{marginRight:"5px"},onClick:this.loadData}),a.a.createElement(zt.l,{key:"1",visible:this.state.rightTopMenuVisible,overlay:[a.a.createElement($t,{key:Gt.Logout},"Logout")],onVisibleChange:this._rightTopMenuVisibleChange,onSelect:this._onSelectRightTopMenu},a.a.createElement("div",{style:{height:"100%",padding:"0 15px",marginRight:"-15px",display:"flex",alignItems:"center"}},a.a.createElement(zt.d,{type:"ellipsis"})))]},a.a.createElement("span",{style:{fontSize:"12px"}},null===t||void 0===t?void 0:t.description)),a.a.createElement("div",{style:{position:"fixed",height:"calc(100% - 45px)",width:"100%",top:45}},a.a.createElement(zt.m,{unselectedTintColor:"#949494",tintColor:"#33A3F4",barTintColor:"white",tabBarPosition:"bottom",hidden:this.state.hidden,prerenderingSiblingsNumber:0},a.a.createElement(zt.m.Item,{title:"Servizi disponibili",key:"Servizi",icon:a.a.createElement($.a,{type:"calendar"}),selectedIcon:a.a.createElement($.a,{type:"calendar"}),selected:"servicesTab"===this.state.selectedTab,badge:this.state.availableTrips.length,onPress:function(){e.setState({selectedTab:"servicesTab"},(function(){return e.props.history.replace(q)}))},"data-seed":"logId"},this.renderTabContent()),a.a.createElement(zt.m.Item,{title:"Servizi prenotati",key:"booked_services",icon:a.a.createElement($.a,{type:"book"}),selectedIcon:a.a.createElement($.a,{type:"book"}),selected:"bookedServicesTab"===this.state.selectedTab,badge:this.state.bookedTrips.length,onPress:function(){e.setState({selectedTab:"bookedServicesTab"},(function(){return e.props.history.replace(G)}))},"data-seed":"logId1"},this.renderTabContent()),a.a.createElement(zt.m.Item,{title:"Area personale",key:"personal_area",icon:a.a.createElement($.a,{type:"user"}),selectedIcon:a.a.createElement($.a,{type:"user"}),selected:"personalAreaTab"===this.state.selectedTab,onPress:function(){e.setState({selectedTab:"personalAreaTab"},(function(){return e.props.history.replace(J)}))},"data-seed":"logId2"},this.renderTabContent()))))}}]),t}(a.a.Component),Xt=Object(A.b)((function(e,t){return{user:e.appData.user,committee:e.appData.committee,connector:e.appData.connector}}),{resetAuthData:d})(Qt),Zt=function(e){function t(){return Object(g.a)(this,t),Object(V.a)(this,Object(F.a)(t).apply(this,arguments))}return Object(P.a)(t,e),Object(b.a)(t,[{key:"render",value:function(){return a.a.createElement(z.a,null,a.a.createElement(M.c,null,a.a.createElement(M.a,{exact:!0,path:L,component:le}),a.a.createElement(M.a,{exact:!0,path:Y,component:le}),a.a.createElement(M.a,{path:B,component:Pt}),a.a.createElement(M.a,{path:[q,G,J],component:Xt})))}}]),t}(a.a.Component);function er(){return Object(s.c)(U)}r.d(t,"configureStore",(function(){return er})),o.a.render(a.a.createElement(A.a,{store:er()},a.a.createElement(Zt,null)),document.getElementById("root")),"serviceWorker"in navigator&&navigator.serviceWorker.ready.then((function(e){e.unregister()}))}},[[279,1,2]]]);
//# sourceMappingURL=main.b9bf532c.chunk.js.map