(this["webpackJsonpredcross-portal"]=this["webpackJsonpredcross-portal"]||[]).push([[0],{251:function(e,t,a){e.exports=a(485)},256:function(e,t,a){},485:function(e,t,a){"use strict";a.r(t);var r=a(0),n=a.n(r),i=a(8),o=a.n(i);a(256),Boolean("localhost"===window.location.hostname||"[::1]"===window.location.hostname||window.location.hostname.match(/^127(?:\.(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)){3}$/));a(257);var l,c=a(87),s=a(32);function u(e){return{type:l.SET_USERS_DATA,data:{users:e}}}function p(e){return{type:l.SET_USER_DATA,data:{user:e}}}!function(e){e.SET_SHOW_LOADING="SET_SHOW_LOADING",e.SET_USER_DATA="SET_USER_DATA",e.SET_COMMITTEE_DATA="SET_COMMITTEE_DATA",e.RESET_AUTH_DATA="RESET_AUTH_DATA",e.SET_USERS_DATA="SET_USERS_DATA"}(l||(l={}));var m,d=a(17),h=a.n(d),f=a(34),v=a(20),E=a(21),g=a(176),b=a.n(g),y=function(){function e(t,a){Object(v.a)(this,e),this.axiosInstance=void 0,this.username=void 0,this.password=void 0,this.username=t,this.password=a;var r=btoa("".concat(this.username,":").concat(this.password)),n={Authorization:"Basic ".concat(r),"Content-Type":"application/json"};this.axiosInstance=b.a.create({baseURL:void 0,headers:n})}return Object(E.a)(e,[{key:"getCommittees",value:function(){var e=Object(f.a)(h.a.mark((function e(){return h.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return"api/committees",e.next=3,this.call("api/committees");case 3:return e.abrupt("return",e.sent);case 4:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"getVehicles",value:function(){var e=Object(f.a)(h.a.mark((function e(t){var a;return h.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return a="api/vehicles/findByCommittee/".concat(t),e.next=3,this.call(a);case 3:return e.abrupt("return",e.sent);case 4:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"publishVehicle",value:function(){var e=Object(f.a)(h.a.mark((function e(t){var a,r,n;return h.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return a=t.id,r="api/vehicles/".concat(a>0?a:""),n=JSON.stringify(t),e.next=5,this.call(r,n,a>0?"PUT":"POST");case 5:return e.abrupt("return",e.sent);case 6:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"deleteVehicle",value:function(){var e=Object(f.a)(h.a.mark((function e(t){var a,r;return h.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return a=t.id,r="api/vehicles/".concat(a),e.next=4,this.call(r,void 0,"DELETE");case 4:return e.abrupt("return",e.sent);case 5:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"deleteTripUsersByTrip",value:function(){var e=Object(f.a)(h.a.mark((function e(t){var a;return h.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return a="api/trips_users/deleteByTrip/".concat(t),e.next=3,this.call(a,void 0,"DELETE");case 3:return e.abrupt("return",e.sent);case 4:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"deleteTripUsers",value:function(){var e=Object(f.a)(h.a.mark((function e(t){var a;return h.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return a="api/trips_users/".concat(t),e.next=3,this.call(a,void 0,"DELETE");case 3:return e.abrupt("return",e.sent);case 4:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"deleteCommitteesUsers",value:function(){var e=Object(f.a)(h.a.mark((function e(t){var a;return h.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return a="api/committees_users/deleteByUserId/".concat(t),e.next=3,this.call(a,void 0,"DELETE");case 3:return e.abrupt("return",e.sent);case 4:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"getUserTrips",value:function(){var e=Object(f.a)(h.a.mark((function e(t){var a;return h.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return a="api/trips_users/findByUserId/".concat(t),e.next=3,this.call(a);case 3:return e.abrupt("return",e.sent);case 4:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"deleteTrip",value:function(){var e=Object(f.a)(h.a.mark((function e(t){var a;return h.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return a="api/trips/".concat(t),e.next=3,this.call(a,void 0,"DELETE");case 3:return e.abrupt("return",e.sent);case 4:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"getTrips",value:function(){var e=Object(f.a)(h.a.mark((function e(t){var a;return h.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return a="api/trips/findByCommittee/".concat(t),e.next=3,this.call(a);case 3:return e.abrupt("return",e.sent);case 4:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"publishTrip",value:function(){var e=Object(f.a)(h.a.mark((function e(t){var a,r,n;return h.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return a=t.id,r="api/trips/".concat(a>0?a:""),n=JSON.stringify(t),e.next=5,this.call(r,n,a>0?"PUT":"POST");case 5:return e.abrupt("return",e.sent);case 6:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"publishTripUser",value:function(){var e=Object(f.a)(h.a.mark((function e(t){var a,r,n;return h.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return a=t.id,r="api/trips_users/".concat(a>0?a:""),n=JSON.stringify(t),e.next=5,this.call(r,n,a>0?"PUT":"POST");case 5:return e.abrupt("return",e.sent);case 6:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"getUsers",value:function(){var e=Object(f.a)(h.a.mark((function e(t){var a;return h.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return a="api/users/findByCommittee/".concat(t),e.next=3,this.call(a);case 3:return e.abrupt("return",e.sent);case 4:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"deleteUser",value:function(){var e=Object(f.a)(h.a.mark((function e(t){var a;return h.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return a="api/users/".concat(t),e.next=3,this.call(a,void 0,"DELETE");case 3:return e.abrupt("return",e.sent);case 4:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"deleteCommitteeUser",value:function(){var e=Object(f.a)(h.a.mark((function e(t){var a;return h.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return a="api/committees_users/".concat(t),e.next=3,this.call(a,void 0,"DELETE");case 3:return e.abrupt("return",e.sent);case 4:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"publishUser",value:function(){var e=Object(f.a)(h.a.mark((function e(t){var a,r,n;return h.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return a=t.id,r="api/users/".concat(a>0?a:""),n=JSON.stringify(t),e.abrupt("return",this.call(r,n,a>0?"PUT":"POST"));case 4:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"publishUserCommittee",value:function(){var e=Object(f.a)(h.a.mark((function e(t,a){var r,n,i,o,l,c;return h.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.publishUser(t);case 2:if(200===(r=e.sent).status){e.next=6;break}throw console.log(r),new Error("Si \xe8 verificato un errore nell'inserimento");case 6:return n=t.id,i=r.data,o={id:a.id,userId:n>0?n:i.id,committeeId:a.committeeId,role:a.role,occupation:a.occupation,disabled:a.disabled},l=JSON.stringify(o),c="api/committees_users/".concat(a.id>0?a.id:""),e.next=13,this.call(c,l,a.id>0?"PUT":"POST");case 13:return e.abrupt("return",e.sent);case 14:case"end":return e.stop()}}),e,this)})));return function(t,a){return e.apply(this,arguments)}}()},{key:"findUserByUsername",value:function(){var e=Object(f.a)(h.a.mark((function e(t,a){var r,n,i,o;return h.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r="api/users/findbyusername/".concat(t),n=btoa("".concat(t,":").concat(a)),i={Authorization:"Basic ".concat(n)},void 0,o=b.a.create({baseURL:void 0,headers:i}),e.abrupt("return",o({url:r,method:"GET"}));case 7:case"end":return e.stop()}}),e)})));return function(t,a){return e.apply(this,arguments)}}()},{key:"call",value:function(){var e=Object(f.a)(h.a.mark((function e(t,a){var r,n=arguments;return h.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r=n.length>2&&void 0!==n[2]?n[2]:"GET",e.abrupt("return",this.axiosInstance({url:t,method:r,data:a}));case 2:case"end":return e.stop()}}),e,this)})));return function(t,a){return e.apply(this,arguments)}}()}]),e}(),S={user:void 0,committee:void 0,users:[],connector:new y("",""),showLoading:!1},D=Object(c.b)({appData:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:S,t=arguments.length>1?arguments[1]:void 0;switch(t.type){case l.SET_USER_DATA:var a,r=t.data.user,n=r&&Object(s.a)({},r)||void 0;r&&(a=new y(r.username,r.password),r.committee_users&&(n=Object(s.a)({},r,{committeeUser:r.committee_users[0]})));var i=Object(s.a)({},e,{user:n,connector:a});return i;case l.SET_COMMITTEE_DATA:var o=t.data.committee;return Object(s.a)({},e,{committee:o});case l.SET_SHOW_LOADING:return Object(s.a)({},e,{showLoading:t.data});case l.RESET_AUTH_DATA:return Object(s.a)({},e,{user:void 0,committee:void 0,connector:new y("",""),users:[]});case l.SET_USERS_DATA:var c=t.data.users,u=(c||[]).map((function(e){return Object(s.a)({},e,{committeeUser:e.committee_users[0]})}));return Object(s.a)({},e,{users:u});default:return e}}}),w=a(43),O=a(23),k=a(22),T=a(24),C=a(175),_=a(70),x="/",j="/",U="/services",A="/users",I="/vehicles",V="/personal_area",z=a(109),F=a(9),M=a(496),L=a(501),N=a(498),R=a(96),P=a(55),B=a(497),H=a(40),Y=z.a.Option,q=function(e){function t(){var e,a;Object(v.a)(this,t);for(var n=arguments.length,i=new Array(n),o=0;o<n;o++)i[o]=arguments[o];return(a=Object(O.a)(this,(e=Object(k.a)(t)).call.apply(e,[this].concat(i)))).state={committees:[],loading:!1},a.connector=void 0,a.handleSelectChange=function(e){a.props.form.setFieldsValue({committeeId:e})},a.buildCommitteesSelect=function(){var e=a.state.committees;if(0===e.length)return r.createElement(F.a,{type:"loading"});var t=a.props.form.getFieldDecorator;return r.createElement(M.a.Item,null,t("committeeId",{rules:[{required:!0,message:"Selezionare il comitato"}]})(r.createElement(z.a,{onChange:a.handleSelectChange},e.map((function(e){return r.createElement(Y,{key:e.id,value:e.id},e.description)})))))},a.handleSubmit=function(e){e.preventDefault(),a.props.form.validateFields((function(e,t){e||a.setState({loading:!0},(function(){var e=t.committeeId;a.props.connector.findUserByUsername(t.username,t.password).then((function(t){a.setState({loading:!1});var r=t.data,n=r.committee_users;if(n){var i=n.find((function(t){return t.committeeId===e}));i?i.disabled?L.a.error("Utente non abilitato al comitato selezionato"):(a.props.setUserData(r),a.props.setCommitteeData(i.committee),a.props.connector.getUsers(e).then((function(e){L.a.success("Autenticato"),a.props.setUsersData(e.data),a.props.history.push(U)})).catch((function(e){L.a.error("Si \xe8 verificato un errore nel recupero degli utenti"),console.log("Error retrieving users. Error: ".concat(e))}))):L.a.error("Utente non abilitato al comitato selezionato")}else L.a.error("Utente non abilitato al comitato selezionato")})).catch((function(e){a.setState({loading:!1},(function(){return L.a.error("Username e password non validi")})),console.error(e)}))}))}))},a}return Object(T.a)(t,e),Object(E.a)(t,[{key:"componentDidMount",value:function(){var e=this;this.props.connector.getCommittees().then((function(t){e.setState(Object(s.a)({},e.state,{committees:t.data}),(function(){t.data&&t.data[0]&&(e.handleSelectChange(t.data[0].id),e.props.form.setFieldsValue({username:"f.marchetti",password:"default"}))}))})).catch((function(e){console.log(e)}))}},{key:"render",value:function(){var e=this.props.form.getFieldDecorator,t=this.state.committees;return r.createElement(N.a,{visible:!0,closable:!1,confirmLoading:!1,footer:null},r.createElement("div",{style:{textAlign:"right"}},r.createElement("b",null,"Servizio Facile v.1.0")),r.createElement(R.a,{gutter:8},r.createElement(P.a,{span:24},r.createElement("img",{alt:"",src:"/red_cross_logo.png",width:"100%"}))),r.createElement(M.a,{onSubmit:this.handleSubmit,className:"login-form"},r.createElement(M.a.Item,null,e("username",{rules:[{required:!0,message:"Username obbligatoria"}]})(r.createElement(B.a,{prefix:r.createElement(F.a,{type:"user",style:{color:"rgba(0,0,0,.25)"}}),placeholder:"Digitare il proprio username"}))),r.createElement(M.a.Item,null,e("password",{rules:[{required:!0,message:"Password obbligatoria"}]})(r.createElement(B.a,{prefix:r.createElement(F.a,{type:"lock",style:{color:"rgba(0,0,0,.25)"}}),type:"password",placeholder:"Digitare la propria password"}))),this.buildCommitteesSelect(),r.createElement(M.a.Item,null,r.createElement(H.a,{loading:this.state.loading,disabled:null===t||void 0===t||0===t.length,type:"primary",htmlType:"submit",style:{width:"100%"},className:"login-form-button"},"Log in"))))}}]),t}(r.Component),W=M.a.create({name:"normal_login"})(q),G=Object(w.b)((function(e,t){return{user:e.appData.user,connector:e.appData.connector}}),{setUserData:p,setCommitteeData:function(e){return{type:l.SET_COMMITTEE_DATA,data:{committee:e}}},setUsersData:u})(W),J=a(491),K=a(182),$=a(93),Q=a(488),X=a(243),Z=a(499),ee=a(492),te=(a(215),a(245)),ae=function(e){function t(){return Object(v.a)(this,t),Object(O.a)(this,Object(k.a)(t).apply(this,arguments))}return Object(T.a)(t,e),Object(E.a)(t,[{key:"render",value:function(){return r.createElement(te.a,{mainButtonStyles:{backgroundColor:"#1890ff"},alwaysShowTitle:!1,event:"click",icon:r.createElement("span",null,"+"),position:{bottom:25,right:25},onClick:this.props.onClick})}}]),t}(r.Component),re={0:"Superuser",1:"Admin",2:"Utente"},ne={0:"Dipendente",1:"Volontario",2:"Medico/Sanitario",3:"Altro"},ie="Maschio",oe="Femmina",le=a(494),ce=a(487),se=a(14),ue=a.n(se),pe=z.a.Option,me=function(e){function t(){var e,a;Object(v.a)(this,t);for(var r=arguments.length,n=new Array(r),i=0;i<r;i++)n[i]=arguments[i];return(a=Object(O.a)(this,(e=Object(k.a)(t)).call.apply(e,[this].concat(n)))).getInitialValueBirthDate=function(){var e=a.props.user;return(null===e||void 0===e?void 0:e.birth_date)?ue()(e.birth_date):void 0},a.handleSubmit=function(e){e.preventDefault(),a.props.form.validateFields((function(e,t){if(!e){var r=Object(s.a)({},t,{birth_date:t.birth_date?t.birth_date.format("YYYY-MM-DD"):void 0,committeeUser:{id:t.committeeUserId,userId:t.id,committeeId:t.committeeId,role:t.role,occupation:t.occupation,disabled:t.disabled}});a.props.onSave(r)}}))},a}return Object(T.a)(t,e),Object(E.a)(t,[{key:"render",value:function(){var e,t,a,n,i,o,l,c,s,u,p,m,d,h,f=this.props.form.getFieldDecorator,v=this.props,E=v.user,g=v.onCancel,b=v.personalArea;return r.createElement(M.a,{layout:"vertical",onSubmit:this.handleSubmit},r.createElement(R.a,{gutter:16},r.createElement(P.a,{span:12},r.createElement(M.a.Item,{label:"Username"},f("username",{initialValue:null===(e=this.props.user)||void 0===e?void 0:e.username,rules:[{required:!0,message:"Specificare il nome utente"}]})(r.createElement(B.a,{disabled:E&&E.id>0,placeholder:"Specificare il nome utente"})))),r.createElement(P.a,{span:12},r.createElement(M.a.Item,{label:"Password"},f("password",{initialValue:null===(t=this.props.user)||void 0===t?void 0:t.password,rules:[{required:!0,message:"Specificare la password"}]})(b?r.createElement(B.a.Password,{placeholder:"Specificare la password"}):r.createElement(B.a,{type:"password",placeholder:"Specificare la password"}))))),r.createElement(R.a,{gutter:16},r.createElement(P.a,{span:12},r.createElement(M.a.Item,{label:"Nome"},f("name",{initialValue:null===(a=this.props.user)||void 0===a?void 0:a.name,rules:[{required:!0,message:"Specificare il nome"}]})(r.createElement(B.a,{placeholder:"Specificare il nome"})))),r.createElement(P.a,{span:12},r.createElement(M.a.Item,{label:"Cognome"},f("surname",{initialValue:null===(n=this.props.user)||void 0===n?void 0:n.surname,rules:[{required:!0,message:"Specificare il cognome"}]})(r.createElement(B.a,{placeholder:"Specificare il cognome"}))))),r.createElement(R.a,{gutter:16},r.createElement(P.a,{span:12},r.createElement(M.a.Item,{label:"Data di nascita"},f("birth_date",{initialValue:this.getInitialValueBirthDate(),rules:[]})(r.createElement(le.a,{format:"DD-MM-YYYY"})))),r.createElement(P.a,{span:12},r.createElement(M.a.Item,{label:"Sesso"},f("gender",{initialValue:null===(i=this.props.user)||void 0===i?void 0:i.gender,rules:[{required:!0,message:"Specificare il sesso"}]})(r.createElement(z.a,{placeholder:"Sesso"},r.createElement(pe,{value:0},ie),r.createElement(pe,{value:1},oe)))))),r.createElement(R.a,{gutter:16},r.createElement(P.a,{span:24},r.createElement(M.a.Item,{label:"Email"},f("email",{initialValue:null===(o=this.props.user)||void 0===o?void 0:o.email,rules:[]})(r.createElement(B.a,{placeholder:"Specificare l'email"}))))),r.createElement(R.a,{gutter:16,style:{visibility:b?"collapse":"visible"}},r.createElement(P.a,{span:12},r.createElement(M.a.Item,{label:"Ruolo"},f("role",{initialValue:null===(l=this.props.user)||void 0===l?void 0:l.committeeUser.role,rules:[{required:!0,message:"Specificare il ruolo"}]})(r.createElement(z.a,{placeholder:"Role"},r.createElement(pe,{value:1},re[1]),r.createElement(pe,{value:2},re[2]))))),r.createElement(P.a,{span:12},r.createElement(M.a.Item,{label:"Occupazione"},f("occupation",{initialValue:null===(c=this.props.user)||void 0===c?void 0:c.committeeUser.occupation,rules:[{required:!0,message:"Specificare l'occupazione"}]})(r.createElement(z.a,{placeholder:"Occupazione"},r.createElement(pe,{value:0},ne[0]),r.createElement(pe,{value:1},ne[1]),r.createElement(pe,{value:2},ne[2])))))),r.createElement(R.a,{style:{visibility:b?"collapse":"visible"}},r.createElement(P.a,{span:12},r.createElement(M.a.Item,{label:"Con patente"},f("withDrivingLicense",{initialValue:null===(s=this.props.user)||void 0===s?void 0:s.withDrivingLicense,valuePropName:"checked"})(r.createElement(ce.a,null)))),r.createElement(P.a,{span:12},r.createElement(M.a.Item,{label:"Disabilita"},f("disabled",{initialValue:null===(u=this.props.user)||void 0===u?void 0:u.committeeUser.disabled,valuePropName:"checked"})(r.createElement(ce.a,null))))),r.createElement(R.a,{gutter:16,style:{visibility:"collapse"}},r.createElement(P.a,{span:6},r.createElement(M.a.Item,{label:"Id"},f("id",{initialValue:null===(p=this.props.user)||void 0===p?void 0:p.id})(r.createElement(B.a,{placeholder:"Specificare id utente"})))),r.createElement(P.a,{span:6},r.createElement(M.a.Item,{label:"Password modificata"},f("flgPasswordChanged",{initialValue:null===(m=this.props.user)||void 0===m?void 0:m.flgPasswordChanged})(r.createElement(B.a,{placeholder:"Password modificata"})))),r.createElement(P.a,{span:6},r.createElement(M.a.Item,{label:"CommitteeUserId"},f("committeeUserId",{initialValue:null===(d=this.props.user)||void 0===d?void 0:d.committeeUser.id})(r.createElement(B.a,{placeholder:"CommitteeUserId"})))),r.createElement(P.a,{span:6},r.createElement(M.a.Item,{label:"CommitteeId"},f("committeeId",{initialValue:null===(h=this.props.user)||void 0===h?void 0:h.committeeUser.committeeId})(r.createElement(B.a,{placeholder:"CommitteeId"}))))),r.createElement("div",{style:{position:"absolute",right:0,bottom:0,width:"100%",borderTop:"1px solid #e9e9e9",padding:"10px 16px",background:"#fff",textAlign:"right"}},r.createElement(H.a,{onClick:g,style:{marginRight:8}},"Annulla"),r.createElement(H.a,{htmlType:"submit",type:"primary"},"Salva")))}}]),t}(r.Component),de=M.a.create({name:"user_form "})(me),he=function(e){function t(){return Object(v.a)(this,t),Object(O.a)(this,Object(k.a)(t).apply(this,arguments))}return Object(T.a)(t,e),Object(E.a)(t,[{key:"render",value:function(){return r.createElement(de,this.props)}}]),t}(r.Component),fe=function(e){function t(){var e,a,n;Object(v.a)(this,t);for(var i=arguments.length,o=new Array(i),l=0;l<i;l++)o[l]=arguments[l];return(n=Object(O.a)(this,(e=Object(k.a)(t)).call.apply(e,[this].concat(o)))).columns=[{title:"Username",dataIndex:"username",key:"username",render:function(e,t){return r.createElement("b",null,e)}},{title:"Nome",dataIndex:"name",key:"name"},{title:"Cognome",dataIndex:"surname",key:"surname"},{title:"Data di nascita",dataIndex:"birth_date",key:"birth_date"},{title:"Ruolo",dataIndex:"committeeUser.role",key:"role",render:function(e,t){return r.createElement("span",null,re[e])}},{title:"Occupazione",dataIndex:"committeeUser.occupation",key:"occupation",render:function(e,t){return r.createElement("span",null,ne[e])}},{title:"Con patente",dataIndex:"withDrivingLicense",key:"withDrivingLicense",render:function(e,t){return r.createElement("p",null,0===e?void 0:r.createElement(F.a,{type:"check"}))}},{title:"Disabilitato",dataIndex:"committeeUser.disabled",key:"disabled",render:function(e,t){return r.createElement("p",null,0===e?void 0:r.createElement(F.a,{type:"check"}))}},{title:"",key:"action",render:function(e,t){return r.createElement("span",null,r.createElement($.a,{title:"Modifica"},r.createElement(H.a,{size:"small",icon:"edit",onClick:function(){return n._onEditRow(t)}})),r.createElement(Q.a,{placement:"topLeft",title:"Confermare l'eliminazione dell'utente?",onConfirm:function(){return n._onDeleteUser(t)},okText:"Si",cancelText:"No"},r.createElement(H.a,{size:"small",style:{marginLeft:"1px"},icon:"delete",type:"danger"})))}}],n.emptyUser={id:0,username:"",password:"",flgPasswordChanged:0,name:"",surname:"",birth_date:void 0,email:void 0,gender:0,withDrivingLicense:0,superuser:0,committeeUser:{id:0,committeeId:(null===(a=n.props.committee)||void 0===a?void 0:a.id)||0,userId:0,role:2,occupation:0,disabled:0}},n.state={loading:!1,showForm:!1},n.loadData=function(){var e=n.props.committee;void 0!==e&&n.props.connector.getUsers(e.id).then((function(e){n.setState({loading:!1},(function(){n.props.setUsersData(e.data)}))})).catch((function(e){L.a.error("Si \xe8 verificato un errore nella lettura degli utenti"),n.setState({loading:!1}),console.error(e)}))},n._onClose=function(){n.setState({showForm:!1,selectedUser:void 0})},n._onEditRow=function(e){n.setState({selectedUser:e,showForm:!0})},n._onDeleteUser=function(e){n.props.connector.getUserTrips(e.id).then((function(t){(t.data||[]).length>0?L.a.error("Utente gi\xe0 assegnato a servizi. Impossibile eliminare"):n.props.connector.deleteCommitteesUsers(e.id).then((function(t){n.props.connector.deleteUser(e.id).then((function(e){n.loadData()})).catch((function(e){console.error("_onDeleteUser - deleteUser: ".concat(e)),L.a.error("Si \xe8 verificato un errore durante l'eliminazione")}))})).catch((function(e){console.error("_onDeleteUser - deleteCommitteesUsers: ".concat(e)),L.a.error("Si \xe8 verificato un errore durante l'eliminazione")}))})).catch((function(e){console.error("_onDeleteUser - getUserTrips: ".concat(e)),L.a.error("Si \xe8 verificato un errore durante l'eliminazione")}))},n._onSave=function(e){var t=e.committeeUser;if(!t)return console.warn("Expected NOT NULL 'committee' - This should never happen!"),void L.a.error("Si \xe8 verificato un errore nel salvataggio");n.props.connector.publishUserCommittee(e,t).then((function(e){L.a.success("Salvataggio completato"),n.setState({showForm:!1,selectedUser:void 0},(function(){n.loadData()}))})).catch((function(e){console.log(e),L.a.error("Si \xe8 verificato un errore nel salvataggio")}))},n._onCreate=function(){n.setState({selectedUser:n.emptyUser,showForm:!0})},n.getDataSource=function(){var e=n.props,t=e.user,a=e.users;return void 0!==t?0===t.superuser?a.filter((function(e){return 0===e.superuser})):a:[]},n}return Object(T.a)(t,e),Object(E.a)(t,[{key:"render",value:function(){var e,t,a=this.state,n=a.loading,i=a.selectedUser,o=a.showForm;return r.createElement("div",null,n?r.createElement("div",{style:{textAlign:"center"}},r.createElement(X.a,null)):r.createElement("div",null,r.createElement(ee.a,{columns:this.columns,pagination:{pageSize:10},dataSource:this.getDataSource()}),r.createElement(Z.a,{title:"".concat(0===(null===(e=i)||void 0===e?void 0:e.id)?"Crea":"Modifica"," utente"),width:480,onClose:this._onClose,visible:o,bodyStyle:{paddingBottom:80}},o?r.createElement(he,{loggedUserId:(null===(t=this.props.user)||void 0===t?void 0:t.id)||0,user:i,onCancel:this._onClose,onSave:this._onSave}):void 0),o?void 0:r.createElement(ae,{onClick:this._onCreate})))}}]),t}(r.Component),ve=Object(w.b)((function(e,t){return{user:e.appData.user,connector:e.appData.connector,committee:e.appData.committee,users:e.appData.users}}),{setUsersData:u})(fe),Ee={0:"Furgone",1:"Ambulanza",2:"Autovettura"},ge=z.a.Option,be=function(e){function t(){var e,a;Object(v.a)(this,t);for(var r=arguments.length,n=new Array(r),i=0;i<r;i++)n[i]=arguments[i];return(a=Object(O.a)(this,(e=Object(k.a)(t)).call.apply(e,[this].concat(n)))).handleSubmit=function(e){e.preventDefault(),a.props.form.validateFields((function(e,t){if(!e){var r=a.props.vehicle,n=Object(s.a)({},t,{id:r.id,committeeId:r.committeeId,committee:r.committee});a.props.onSave(n)}}))},a}return Object(T.a)(t,e),Object(E.a)(t,[{key:"componentWillReceiveProps",value:function(e){var t=e.vehicle;void 0!==t&&JSON.stringify(this.props.vehicle)!==JSON.stringify(e.vehicle)&&e.form.setFieldsValue({type:t.type,plate:t.plate,sign:t.sign,description:t.description,disabled:t.disabled})}},{key:"render",value:function(){var e,t=this.props.form.getFieldDecorator;return r.createElement(Z.a,{title:"".concat(0===(null===(e=this.props.vehicle)||void 0===e?void 0:e.id)?"Crea":"Modifica"," veicolo"),width:480,onClose:this.props.onClose,visible:this.props.visible,bodyStyle:{paddingBottom:80}},r.createElement(M.a,{layout:"vertical",onSubmit:this.handleSubmit},r.createElement(R.a,{gutter:16},r.createElement(P.a,{span:24},r.createElement(M.a.Item,{label:"Tipo"},t("type",{rules:[{required:!0,message:"Specificare il tipo"}],initialValue:"0"})(r.createElement(z.a,{placeholder:"Tipologia"},r.createElement(ge,{value:0},Ee[0]),r.createElement(ge,{value:1},Ee[1]),r.createElement(ge,{value:2},Ee[2])))))),r.createElement(R.a,{gutter:16},r.createElement(P.a,{span:24},r.createElement(M.a.Item,{label:"Targa"},t("plate",{rules:[{required:!0,message:"Specificare la targa"}]})(r.createElement(B.a,{placeholder:"Specificare la targa"}))))),r.createElement(R.a,{gutter:16},r.createElement(P.a,{span:24},r.createElement(M.a.Item,{label:"Sigla"},t("sign",{rules:[{required:!1,message:"Specificare la sigla"}]})(r.createElement(B.a,{placeholder:"Specificare una sigla"}))))),r.createElement(R.a,{gutter:16},r.createElement(P.a,{span:24},r.createElement(M.a.Item,{label:"Descrizione"},t("description",{rules:[{required:!1}]})(r.createElement(B.a.TextArea,{rows:4,placeholder:"Specificare una descrizione"}))))),r.createElement(R.a,null,r.createElement(P.a,{span:12},r.createElement(M.a.Item,{label:"Disabilita"},t("disabled",{valuePropName:"checked"})(r.createElement(ce.a,null))))),r.createElement("div",{style:{position:"absolute",right:0,bottom:0,width:"100%",borderTop:"1px solid #e9e9e9",padding:"10px 16px",background:"#fff",textAlign:"right"}},r.createElement(H.a,{onClick:this.props.onClose,style:{marginRight:8}},"Annulla"),r.createElement(H.a,{htmlType:"submit",type:"primary"},"Salva"))))}}]),t}(r.Component),ye=M.a.create({name:"vehicle_form "})(be),Se=function(e){function t(){return Object(v.a)(this,t),Object(O.a)(this,Object(k.a)(t).apply(this,arguments))}return Object(T.a)(t,e),Object(E.a)(t,[{key:"render",value:function(){return r.createElement(ye,this.props)}}]),t}(r.Component),De=function(e){function t(){var e,a,n;Object(v.a)(this,t);for(var i=arguments.length,o=new Array(i),l=0;l<i;l++)o[l]=arguments[l];return(n=Object(O.a)(this,(e=Object(k.a)(t)).call.apply(e,[this].concat(o)))).columns=[{title:"Targa",dataIndex:"plate",key:"plate"},{title:"Sigla",dataIndex:"sign",key:"sign"},{title:"Tipologia",dataIndex:"type",key:"type",render:function(e,t){return r.createElement("span",null,Ee[e])}},{title:"Descrizione",dataIndex:"description",key:"description"},{title:"Disabilitato",dataIndex:"disabled",key:"disabled",render:function(e,t){return r.createElement("p",null,0===e?void 0:r.createElement(F.a,{type:"close"}))}},{title:"",key:"action",render:function(e,t){return r.createElement("span",null,r.createElement($.a,{title:"Modifica"},r.createElement(H.a,{size:"small",icon:"edit",onClick:function(){return n._onEditVehicle(t)}})),r.createElement(Q.a,{placement:"topLeft",title:"Confermare l'eliminazione?",onConfirm:function(){return n._onDeleteVehicle(t)},okText:"Si",cancelText:"No"},r.createElement(H.a,{size:"small",style:{marginLeft:"1px"},icon:"delete",type:"danger"})))}}],n.emptyVehicle={id:0,type:0,plate:"",sign:"",description:"",disabled:0,committeeId:(null===(a=n.props.committee)||void 0===a?void 0:a.id)||0,committee:n.props.committee},n.state={loading:!0,showForm:!1,selectedVehicle:void 0,vehicles:[]},n.loadData=function(){var e=n.props.committee;void 0!==e&&n.props.connector.getVehicles(e.id).then((function(e){n.setState({vehicles:e.data,loading:!1})})).catch((function(e){n.setState({vehicles:[],loading:!1}),console.error(e)}))},n._onClose=function(){n.setState({showForm:!1,selectedVehicle:void 0})},n._onEditVehicle=function(e){n.setState({selectedVehicle:e,showForm:!0})},n._onDeleteVehicle=function(e){n.props.connector.deleteVehicle(e).then((function(e){n.loadData()}))},n._onSave=function(e){n.publishVehicle(e)},n.publishVehicle=function(e){n.props.connector.publishVehicle(e).then((function(e){L.a.success("Salvataggio completato"),n.setState({showForm:!1,selectedVehicle:void 0},(function(){n.loadData()}))})).catch((function(e){console.error(e),L.a.error("Si \xe8 verificato un errore nel salvataggio")}))},n._onCreate=function(){n.setState({selectedVehicle:n.emptyVehicle,showForm:!0})},n}return Object(T.a)(t,e),Object(E.a)(t,[{key:"componentDidMount",value:function(){this.loadData()}},{key:"render",value:function(){var e=this.state,t=e.loading,a=e.vehicles;return r.createElement("div",null,t?r.createElement("div",{style:{textAlign:"center"}},r.createElement(X.a,null)," "):r.createElement("div",null,r.createElement(ee.a,{columns:this.columns,pagination:{pageSize:10},dataSource:a}),r.createElement(Se,{visible:this.state.showForm,vehicle:this.state.selectedVehicle,onClose:this._onClose,onSave:this._onSave}),this.state.showForm?void 0:r.createElement(ae,{onClick:this._onCreate})))}}]),t}(r.Component),we=Object(w.b)((function(e,t){return{connector:e.appData.connector,committee:e.appData.committee}}))(De),Oe=a(246),ke=a(495),Te=a(98),Ce=a(503),_e=a(504),xe=a(489),je=a(490),Ue=a(248),Ae=a(137),Ie=a(493),Ve=a(502),ze={0:"Dipendenti",1:"Volontari",2:"Chiunque"},Fe={0:"In Sede",1:"Destinazione",2:"Prelevamento"},Me={0:"Solo Andata",1:"Andata/Ritorno"},Le={0:"Autista",1:"Soccorritore",2:"Medico/Sanitario"},Ne=a(247),Re=a(500),Pe=z.a.Option,Be=function(e){function t(){var e,a;Object(v.a)(this,t);for(var r=arguments.length,n=new Array(r),i=0;i<r;i++)n[i]=arguments[i];return(a=Object(O.a)(this,(e=Object(k.a)(t)).call.apply(e,[this].concat(n)))).setFieldsValue=function(e){var t=a.props.form,r=new Date(2e3,1,1,e.hour?Number(e.hour.substring(0,2)):12,e.hour?Number(e.hour.substring(3,5)):0),n=Object(s.a)({},e,{tripDate:e.date?ue()(e.date):void 0,tripHour:ue()(r)});t.setFieldsValue(n)},a.handleSubmit=function(e){e.preventDefault(),a.props.form.validateFields((function(e,t){if(!e){var r=Object(s.a)({},t,{date:t.tripDate?t.tripDate.format("YYYY-MM-DD"):void 0,hour:t.tripHour.format("HH:mm")});a.props.onSave(r)}}))},a}return Object(T.a)(t,e),Object(E.a)(t,[{key:"componentWillReceiveProps",value:function(e){var t=e.trip;void 0!==t&&JSON.stringify(this.props.trip)!==JSON.stringify(e.trip)&&this.setFieldsValue(t)}},{key:"render",value:function(){var e=this.props.form.getFieldDecorator,t=this.props,a=t.trip,n=t.onClose,i=t.visible,o=t.vehicles;return r.createElement(Z.a,{title:"".concat(0===(null===a||void 0===a?void 0:a.id)?"Crea":"Modifica"," servizio"),width:480,onClose:n,visible:i,bodyStyle:{paddingBottom:80}},r.createElement(M.a,{layout:"vertical",onSubmit:this.handleSubmit},r.createElement(R.a,{gutter:16},r.createElement(P.a,{span:8},r.createElement(M.a.Item,{label:"Data del servizio"},e("tripDate",{rules:[{required:!0,message:"Specificare data di partenza"}]})(r.createElement(le.a,{style:{width:"100%"},format:"DD-MM-YYYY"})))),r.createElement(P.a,{span:8},r.createElement(M.a.Item,{label:"Ora"},e("tripHour",{rules:[{type:"object",required:!0,message:"Specificare l'ora del servizio"}]})(r.createElement(Ne.a,{style:{width:"100%"},placeholder:"Ora servizio",format:"HH:mm"})))),r.createElement(P.a,{span:8},r.createElement(M.a.Item,{label:"Luogo"},e("flgDestination",{rules:[{required:!0,message:"Specificare il luogo"}]})(r.createElement(z.a,{placeholder:"Luogo"},r.createElement(Pe,{value:0},Fe[0]),r.createElement(Pe,{value:1},Fe[1]),r.createElement(Pe,{value:2},Fe[2])))))),r.createElement(R.a,{gutter:16},r.createElement(P.a,{span:12},r.createElement(M.a.Item,{label:"Partenza"},e("siteDeparture",{rules:[{required:!0,message:"Specificare il luogo di partenza"}]})(r.createElement(B.a.TextArea,{rows:4,placeholder:"Luogo di partenza"})))),r.createElement(P.a,{span:12},r.createElement(M.a.Item,{label:"Arrivo"},e("siteArrival",{rules:[{required:!0,message:"Specificare il luogo di arrivo"}]})(r.createElement(B.a.TextArea,{rows:4,placeholder:"Luogo di arrivo"}))))),r.createElement(R.a,{gutter:16},r.createElement(P.a,{span:8},r.createElement(M.a.Item,{label:"Veicolo"},e("vehicleId",{rules:[{required:!0,message:"Specificare il veicolo"}]})(r.createElement(z.a,{placeholder:"veicolo"},o.map((function(e){var t=e.id;return r.createElement(Pe,{key:t,value:e.id},e.sign," - ",Ee[e.type])})))))),r.createElement(P.a,{span:8},r.createElement(M.a.Item,null,e("flgAr")(r.createElement(Ae.a.Group,{style:{marginTop:"10px"}},r.createElement(Ae.a,{value:0},Me[0]),r.createElement(Ae.a,{value:1},Me[1]))))),r.createElement(P.a,{span:8},r.createElement(M.a.Item,{label:"Servizio per"},e("type",{rules:[{required:!0,message:"Specificare il tipo"}]})(r.createElement(z.a,{placeholder:"Servizio per"},r.createElement(Pe,{value:0},ze[0]),r.createElement(Pe,{value:1},ze[1]),r.createElement(Pe,{value:2},ze[2])))))),r.createElement(R.a,{gutter:16},r.createElement(P.a,{span:8},r.createElement(M.a.Item,{label:"Tipologia servizio"},e("serviceType",{rules:[{required:!0,message:"Specificare il tipo di servizio"}]})(r.createElement(B.a.TextArea,{rows:2,placeholder:"Tipologia servizio"})))),r.createElement(P.a,{span:8},r.createElement(M.a.Item,{label:"Dati paziente"},e("patientData")(r.createElement(B.a.TextArea,{rows:2,placeholder:"Dati paziente"})))),r.createElement(P.a,{span:8},r.createElement(M.a.Item,{label:"Con infermiere"},e("flgNurse",{valuePropName:"checked"})(r.createElement(ce.a,null))))),r.createElement(R.a,{gutter:16},r.createElement(P.a,{span:8},r.createElement(M.a.Item,{label:"Note"},e("notes")(r.createElement(B.a.TextArea,{rows:3,placeholder:"Eventuali note aggiuntive"})))),r.createElement(P.a,{span:8},r.createElement(M.a.Item,{label:"Numero accompagnatori"},e("extraUsers",{initialValue:1})(r.createElement(Re.a,{min:1,max:10})))),r.createElement(P.a,{span:8},r.createElement(M.a.Item,{label:"Da notificare"},e("flgToNotify",{valuePropName:"checked"})(r.createElement(ce.a,null))))),r.createElement(R.a,{gutter:16,style:{visibility:"collapse"}},r.createElement(P.a,{span:6},r.createElement(M.a.Item,{label:"Id"},e("id")(r.createElement(B.a,{placeholder:"Specificare id servizio"}))),r.createElement(P.a,{span:6},r.createElement(M.a.Item,{label:"CommitteeId"},e("committeeId")(r.createElement(B.a,{placeholder:"CommitteeId"})))))),r.createElement("div",{style:{position:"absolute",right:0,bottom:0,width:"100%",borderTop:"1px solid #e9e9e9",padding:"10px 16px",background:"#fff",textAlign:"right"}},r.createElement(H.a,{onClick:this.props.onClose,style:{marginRight:8}},"Annulla"),r.createElement(H.a,{htmlType:"submit",type:"primary"},"Salva"))))}}]),t}(r.Component),He=M.a.create({name:"trip_form "})(Be),Ye=function(e){function t(){return Object(v.a)(this,t),Object(O.a)(this,Object(k.a)(t).apply(this,arguments))}return Object(T.a)(t,e),Object(E.a)(t,[{key:"render",value:function(){return r.createElement(He,this.props)}}]),t}(r.Component),qe=z.a.Option,We=function(e){function t(){var e,a;Object(v.a)(this,t);for(var r=arguments.length,n=new Array(r),i=0;i<r;i++)n[i]=arguments[i];return(a=Object(O.a)(this,(e=Object(k.a)(t)).call.apply(e,[this].concat(n)))).state={userSelected:a.props.isUserAdmin?a.props.users[0]:a.props.loggedUser,roleSelected:1},a._onChangeRole=function(e){a.setState({roleSelected:e.target.value})},a._onChangeUser=function(e){var t=a.props.users.find((function(t){return t.id===e}));void 0!==t&&a.setState({userSelected:t,roleSelected:1})},a}return Object(T.a)(t,e),Object(E.a)(t,[{key:"render",value:function(){var e=this,t=this.props,a=t.users,n=t.isUserAdmin,i=t.loggedUser,o=this.state,l=o.userSelected,c=o.roleSelected;return r.createElement("div",null,r.createElement(R.a,null,r.createElement(z.a,{style:{width:"100%"},defaultValue:this.state.userSelected.id,onChange:this._onChangeUser},a.filter((function(e){return n||e.id===i.id})).map((function(e){return r.createElement(qe,{value:e.id,key:e.id},e.name," ",e.surname)})))),r.createElement(R.a,null,r.createElement(Ae.a.Group,{style:{marginTop:"5px",width:"100%"},value:c,buttonStyle:"solid",onChange:this._onChangeRole},1===l.withDrivingLicense?r.createElement(Ae.a.Button,{value:0},Le[0]):void 0,r.createElement(Ae.a.Button,{value:1},Le[1]),2===l.committeeUser.occupation?r.createElement(Ae.a.Button,{value:2},Le[2]):void 0)),r.createElement(R.a,null,r.createElement(H.a,{style:{marginTop:"5px",width:"100%"},onClick:function(){return e.props.onConfirmRole(e.state.roleSelected,e.state.userSelected.id)}},"Conferma")))}}]),t}(r.Component),Ge=a(97),Je=a.n(Ge),Ke=0,$e=function(e){function t(){var e,a;Object(v.a)(this,t);for(var r=arguments.length,n=new Array(r),i=0;i<r;i++)n[i]=arguments[i];return(a=Object(O.a)(this,(e=Object(k.a)(t)).call.apply(e,[this].concat(n)))).onDeleteDate=function(e){var t=a.props.form,r=t.getFieldValue("keys"),n=t.getFieldValue("duplicateElements")||[];1!==r.length&&t.setFieldsValue({keys:r.filter((function(t){return t!==e})),duplicateElements:n.filter((function(t,a){return a!==e}))})},a.onAddDate=function(){var e=a.props.form,t=e.getFieldValue("keys").concat(Ke++);e.setFieldsValue({keys:t})},a.handleSubmit=function(e){e.preventDefault(),a.props.form.validateFields((function(e,t){if(!e){var r=t.duplicateElements,n=a.props.trip;a.props.onConfirm(n,r.filter((function(e){return!!e})))}}))},a.getInitialDateValue=function(e){var t=a.props.trip;return ue()(void 0!==t?t.date:new Date).add(e+1,"d")},a.getInitialHourValue=function(){var e=a.props.trip,t=new Date(2e3,1,1,(null===e||void 0===e?void 0:e.hour)?Number(e.hour.substring(0,2)):12,(null===e||void 0===e?void 0:e.hour)?Number(e.hour.substring(3,5)):0);return ue()(t)},a}return Object(T.a)(t,e),Object(E.a)(t,[{key:"componentWillReceiveProps",value:function(e){void 0!==e.trip&&JSON.stringify(this.props.trip)!==JSON.stringify(e.trip)&&this.props.form.setFieldsValue({keys:[],duplicateElements:[]})}},{key:"render",value:function(){var e=this,t=this.props.form,a=t.getFieldDecorator,n=t.getFieldValue;a("keys",{initialValue:[]});var i=n("keys").map((function(t,n){return r.createElement(R.a,{gutter:16,key:n},r.createElement(P.a,{span:11},r.createElement(Je.a.Item,null,a("duplicateElements[".concat(t,"].date"),{initialValue:e.getInitialDateValue(n),rules:[{required:!0,message:"Selezionare data del viaggio"}]})(r.createElement(le.a,{style:{width:"100%"},format:"DD-MM-YYYY"})))),r.createElement(P.a,{span:11},r.createElement(Je.a.Item,null,a("duplicateElements[".concat(t,"].hour"),{initialValue:e.getInitialHourValue(),rules:[{type:"object",required:!0,message:"Specificare l'ora del servizio"}]})(r.createElement(Ne.a,{style:{width:"100%"},placeholder:"Ora servizio",format:"HH:mm"})))),r.createElement(P.a,{span:2},0===t?void 0:r.createElement(F.a,{style:{marginTop:"10px"},className:"dynamic-delete-button",type:"minus-circle-o",onClick:function(){return e.onDeleteDate(t)}})))}));return r.createElement(Z.a,{title:"Duplica servizio",width:480,onClose:this.props.onClose,visible:this.props.visible,bodyStyle:{paddingBottom:80}},r.createElement(Je.a,{onSubmit:this.handleSubmit},i,r.createElement(R.a,{gutter:16},r.createElement(P.a,{span:24},r.createElement(Je.a.Item,null,r.createElement(H.a,{type:"dashed",onClick:this.onAddDate,style:{width:"100%"}},r.createElement(F.a,{type:"plus"})," Aggiungi data")))),r.createElement("div",{style:{position:"absolute",right:0,bottom:0,width:"100%",borderTop:"1px solid #e9e9e9",padding:"10px 16px",background:"#fff",textAlign:"right"}},r.createElement(H.a,{onClick:this.props.onClose,style:{marginRight:8}},"Annulla"),r.createElement(H.a,{htmlType:"submit",type:"primary"},"Conferma"))))}}]),t}(r.Component),Qe=Je.a.create({name:"duplicate_trip_form "})($e),Xe=function(e){function t(){return Object(v.a)(this,t),Object(O.a)(this,Object(k.a)(t).apply(this,arguments))}return Object(T.a)(t,e),Object(E.a)(t,[{key:"render",value:function(){return r.createElement(Qe,this.props)}}]),t}(r.Component);!function(e){e[e.week=0]="week",e[e.month=1]="month"}(m||(m={}));var Ze=["Domenica","Luned\xec","Marted\xec","Mercoled\xec","Gioved\xec","Venerd\xec","Sabato"],et=["Gennaio","Febbraio","Marzo","Aprile","Maggio","Giugno","Luglio","Agosto","Settembre","Ottobre","Novembre","Dicembre"],tt=new Date,at=function(e){function t(){var e,a;Object(v.a)(this,t);for(var r=arguments.length,i=new Array(r),o=0;o<r;o++)i[o]=arguments[o];return(a=Object(O.a)(this,(e=Object(k.a)(t)).call.apply(e,[this].concat(i)))).state={loading:!1,selectedDate:tt,firstDayOfView:tt,viewMode:m.week,trips:[],vehicles:[],showForm:!1,showDuplicateTripForm:!1,selectedTrip:void 0,rolesVisible:[]},a.getEmptyTrip=function(){var e,t=a.state.vehicles;return{id:0,date:Object(Ie.a)(a.state.selectedDate,"yyyy-MM-dd"),hour:"12:00:00",flgDestination:0,flgAr:0,siteDeparture:"",siteArrival:"",serviceType:"",patientData:void 0,type:2,extraUsers:1,flgNurse:0,flgToNotify:0,notes:void 0,committeeId:(null===(e=a.props.committee)||void 0===e?void 0:e.id)||0,vehicleId:0!==t.length?t[0].id:0,committee:void 0,vehicle:void 0,trip_users:[]}},a.loadData=function(){var e=a.props.committee;if(void 0!==e){var t=e.id;a.props.connector.getTrips(t).then((function(e){a.setState({trips:e.data}),a.props.connector.getVehicles(t).then((function(e){a.setState({vehicles:e.data,loading:!1})})).catch((function(e){a.setState({vehicles:[],loading:!1}),console.error(e)}))})).catch((function(e){a.setState({trips:[],loading:!1}),console.error(e)}))}},a._onChangeView=function(e){var t=e.target.value;a.setState({viewMode:t})},a._onClickDayOfWeek=function(e){console.log(e),a.setState({selectedDate:e})},a.renderDayOfWeek=function(e){var t=a.state.selectedDate,r=e.getDate()===t.getDate()&&e.getMonth()===t.getMonth()&&e.getFullYear()===t.getFullYear(),i=e.getTime()<tt.getTime(),o=e.getTime()===tt.getTime();return n.a.createElement(P.a,{key:e.getTime(),span:3},n.a.createElement(ke.a,{onClick:function(){return a._onClickDayOfWeek(e)},size:"small",title:a.renderCardHeaderDate(e),className:"current-day",style:{cursor:"pointer",borderRadius:"10px",height:"90px",border:"2px solid ".concat(r?"#1890ff":"#e8e8e8"),backgroundColor:"".concat(o?"#e6f7ff":i?"#f2f4f5":"white")}},a.renderCardBodyWeekDay(e)))},a.renderDays=function(){for(var e=a.state,t=e.viewMode,r=e.firstDayOfView,i=t===m.week?1:4,o=[],l=0;l<i;l++){var c=a.renderDaysOfWeek(r,l),s=n.a.createElement(R.a,{justify:"center",key:l,type:"flex"},n.a.createElement(P.a,{span:1,style:{textAlign:"center"}},0===l?n.a.createElement(H.a,{icon:"left",style:{margin:5},onClick:a._onMoveViewLeft}):void 0),c,n.a.createElement(P.a,{span:1,style:{textAlign:"center"}},0===l?n.a.createElement(H.a,{icon:"right",style:{margin:5},onClick:a._onMoveViewRight}):void 0));o.push(s)}return o},a.renderDaysOfWeek=function(e,t){for(var r=[],n=0;n<7;n++){var i=Object(Ve.a)(e,{days:n+7*t});r.push(a.renderDayOfWeek(i))}return r},a._onDeleteTrip=function(e){a.props.connector.deleteTripUsersByTrip(e).then((function(t){a.props.connector.deleteTrip(e).then((function(e){a.loadData()})).catch((function(e){console.log("_onDeleteTrip error: ".concat(e)),L.a.error("Si \xe8 verificato un errore durante l'eliminazione"),a.loadData()}))})).catch((function(e){console.log("_onDeleteTrip error: ".concat(e)),L.a.error("Si \xe8 verificato un errore durante l'eliminazione")}))},a._onEditTrip=function(e){a.setState({selectedTrip:e,showForm:!0})},a._onDuplicateTrip=function(e){a.setState({selectedTrip:e,showDuplicateTripForm:!0})},a.getTrips=function(e){var t=a.state.trips,r=a.props.user;return t.filter((function(t){return new Date(t.date).setHours(0,0,0,0)===e.setHours(0,0,0,0)})).filter((function(e){return void 0!==r&&void 0!==r.committeeUser&&(0===r.committeeUser.occupation||e.type>0)})).sort((function(e,t){var a=e.hour.split(":").join(""),r=t.hour.split(":").join("");return Number(a)-Number(r)}))},a.handleRoleVisibleChange=function(e,t){var r=Object(Oe.a)(a.state.rolesVisible);r[e]=t,a.setState({rolesVisible:r})},a._onDeleteTripUser=function(e){a.props.connector.deleteTripUsers(e).then((function(e){a.loadData()})).catch((function(e){console.error("_onDeleteTripUser: ".concat(e)),L.a.error("Si \xe8 verificato un errore nell'eliminazione")}))},a.renderTooltipUserAvatar=function(e){var t=a.props.user,r=Le[e.role];return n.a.createElement("p",null,r,a.isUserAdmin||((null===t||void 0===t?void 0:t.id)||0)===e.userId?n.a.createElement($.a,{title:"Elimina"},n.a.createElement(H.a,{onClick:function(){return a._onDeleteTripUser(e.id)},style:{marginLeft:"5px"},icon:"delete",type:"danger"})):void 0)},a.renderTimeline=function(){var e=a.state,t=e.selectedDate,r=e.rolesVisible,i=a.getTrips(t);if(0===i.length)return n.a.createElement(Te.a,null);var o=i.reduce((function(e,t){return e.extraUsers>t.extraUsers?e:t})).extraUsers+1,l=Math.floor(24/o);return n.a.createElement(Ce.a,null,i.map((function(e,t){for(var i=e.trip_users||[],o=e.extraUsers+1,c=[],s=function(t){var o=i[t],s=Number("".concat(e.id).concat(t)),u=r[s];if(o){var p=o.user;return c.push(n.a.createElement(P.a,{span:l,key:t,style:{textAlign:"center"}},n.a.createElement($.a,{title:a.renderTooltipUserAvatar(o)},n.a.createElement(_e.a,{style:{zIndex:1},count:n.a.createElement("b",null,Le[o.role].substring(0,1))},n.a.createElement(xe.a,{style:{backgroundColor:"#87d068"},shape:"square",icon:"user"})),n.a.createElement("p",null,n.a.createElement("span",{style:{fontSize:"10px"}},null===p||void 0===p?void 0:p.name," ",null===p||void 0===p?void 0:p.surname))))),"continue"}c.push(n.a.createElement(P.a,{span:l,key:t,style:{textAlign:"center"}},n.a.createElement(je.a,{content:a.renderRoleChoose(e),trigger:"click",visible:u,onVisibleChange:function(e){return a.handleRoleVisibleChange(s,e)}},n.a.createElement(H.a,{type:"dashed",icon:"user"}))))},u=0;u<o;u++)s(u);return n.a.createElement(Ce.a.Item,{key:t},n.a.createElement(R.a,null,n.a.createElement(P.a,{span:8},n.a.createElement(R.a,null,n.a.createElement("b",null,"Ora:")," ",e.hour.substr(0,5),n.a.createElement(Ue.a,{style:{marginLeft:"5px"},color:"green"},Fe[e.flgDestination])),n.a.createElement(R.a,null,n.a.createElement("b",null,"Partenza: "),e.siteDeparture),n.a.createElement(R.a,null,n.a.createElement("b",null,"Arrivo: ")," ",e.siteArrival),n.a.createElement(R.a,null,n.a.createElement("b",null,"Veicolo: ")," ",Ee[e.vehicle.type]," - ",e.vehicle.sign," - ",e.vehicle.description)),n.a.createElement(P.a,{span:4},n.a.createElement(R.a,null,n.a.createElement(Ue.a,null,Me[e.flgAr])),n.a.createElement(R.a,null,n.a.createElement(Ue.a,{color:"cyan"},ze[e.type])),n.a.createElement(R.a,null,1===e.flgNurse?n.a.createElement(Ue.a,{color:"blue"},"Con infermiere"):void 0)),n.a.createElement(P.a,{span:5},n.a.createElement(R.a,null,n.a.createElement("b",null,"Paziente: "),e.patientData||"-"),n.a.createElement(R.a,null,n.a.createElement("b",null,"Servizio: "),e.serviceType||"-"),n.a.createElement(R.a,null,e.notes)),n.a.createElement(P.a,{span:a.isUserAdmin?5:7},n.a.createElement(R.a,null,c)),a.isUserAdmin?n.a.createElement(P.a,{span:2,style:{textAlign:"center",padding:"10px"}},n.a.createElement($.a,{title:"Modifica"},n.a.createElement(H.a,{size:"small",icon:"edit",onClick:function(){return a._onEditTrip(e)}})),n.a.createElement($.a,{title:"Duplica"},n.a.createElement(H.a,{icon:"copy",size:"small",style:{marginLeft:"1px"},onClick:function(){return a._onDuplicateTrip(e)}})),n.a.createElement(Q.a,{placement:"topLeft",title:"Confermare l'eliminazione del servizio?",onConfirm:function(){return a._onDeleteTrip(e.id)},okText:"Si",cancelText:"No"},n.a.createElement(H.a,{size:"small",style:{marginLeft:"1px"},icon:"delete",type:"danger"}))):void 0))})))},a._onConfirmRole=function(e,t,r){var n={id:0,tripId:t.id,userId:r,role:e},i=a.state.rolesVisible.map((function(e){return!1}));a.props.connector.publishTripUser(n).then((function(e){L.a.success("Salvataggio completato"),a.setState({rolesVisible:i},(function(){a.loadData()}))})).catch((function(e){console.log(e),L.a.error("Si \xe8 verificato un errore nel salvataggio")}))},a.renderRoleChoose=function(e){var t=a.props.users;return n.a.createElement(We,{users:t.filter((function(e){return!e.committeeUser.disabled})),isUserAdmin:a.isUserAdmin,loggedUser:a.props.user,onConfirmRole:function(t,r){return a._onConfirmRole(t,e,r)}})},a._onCreate=function(){a.setState({selectedTrip:a.getEmptyTrip(),showForm:!0})},a._onCloseTripForm=function(){a.setState({showForm:!1,selectedTrip:void 0})},a._onCloseDuplicateTripForm=function(){a.setState({showDuplicateTripForm:!1,selectedTrip:void 0})},a._onConfirmDuplicateTrip=function(){var e=Object(f.a)(h.a.mark((function e(t,r){var n,i,o;return h.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:n=!1,i=h.a.mark((function e(i){var o,l,c,u;return h.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return o=r[i],l=o.date.format("YYYY-MM-DD"),c=o.hour.format("HH:mm"),u=Object(s.a)({},t,{id:0,date:l,hour:c}),e.next=6,a.props.connector.publishTrip(u).then((function(e){console.log("_onConfirmDuplicateTrip done")})).catch((function(e){n=!0,console.error("_onConfirmDuplicateTrip error for trip with date ".concat(l," and hour ").concat(c,". Error: ").concat(e))}));case 6:case"end":return e.stop()}}),e)})),o=0;case 3:if(!(o<r.length)){e.next=8;break}return e.delegateYield(i(o),"t0",5);case 5:o++,e.next=3;break;case 8:a.setState({showDuplicateTripForm:!1,selectedTrip:void 0},(function(){n?L.a.error("Si sono verificati degli errori durante l'operazione"):L.a.success("Operazione completata con successo"),a.loadData()}));case 9:case"end":return e.stop()}}),e)})));return function(t,a){return e.apply(this,arguments)}}(),a._onSave=function(e){a.props.connector.publishTrip(e).then((function(e){L.a.success("Salvataggio completato"),a.setState({showForm:!1,selectedTrip:void 0},(function(){a.loadData()}))})).catch((function(e){console.log(e),L.a.error("Si \xe8 verificato un errore nel salvataggio")}))},a._onMoveViewRight=function(){var e=a.state,t=e.viewMode,r=e.firstDayOfView,n=Object(Ve.a)(r,{days:t===m.week?7:28});a.setState({firstDayOfView:n,selectedDate:n})},a._onMoveViewLeft=function(){var e=a.state,t=e.viewMode,r=e.firstDayOfView,n=Object(Ve.a)(r,{days:t===m.week?-7:-28});a.setState({firstDayOfView:n,selectedDate:n})},a}return Object(T.a)(t,e),Object(E.a)(t,[{key:"componentDidMount",value:function(){this.loadData()}},{key:"renderCardHeaderDate",value:function(e){var t=e.getDate(),a=et[e.getMonth()];return n.a.createElement(R.a,null,n.a.createElement(P.a,{style:{textAlign:"left"},span:24},t," ",a.substring(0,3)))}},{key:"renderCardBodyWeekDay",value:function(e){var t=Ze[e.getDay()],a=this.getTrips(e);return n.a.createElement(R.a,null,n.a.createElement(P.a,{style:{textAlign:"left"},span:24},n.a.createElement("b",null,t),0!==a.length?n.a.createElement(_e.a,{count:a.length,style:{backgroundColor:"#87D068",marginLeft:"3px"}}):void 0))}},{key:"render",value:function(){var e=this.state,t=e.selectedTrip,a=e.showForm,r=e.showDuplicateTripForm,i=e.vehicles,o=this.props.user;return n.a.createElement("div",null,n.a.createElement("div",{style:{textAlign:"end",margin:10}},"Visualizzazione:",n.a.createElement(Ae.a.Group,{defaultValue:this.state.viewMode,size:"default",onChange:this._onChangeView,style:{marginLeft:5}},n.a.createElement(Ae.a.Button,{value:m.week},"Settimana"),n.a.createElement(Ae.a.Button,{value:m.month},"Mese"))),n.a.createElement("div",null,n.a.createElement("div",null,this.renderDays()),n.a.createElement(ke.a,{style:{width:"100%",height:"100%",borderRadius:"10px"}},this.renderTimeline())),n.a.createElement(Ye,{visible:a,trip:t,vehicles:i.filter((function(e){return!e.disabled})),onClose:this._onCloseTripForm,onSave:this._onSave}),n.a.createElement(Xe,{visible:r,trip:t,onClose:this._onCloseDuplicateTripForm,onConfirm:this._onConfirmDuplicateTrip}),a||r||o&&o.committeeUser.role>1?void 0:n.a.createElement(ae,{onClick:this._onCreate}))}},{key:"isUserAdmin",get:function(){var e=this.props.user;return void 0!==e&&void 0!==e.committeeUser&&(null===e||void 0===e?void 0:e.committeeUser.role)<2}}]),t}(n.a.Component),rt=Object(w.b)((function(e,t){return{user:e.appData.user,connector:e.appData.connector,committee:e.appData.committee,users:e.appData.users}}))(at),nt=function(e){function t(){var e,a;Object(v.a)(this,t);for(var r=arguments.length,n=new Array(r),i=0;i<r;i++)n[i]=arguments[i];return(a=Object(O.a)(this,(e=Object(k.a)(t)).call.apply(e,[this].concat(n))))._onCancel=function(){a.props.history.goBack()},a._onSave=function(e){a.props.connector.publishUser(e).then((function(t){a.props.setUserData(e),L.a.success("Salvataggio completato")})).catch((function(e){console.error("_onSave: error ".concat(e)),L.a.error("Si \xe8 verificato un errore nel salvataggio")}))},a}return Object(T.a)(t,e),Object(E.a)(t,[{key:"render",value:function(){var e=this.props.user;return r.createElement(R.a,null,r.createElement(P.a,{span:6}),r.createElement(P.a,{span:12,style:{marginTop:"10px"}},r.createElement(he,{loggedUserId:e.id,user:e,personalArea:!0,onCancel:this._onCancel,onSave:this._onSave})),r.createElement(P.a,{span:6}))}}]),t}(r.Component),it=Object(w.b)((function(e,t){return{user:e.appData.user,connector:e.appData.connector,committee:e.appData.committee}}),{setUserData:p})(nt),ot=J.a.Header,lt=J.a.Content,ct=J.a.Footer,st=J.a.Sider,ut=function(e){function t(e){var a;Object(v.a)(this,t),(a=Object(O.a)(this,Object(k.a)(t).call(this,e))).state={collapsed:!1},a._onCollapse=function(e){a.setState({collapsed:e})},a._onClickLogout=function(){a.props.resetAuthData(),a._onLogout()},a._onLogout=function(){a.props.history.replace(j)};var r=a.props,n=r.user,i=r.committee;return n||i||a._onLogout(),a}return Object(T.a)(t,e),Object(E.a)(t,[{key:"render",value:function(){var e=this,t=this.props,a=t.user,r=t.committee;return n.a.createElement(J.a,{style:{minHeight:"100vh"}},n.a.createElement(st,{collapsible:!0,collapsed:this.state.collapsed,onCollapse:this._onCollapse},n.a.createElement("div",{style:{height:"60px",width:"100%"}}),n.a.createElement(K.a,{theme:"dark",defaultSelectedKeys:["1"],mode:"inline"},n.a.createElement(K.a.Item,{key:"1",onClick:function(){e.props.history.push(U)}},n.a.createElement(F.a,{type:"calendar"}),n.a.createElement("span",null,"Gestione Servizi")),this.isUserAdmin?n.a.createElement(K.a.Item,{key:"2",onClick:function(){e.props.history.push(A)}},n.a.createElement(F.a,{type:"team"}),n.a.createElement("span",null,"Gestione Utenti")):void 0,this.isUserAdmin?n.a.createElement(K.a.Item,{key:"3",onClick:function(){e.props.history.push(I)}},n.a.createElement(F.a,{type:"car"}),n.a.createElement("span",null,"Gestione Veicoli")):void 0)),n.a.createElement(J.a,null,n.a.createElement(ot,{style:{background:"#001529",maxHeight:"64px",padding:0}},n.a.createElement(R.a,null,n.a.createElement(P.a,{span:16,style:{textAlign:"left"}},n.a.createElement("span",{style:{color:"white",marginLeft:"5px",fontStyle:"bold",fontSize:"larger"}},"Servizio Facile v.1.0"),"-",n.a.createElement("span",{style:{color:"white",marginLeft:"5px",fontStyle:"italic"}},null===r||void 0===r?void 0:r.description)),n.a.createElement(P.a,{span:6,style:{textAlign:"right"}},n.a.createElement("span",{style:{color:"white",marginRight:"5px"}},null===a||void 0===a?void 0:a.name," ",null===a||void 0===a?void 0:a.surname)),n.a.createElement(P.a,{span:1},n.a.createElement($.a,{title:"Area personale",placement:"bottom"},n.a.createElement(H.a,{ghost:!0,icon:"user",onClick:function(){e.props.history.push(V)},style:{height:"64px",width:"100%"}}))),n.a.createElement(P.a,{span:1},n.a.createElement($.a,{title:"Logout",placement:"bottom"},n.a.createElement(H.a,{ghost:!0,icon:"logout",style:{height:"64px",width:"100%"},onClick:this._onClickLogout}))))),n.a.createElement(lt,{style:{margin:"0 16px"}},n.a.createElement(_.a,{path:U,component:rt}),n.a.createElement(_.a,{path:A,component:ve}),n.a.createElement(_.a,{path:I,component:we}),n.a.createElement(_.a,{path:V,component:it})),n.a.createElement(ct,{style:{textAlign:"center"}})))}},{key:"isUserAdmin",get:function(){var e=this.props.user;return void 0!==e&&void 0!==e.committeeUser&&(null===e||void 0===e?void 0:e.committeeUser.role)<2}}]),t}(n.a.Component),pt=Object(w.b)((function(e,t){return{user:e.appData.user,committee:e.appData.committee}}),{resetAuthData:function(){return{type:l.RESET_AUTH_DATA}}})(ut),mt=function(e){function t(){return Object(v.a)(this,t),Object(O.a)(this,Object(k.a)(t).apply(this,arguments))}return Object(T.a)(t,e),Object(E.a)(t,[{key:"render",value:function(){return n.a.createElement(C.a,null,n.a.createElement(_.c,null,n.a.createElement(_.a,{exact:!0,path:x,component:G}),n.a.createElement(_.a,{component:pt})))}}]),t}(n.a.Component);function dt(){return Object(c.c)(D)}a.d(t,"configureStore",(function(){return dt})),o.a.render(n.a.createElement(w.a,{store:dt()},n.a.createElement(mt,null)),document.getElementById("root")),"serviceWorker"in navigator&&navigator.serviceWorker.ready.then((function(e){e.unregister()}))}},[[251,1,2]]]);
//# sourceMappingURL=main.60afb454.chunk.js.map